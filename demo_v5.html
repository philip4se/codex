<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¤ë¬¸ ë§¤ì¹­ í”Œë«í¼ - v5.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ì›°ì»´ ìŠ¤í¬ë¦° */
        .welcome {
            text-align: center;
            padding: 50px 20px;
            color: white;
        }

        .welcome h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .welcome p {
            font-size: 20px;
            margin-bottom: 20px;
        }

        /* í—¤ë” */
        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .nav {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .points-badge {
            background: #ffd700;
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .nav-btn {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .nav-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        /* ê´€ë¦¬ì ëª¨ë“œ ì»¨íŠ¸ë¡¤ */
        .admin-controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .admin-controls h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-badge.active {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-badge.inactive {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-badge.locked {
            background: #feebc8;
            color: #7c2d12;
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ - ì…ì²´ì  ë””ìì¸ */
        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 150px;
            padding: 18px 30px;
            background: linear-gradient(145deg, #ffffff, #e6e6e6);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #555;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow:
                0 8px 16px rgba(0,0,0,0.15),
                0 4px 8px rgba(0,0,0,0.1),
                inset 0 -2px 4px rgba(0,0,0,0.1);
        }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 12px;
            background: linear-gradient(145deg, rgba(255,255,255,0.8), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tab:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow:
                0 12px 24px rgba(0,0,0,0.25),
                0 8px 16px rgba(0,0,0,0.15),
                inset 0 -2px 4px rgba(0,0,0,0.1);
        }

        .tab:hover::before {
            opacity: 1;
        }

        .tab:active {
            transform: translateY(-2px) scale(1);
            box-shadow:
                0 4px 8px rgba(0,0,0,0.2),
                0 2px 4px rgba(0,0,0,0.1);
        }

        .tab.active {
            background: linear-gradient(145deg, #667eea, #5568d3);
            color: white;
            transform: translateY(-3px);
            box-shadow:
                0 10px 20px rgba(102, 126, 234, 0.4),
                0 6px 12px rgba(102, 126, 234, 0.3),
                inset 0 2px 4px rgba(255,255,255,0.2);
        }

        .tab.active::before {
            background: linear-gradient(145deg, rgba(255,255,255,0.3), transparent);
            opacity: 1;
        }

        /* ì»¨í…ì¸  ì˜ì—­ */
        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: 400px;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .card h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ì„¤ë¬¸ ì¹´ë“œ */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .survey-card, .survey-item {
            background: linear-gradient(145deg, #ffffff, #f5f5f5);
            padding: 25px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow:
                0 6px 12px rgba(0,0,0,0.1),
                0 3px 6px rgba(0,0,0,0.08);
            position: relative;
            border: 2px solid transparent;
        }

        .survey-card:hover, .survey-item:hover {
            transform: translateY(-5px);
            box-shadow:
                0 10px 20px rgba(0,0,0,0.15),
                0 5px 10px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .survey-card.editable {
            border: 2px dashed #667eea;
            background: linear-gradient(145deg, #f0f4ff, #e5edff);
        }

        .survey-card.editable::after {
            content: 'âœï¸ í¸ì§‘ ê°€ëŠ¥';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        .survey-card.link-locked, .survey-item.link-locked {
            cursor: not-allowed;
            opacity: 0.9;
        }

        .survey-card.link-locked::before, .survey-item.link-locked::before {
            content: 'ğŸ”’';
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 20px;
        }

        .survey-card h3, .survey-title {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .survey-card p, .survey-desc {
            color: #666;
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .survey-meta, .survey-info {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: 0.9em;
            color: #888;
        }

        /* ìƒí’ˆ ì¹´ë“œ */
        .product-item {
            background: linear-gradient(145deg, #ffffff, #f5f5f5);
            padding: 25px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow:
                0 6px 12px rgba(0,0,0,0.1),
                0 3px 6px rgba(0,0,0,0.08);
            border: 2px solid #e9ecef;
            position: relative;
        }

        .product-item:hover {
            transform: translateY(-5px);
            box-shadow:
                0 10px 20px rgba(0,0,0,0.15),
                0 5px 10px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .product-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 15px;
        }

        .product-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
            text-align: center;
        }

        .product-price {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
        }

        .product-desc {
            font-size: 13px;
            color: #666;
            text-align: center;
            margin-bottom: 15px;
        }

        .product-stock {
            font-size: 12px;
            color: #28a745;
            text-align: center;
            margin-bottom: 10px;
        }

        /* ëŒ€ì‹œë³´ë“œ í†µê³„ */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(145deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow:
                0 8px 16px rgba(102, 126, 234, 0.3),
                0 4px 8px rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow:
                0 12px 24px rgba(102, 126, 234, 0.4),
                0 6px 12px rgba(102, 126, 234, 0.3);
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* í¼ */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* ì§ˆë¬¸ ì•„ì´í…œ */
        .question-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 12px;
            border: 2px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .question-item.editable {
            border: 2px dashed #667eea;
            background: #f0f4ff;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-controls {
            display: flex;
            gap: 10px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .option-input {
            flex: 1;
        }

        /* ë‹µë³€ í¼ */
        .answer-form {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .answer-option {
            display: block;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            transition: background 0.2s ease;
        }

        .answer-option:hover {
            background: #e9ecef;
        }

        .answer-option input[type="radio"],
        .answer-option input[type="checkbox"] {
            margin-right: 10px;
        }

        .answer-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 5px;
        }

        /* êµí™˜ ë‚´ì—­ */
        .exchange-history-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .exchange-date {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
        }

        .exchange-product {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .exchange-points {
            font-size: 14px;
            color: #dc3545;
        }

        /* íƒ­ ë²„íŠ¼ */
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #e9ecef;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            color: #495057;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        /* ë°°ì§€ */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            background: #28a745;
            color: white;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 10px;
        }

        .badge-points {
            background: #ffd700;
            color: #333;
        }

        .badge-popular {
            background: #ff6b6b;
            color: white;
        }

        /* ë©”ì‹œì§€ */
        .success-msg {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #c3e6cb;
        }

        .error-msg {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #f5c6cb;
        }

        /* í¸ì§‘ ëª¨ë“œ í‘œì‹œ */
        .edit-mode-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
            font-weight: bold;
            z-index: 1000;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
            }
            50% {
                box-shadow: 0 8px 24px rgba(102, 126, 234, 0.6);
            }
        }

        /* ë²„ì „ ì •ë³´ */
        .version-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            color: #666;
            z-index: 1000;
        }

        /* ìœ í‹¸ë¦¬í‹° */
        .hidden {
            display: none;
        }

        .user-info {
            color: #333;
            font-size: 14px;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .tab-navigation {
                flex-direction: column;
            }

            .tab {
                width: 100%;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 15px;
            }

            .nav {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="version-info">v5.0 ğŸ¯âœ¨</div>

    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="container">
        <div class="welcome">
            <h1>ğŸ¯ ì„¤ë¬¸ ë§¤ì¹­ í”Œë«í¼</h1>
            <p>ì„¤ë¬¸ ì˜ë¢°ìì™€ ì°¸ì—¬ìë¥¼ ì—°ê²°í•˜ëŠ” í”Œë«í¼</p>
            <p style="font-size: 16px; margin-bottom: 20px;">âœ¨ íšŒì›ê°€ì… ì‹œ 1,000P ì§€ê¸‰! ì„¤ë¬¸ ì°¸ì—¬ë¡œ í¬ì¸íŠ¸ ì ë¦½!</p>
            <p style="font-size: 16px; margin-bottom: 20px;">ğŸ í¬ì¸íŠ¸ë¡œ ê¸°í”„í‹°ì½˜, ë¬¸í™”ìƒí’ˆê¶Œ êµí™˜ ê°€ëŠ¥!</p>
            <button class="btn btn-primary" onclick="showLogin()">ì‹œì‘í•˜ê¸°</button>
            <br><br>
            <button class="btn btn-danger" onclick="resetAllData()">ğŸ”„ ë°ì´í„° ì´ˆê¸°í™” (9ê°œ ì„¤ë¬¸ ë‹¤ì‹œ ë¡œë“œ)</button>
            <br><br>
            <p style="font-size: 14px; opacity: 0.8;">ğŸ’¡ ë°ëª¨ ë²„ì „ - ë¸Œë¼ìš°ì €ì— ë°ì´í„° ì €ì¥</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="container hidden">
        <div class="card" style="max-width: 400px; margin: 100px auto;">
            <h2>ë¡œê·¸ì¸</h2>
            <div id="loginMessage"></div>
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="loginEmail" placeholder="test@example.com" value="test@example.com">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" value="password123">
            </div>
            <button class="btn btn-primary" onclick="login()">ë¡œê·¸ì¸</button>
            <button class="btn btn-secondary" onclick="showRegister()">íšŒì›ê°€ì…</button>
            <p style="margin-top: 15px; font-size: 12px; color: #666;">ğŸ’¡ í…ŒìŠ¤íŠ¸: test@example.com / password123</p>
        </div>
    </div>

    <!-- Register Screen -->
    <div id="registerScreen" class="container hidden">
        <div class="card" style="max-width: 500px; margin: 50px auto;">
            <h2>íšŒì›ê°€ì… ğŸ 1,000P ì§€ê¸‰!</h2>
            <div id="registerMessage"></div>
            <div class="form-group">
                <label>ì´ë¦„</label>
                <input type="text" id="regName" placeholder="í™ê¸¸ë™">
            </div>
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="regEmail" placeholder="test@example.com">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="regPassword" placeholder="8ì ì´ìƒ">
            </div>
            <div class="form-group">
                <label>ì „í™”ë²ˆí˜¸</label>
                <input type="tel" id="regPhone" placeholder="010-1234-5678">
            </div>
            <div class="form-group">
                <label>ìƒë…„ì›”ì¼</label>
                <input type="date" id="regBirthDate">
            </div>
            <div class="form-group">
                <label>ì§€ì—­</label>
                <select id="regRegion">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ì„œìš¸">ì„œìš¸</option>
                    <option value="ê²½ê¸°">ê²½ê¸°</option>
                    <option value="ì¸ì²œ">ì¸ì²œ</option>
                    <option value="ë¶€ì‚°">ë¶€ì‚°</option>
                    <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
                </select>
            </div>
            <div class="form-group">
                <label>ì§ì—…</label>
                <select id="regJob">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="í•™ìƒ">í•™ìƒ</option>
                    <option value="íšŒì‚¬ì›">íšŒì‚¬ì›</option>
                    <option value="ì „ë¬¸ì§">ì „ë¬¸ì§</option>
                    <option value="ìì˜ì—…">ìì˜ì—…</option>
                    <option value="ì£¼ë¶€">ì£¼ë¶€</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="register()">ê°€ì…í•˜ê¸°</button>
            <button class="btn btn-secondary" onclick="showLogin()">ë¡œê·¸ì¸ìœ¼ë¡œ</button>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboardScreen" class="container hidden">
        <div class="header">
            <div class="logo">ğŸ¯ ì„¤ë¬¸ ë§¤ì¹­ í”Œë«í¼ v5.0</div>
            <div class="nav">
                <div class="points-badge" id="userPoints">ğŸ’° 0 P</div>
                <button class="nav-btn" onclick="showDashboard()">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="showMySurveys()">ë‚´ ì„¤ë¬¸</button>
                <button class="nav-btn" onclick="showAvailableSurveys()">ì°¸ì—¬í•˜ê¸°</button>
                <button class="nav-btn" onclick="showGiftShop()">ğŸ ìƒí’ˆêµí™˜ì†Œ</button>
                <button class="nav-btn btn-danger" onclick="toggleEditMode()">
                    <span id="editModeTextNav">âœï¸ í¸ì§‘ëª¨ë“œ</span>
                </button>
                <button class="nav-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <!-- ê´€ë¦¬ì ëª¨ë“œ ì»¨íŠ¸ë¡¤ -->
        <div class="admin-controls">
            <h3>ğŸ”§ ê´€ë¦¬ì ëª¨ë“œ</h3>
            <div class="control-group">
                <button class="btn btn-primary" onclick="toggleEditMode()">
                    <span id="editModeText">ë¹„ì£¼ì–¼ ìˆ˜ì • ëª¨ë“œ í™œì„±í™”</span>
                </button>
                <button class="btn btn-warning" onclick="toggleLinkLock()" id="linkLockBtn">
                    <span id="linkLockText">ë§í¬ ì ê¸ˆ</span>
                </button>
                <div class="status-badge inactive" id="editStatus">í¸ì§‘ ëª¨ë“œ: ë¹„í™œì„±</div>
                <div class="status-badge inactive" id="linkStatus">ë§í¬: í™œì„±</div>
            </div>
        </div>

        <div class="card">
            <h2>ì•ˆë…•í•˜ì„¸ìš”, <span id="userName"></span>ë‹˜! ğŸ‘‹</h2>
            <div class="user-info" id="userInfo"></div>
        </div>

        <div class="dashboard-stats">
            <div class="stat-card">
                <div class="stat-number" id="userPointsDisplay">0</div>
                <div class="stat-label">ğŸ’° ë³´ìœ  í¬ì¸íŠ¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="mySurveysCount">0</div>
                <div class="stat-label">ë‚´ê°€ ë§Œë“  ì„¤ë¬¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="availableSurveysCount">0</div>
                <div class="stat-label">ì°¸ì—¬ ê°€ëŠ¥ ì„¤ë¬¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedSurveysCount">0</div>
                <div class="stat-label">ì°¸ì—¬ ì™„ë£Œ ì„¤ë¬¸</div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h2>ë‚´ê°€ ë§Œë“  ì„¤ë¬¸</h2>
                <button class="btn btn-primary" onclick="showCreateSurvey()">+ ìƒˆ ì„¤ë¬¸ ë§Œë“¤ê¸°</button>
                <div id="mySurveysList" style="margin-top: 20px;"></div>
            </div>
            <div class="card">
                <h2>ì°¸ì—¬ ê°€ëŠ¥í•œ ì„¤ë¬¸</h2>
                <div id="availableSurveysList"></div>
            </div>
        </div>
    </div>

    <!-- Gift Shop Screen -->
    <div id="giftShopScreen" class="container hidden">
        <div class="header">
            <div class="logo">ğŸ ìƒí’ˆ êµí™˜ì†Œ</div>
            <div class="nav">
                <div class="points-badge" id="userPoints4">ğŸ’° 0 P</div>
                <button class="nav-btn" onclick="showDashboard()">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="showGiftShop()">ğŸ ìƒí’ˆêµí™˜ì†Œ</button>
                <button class="nav-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="card">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchGiftTab('products')">ğŸ›ï¸ ìƒí’ˆ ëª©ë¡</button>
                <button class="tab-btn" onclick="switchGiftTab('history')">ğŸ“œ êµí™˜ ë‚´ì—­</button>
            </div>

            <!-- Products Tab -->
            <div id="productsTab">
                <h2>í¬ì¸íŠ¸ë¡œ êµí™˜ ê°€ëŠ¥í•œ ìƒí’ˆ</h2>
                <p style="color: #666; margin-bottom: 20px;">í˜„ì¬ ë³´ìœ  í¬ì¸íŠ¸: <strong id="currentPoints">0</strong> P</p>
                <div id="productsGrid" class="grid"></div>
            </div>

            <!-- Exchange History Tab -->
            <div id="historyTab" class="hidden">
                <h2>ë‚˜ì˜ êµí™˜ ë‚´ì—­</h2>
                <div id="exchangeHistoryList"></div>
            </div>
        </div>
    </div>

    <!-- Create Survey -->
    <div id="createSurveyScreen" class="container hidden">
        <div class="header">
            <div class="logo">ğŸ¯ ì„¤ë¬¸ ë§¤ì¹­ í”Œë«í¼</div>
            <div class="nav">
                <div class="points-badge" id="userPoints2">ğŸ’° 0 P</div>
                <button class="nav-btn" onclick="showDashboard()">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="card">
            <h2>ìƒˆ ì„¤ë¬¸ ë§Œë“¤ê¸° (êµ¬ê¸€ í¼ ìŠ¤íƒ€ì¼)</h2>
            <div id="createMessage"></div>

            <div class="form-group">
                <label>ì„¤ë¬¸ ì œëª©</label>
                <input type="text" id="surveyTitle" placeholder="ì˜ˆ: ì˜¨ë¼ì¸ ì‡¼í•‘ ë§Œì¡±ë„ ì¡°ì‚¬">
            </div>
            <div class="form-group">
                <label>ì„¤ë¬¸ ì„¤ëª…</label>
                <textarea id="surveyDesc" placeholder="ì„¤ë¬¸ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="form-group">
                <label>ëª©í‘œ ì‘ë‹µ ìˆ˜</label>
                <input type="number" id="surveyTarget" value="100">
            </div>
            <div class="form-group">
                <label>ë³´ìƒ í¬ì¸íŠ¸</label>
                <input type="number" id="surveyRewardPoints" value="100" placeholder="ì˜ˆ: 100">
                <small style="color: #666;">ì°¸ì—¬ìì—ê²Œ ì§€ê¸‰í•  í¬ì¸íŠ¸</small>
            </div>
            <div class="form-group">
                <label>íƒ€ê¹ƒ ì§€ì—­ (ì„ íƒì‚¬í•­)</label>
                <select id="surveyTargetRegion">
                    <option value="">ì „ì²´</option>
                    <option value="ì„œìš¸">ì„œìš¸</option>
                    <option value="ê²½ê¸°">ê²½ê¸°</option>
                    <option value="ì¸ì²œ">ì¸ì²œ</option>
                    <option value="ë¶€ì‚°">ë¶€ì‚°</option>
                </select>
            </div>
            <div class="form-group">
                <label>íƒ€ê¹ƒ ì§ì—… (ì„ íƒì‚¬í•­)</label>
                <select id="surveyTargetJob">
                    <option value="">ì „ì²´</option>
                    <option value="í•™ìƒ">í•™ìƒ</option>
                    <option value="íšŒì‚¬ì›">íšŒì‚¬ì›</option>
                    <option value="ì „ë¬¸ì§">ì „ë¬¸ì§</option>
                    <option value="ìì˜ì—…">ìì˜ì—…</option>
                </select>
            </div>

            <hr style="margin: 30px 0;">

            <h3>ì„¤ë¬¸ ë¬¸í•­ ì‘ì„±</h3>
            <div id="questionsContainer"></div>

            <button class="btn btn-secondary" onclick="addQuestion()">+ ì§ˆë¬¸ ì¶”ê°€</button>
            <br><br>
            <button class="btn btn-primary" onclick="createSurvey()">ì„¤ë¬¸ ìƒì„±</button>
            <button class="btn btn-secondary" onclick="showDashboard()">ì·¨ì†Œ</button>
        </div>
    </div>

    <!-- Survey Participate -->
    <div id="participateScreen" class="container hidden">
        <div class="header">
            <div class="logo">ğŸ¯ ì„¤ë¬¸ ë§¤ì¹­ í”Œë«í¼</div>
            <div class="nav">
                <div class="points-badge" id="userPoints3">ğŸ’° 0 P</div>
                <button class="nav-btn" onclick="showDashboard()">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="card">
            <h2 id="participateTitle"></h2>
            <p id="participateDesc" style="color: #666; margin-bottom: 20px;"></p>
            <div id="participateReward" style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px;"></div>

            <form id="participateForm">
                <div id="participateQuestions"></div>
                <button type="button" class="btn btn-primary" onclick="submitSurveyAnswers()">ì œì¶œí•˜ê¸°</button>
                <button type="button" class="btn btn-secondary" onclick="showDashboard()">ì·¨ì†Œ</button>
            </form>
        </div>
    </div>

    <!-- í¸ì§‘ ëª¨ë“œ ì¸ë””ì¼€ì´í„° -->
    <div class="edit-mode-indicator" id="editIndicator" style="display: none;">
        âœï¸ ë¹„ì£¼ì–¼ ìˆ˜ì • ëª¨ë“œ
    </div>

    <script>
        let currentUser = null;
        let currentSurvey = null;
        let questions = [];
        let questionCounter = 0;
        let editMode = false;
        let linksLocked = false;

        // ìƒí’ˆ ëª©ë¡ ë°ì´í„° (12ê°œ)
        const giftProducts = [
            {id: 'gifticon_5000', name: 'ê¸°í”„í‹°ì½˜ 5ì²œì›ê¶Œ', icon: 'â˜•', price: 5000, description: 'ìŠ¤íƒ€ë²…ìŠ¤, íˆ¬ì¸í”Œë ˆì´ìŠ¤ ë“±', category: 'gifticon', popular: true, stock: true},
            {id: 'gifticon_10000', name: 'ê¸°í”„í‹°ì½˜ 1ë§Œì›ê¶Œ', icon: 'ğŸ”', price: 10000, description: 'ë²„ê±°í‚¹, ë§¥ë„ë‚ ë“œ ë“±', category: 'gifticon', popular: true, stock: true},
            {id: 'culture_5000', name: 'ë¬¸í™”ìƒí’ˆê¶Œ 5ì²œì›', icon: 'ğŸ«', price: 5000, description: 'ì˜¨/ì˜¤í”„ë¼ì¸ ì‚¬ìš© ê°€ëŠ¥', category: 'culture', popular: false, stock: true},
            {id: 'culture_10000', name: 'ë¬¸í™”ìƒí’ˆê¶Œ 1ë§Œì›', icon: 'ğŸŸï¸', price: 10000, description: 'ì˜¨/ì˜¤í”„ë¼ì¸ ì‚¬ìš© ê°€ëŠ¥', category: 'culture', popular: true, stock: true},
            {id: 'starbucks_5000', name: 'ìŠ¤íƒ€ë²…ìŠ¤ 5ì²œì›', icon: 'â˜•', price: 5000, description: 'ìŠ¤íƒ€ë²…ìŠ¤ ì „ ë§¤ì¥', category: 'coffee', popular: true, stock: true},
            {id: 'convenience_3000', name: 'GS25 3ì²œì›ê¶Œ', icon: 'ğŸª', price: 3000, description: 'GS25 í¸ì˜ì ', category: 'convenience', popular: false, stock: true},
            {id: 'convenience_5000', name: 'CU 5ì²œì›ê¶Œ', icon: 'ğŸ¬', price: 5000, description: 'CU í¸ì˜ì ', category: 'convenience', popular: false, stock: true},
            {id: 'chicken_15000', name: 'ì¹˜í‚¨ êµí™˜ê¶Œ', icon: 'ğŸ—', price: 15000, description: 'BBQ, bhc, êµì´Œ ë“±', category: 'food', popular: true, stock: true},
            {id: 'icecream_3000', name: 'ë°°ìŠ¤í‚¨ë¼ë¹ˆìŠ¤ 3ì²œì›', icon: 'ğŸ¦', price: 3000, description: 'ë°°ìŠ¤í‚¨ë¼ë¹ˆìŠ¤ ë§¤ì¥', category: 'dessert', popular: false, stock: true},
            {id: 'movie_12000', name: 'ì˜í™” ê´€ëŒê¶Œ', icon: 'ğŸ¬', price: 12000, description: 'CGV, ë¡¯ë°ì‹œë„¤ë§ˆ ë“±', category: 'entertainment', popular: true, stock: true},
            {id: 'book_5000', name: 'ë„ì„œë¬¸í™”ìƒí’ˆê¶Œ 5ì²œì›', icon: 'ğŸ“š', price: 5000, description: 'ì˜¨/ì˜¤í”„ë¼ì¸ ì„œì ', category: 'book', popular: false, stock: true},
            {id: 'game_10000', name: 'êµ¬ê¸€ ê¸°í”„íŠ¸ì¹´ë“œ 1ë§Œì›', icon: 'ğŸ®', price: 10000, description: 'Google Play ìŠ¤í† ì–´', category: 'game', popular: true, stock: true}
        ];

        // ë°ì´í„° ì´ˆê¸°í™” í•¨ìˆ˜
        function resetAllData() {
            if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ê³  9ê°œ ìƒ˜í”Œ ì„¤ë¬¸ì„ ë‹¤ì‹œ ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€» íšŒì›, ì„¤ë¬¸, ì°¸ì—¬ ê¸°ë¡ì´ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.')) {
                localStorage.clear();
                alert('âœ… ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
                location.reload();
            }
        }

        function init() {
            initSampleSurveys();
            const user = localStorage.getItem('currentUser');
            if (user) {
                currentUser = JSON.parse(user);
                showDashboard();
            } else {
                showScreen('welcomeScreen');
            }
        }

        function initSampleSurveys() {
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            const version = localStorage.getItem('surveyVersion') || '0';

            // v5.0 ì„¤ë¬¸ ë¡œë“œ (9ê°œ ìƒ˜í”Œ ì„¤ë¬¸)
            if (surveys.length === 0 || version !== '5.0') {
                const sampleSurveys = [
                    {id: 'sample1', creatorId: 'system', title: 'ğŸ“± ëª¨ë°”ì¼ ì•± ì‚¬ìš©ì„± ì¡°ì‚¬', description: 'ì¼ìƒì—ì„œ ì‚¬ìš©í•˜ëŠ” ëª¨ë°”ì¼ ì•±ì— ëŒ€í•œ ë§Œì¡±ë„ë¥¼ ì¡°ì‚¬í•©ë‹ˆë‹¤.', targetResponses: 200, rewardPoints: 150, targetRegion: '', targetJob: '', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'radio', question: 'í•˜ë£¨ì— ìŠ¤ë§ˆíŠ¸í°ì„ ì‚¬ìš©í•˜ëŠ” ì‹œê°„ì€?', required: true, options: ['1ì‹œê°„ ë¯¸ë§Œ', '1-3ì‹œê°„', '3-5ì‹œê°„', '5ì‹œê°„ ì´ìƒ']}, {id: 2, type: 'checkbox', question: 'ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì•± ìœ í˜•ì€? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['SNS', 'ì‡¼í•‘', 'ê²Œì„', 'ë‰´ìŠ¤', 'ë™ì˜ìƒ']}, {id: 3, type: 'text', question: 'ê°€ì¥ ìì£¼ ì‚¬ìš©í•˜ëŠ” ì•± ì´ë¦„ì„ ì•Œë ¤ì£¼ì„¸ìš”.', required: true}, {id: 4, type: 'radio', question: 'ì „ë°˜ì ì¸ ë§Œì¡±ë„ëŠ”?', required: true, options: ['ë§¤ìš° ë§Œì¡±', 'ë§Œì¡±', 'ë³´í†µ', 'ë¶ˆë§Œì¡±', 'ë§¤ìš° ë¶ˆë§Œì¡±']}]},
                    {id: 'sample2', creatorId: 'system', title: 'ğŸ›’ ì˜¨ë¼ì¸ ì‡¼í•‘ ê²½í—˜ ì„¤ë¬¸', description: 'ì˜¨ë¼ì¸ ì‡¼í•‘ëª° ì´ìš© ê²½í—˜ê³¼ ê°œì„ ì‚¬í•­ì„ íŒŒì•…í•˜ê¸° ìœ„í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', targetResponses: 150, rewardPoints: 200, targetRegion: '', targetJob: 'íšŒì‚¬ì›', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'radio', question: 'í•œ ë‹¬ í‰ê·  ì˜¨ë¼ì¸ ì‡¼í•‘ ë¹ˆë„ëŠ”?', required: true, options: ['ì£¼ 3íšŒ ì´ìƒ', 'ì£¼ 1-2íšŒ', 'ì›” 2-3íšŒ', 'ì›” 1íšŒ ë¯¸ë§Œ']}, {id: 2, type: 'checkbox', question: 'ì£¼ë¡œ êµ¬ë§¤í•˜ëŠ” ìƒí’ˆ ì¹´í…Œê³ ë¦¬ëŠ”? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ì˜ë¥˜/íŒ¨ì…˜', 'ì‹í’ˆ', 'ì „ìì œí’ˆ', 'ë„ì„œ/ë¬¸êµ¬', 'ìƒí™œìš©í’ˆ']}, {id: 3, type: 'select', question: 'ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ìš”ì†ŒëŠ”?', required: true, options: ['ê°€ê²©', 'ë°°ì†¡ì†ë„', 'í’ˆì§ˆ', 'í›„ê¸°', 'êµí™˜/í™˜ë¶ˆ ì •ì±…']}, {id: 4, type: 'textarea', question: 'ì˜¨ë¼ì¸ ì‡¼í•‘ëª°ì—ì„œ ê°œì„ ë˜ì—ˆìœ¼ë©´ í•˜ëŠ” ì ì´ ìˆë‹¤ë©´?', required: false}]},
                    {id: 'sample3', creatorId: 'system', title: 'â˜• ì¹´í˜ ì´ìš© ìŠµê´€ ì¡°ì‚¬', description: 'ì¹´í˜ ë°©ë¬¸ ë¹ˆë„ì™€ ì„ í˜¸ë„ë¥¼ ì•Œì•„ë³´ëŠ” ì„¤ë¬¸ì…ë‹ˆë‹¤.', targetResponses: 100, rewardPoints: 100, targetRegion: 'ì„œìš¸', targetJob: '', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'radio', question: 'ì¼ì£¼ì¼ì— ì¹´í˜ ë°©ë¬¸ íšŸìˆ˜ëŠ”?', required: true, options: ['ê±°ì˜ ë§¤ì¼', 'ì£¼ 3-4íšŒ', 'ì£¼ 1-2íšŒ', 'ì›” 1-2íšŒ', 'ê±°ì˜ ë°©ë¬¸ ì•ˆ í•¨']}, {id: 2, type: 'checkbox', question: 'ì¹´í˜ë¥¼ ë°©ë¬¸í•˜ëŠ” ì£¼ìš” ëª©ì ì€? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ì»¤í”¼/ìŒë£Œ', 'ê³µë¶€/ì—…ë¬´', 'ì¹œêµ¬ ë§Œë‚¨', 'í˜¼ìë§Œì˜ ì‹œê°„', 'ë””ì €íŠ¸']}, {id: 3, type: 'radio', question: '1íšŒ ë°©ë¬¸ ì‹œ í‰ê·  ì§€ì¶œ ê¸ˆì•¡ì€?', required: true, options: ['5,000ì› ë¯¸ë§Œ', '5,000-10,000ì›', '10,000-15,000ì›', '15,000ì› ì´ìƒ']}]},
                    {id: 'sample4', creatorId: 'system', title: 'ğŸ¬ OTT ì„œë¹„ìŠ¤ ì´ìš© ì‹¤íƒœ', description: 'ë„·í”Œë¦­ìŠ¤, ë””ì¦ˆë‹ˆ+, ì¿ íŒ¡í”Œë ˆì´ ë“± OTT ì„œë¹„ìŠ¤ ì´ìš©ì— ëŒ€í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', targetResponses: 250, rewardPoints: 120, targetRegion: '', targetJob: '', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'checkbox', question: 'í˜„ì¬ êµ¬ë… ì¤‘ì¸ OTT ì„œë¹„ìŠ¤ëŠ”? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ë„·í”Œë¦­ìŠ¤', 'ë””ì¦ˆë‹ˆ+', 'ì¿ íŒ¡í”Œë ˆì´', 'í‹°ë¹™', 'ì›¨ì´ë¸Œ', 'êµ¬ë… ì•ˆ í•¨']}, {id: 2, type: 'radio', question: 'í•˜ë£¨ í‰ê·  OTT ì‹œì²­ ì‹œê°„ì€?', required: true, options: ['1ì‹œê°„ ë¯¸ë§Œ', '1-2ì‹œê°„', '2-3ì‹œê°„', '3ì‹œê°„ ì´ìƒ']}, {id: 3, type: 'select', question: 'ì„ í˜¸í•˜ëŠ” ì½˜í…ì¸  ì¥ë¥´ëŠ”?', required: true, options: ['ë“œë¼ë§ˆ', 'ì˜í™”', 'ì˜ˆëŠ¥', 'ë‹¤íë©˜í„°ë¦¬', 'ì• ë‹ˆë©”ì´ì…˜']}, {id: 4, type: 'radio', question: 'ì›” êµ¬ë…ë£Œë¡œ ì ì •í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ê¸ˆì•¡ì€?', required: true, options: ['5,000ì› ì´í•˜', '5,000-10,000ì›', '10,000-15,000ì›', '15,000ì› ì´ìƒ']}]},
                    {id: 'sample5', creatorId: 'system', title: 'ğŸ’ª ìš´ë™ ìŠµê´€ ì„¤ë¬¸', description: 'ìš´ë™ ë¹ˆë„ì™€ ì„ í˜¸í•˜ëŠ” ìš´ë™ ìœ í˜•ì„ ì•Œì•„ë³´ëŠ” ê°„ë‹¨í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', targetResponses: 100, rewardPoints: 80, targetRegion: '', targetJob: '', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'radio', question: 'ì¼ì£¼ì¼ì— ìš´ë™í•˜ëŠ” íšŸìˆ˜ëŠ”?', required: true, options: ['ê±°ì˜ ì•ˆ í•¨', 'ì£¼ 1íšŒ', 'ì£¼ 2-3íšŒ', 'ì£¼ 4íšŒ ì´ìƒ']}, {id: 2, type: 'checkbox', question: 'ì„ í˜¸í•˜ëŠ” ìš´ë™ ì¢…ë¥˜ëŠ”? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ê±·ê¸°/ëŸ¬ë‹', 'í—¬ìŠ¤/ì›¨ì´íŠ¸', 'ìˆ˜ì˜', 'ìš”ê°€/í•„ë¼í…ŒìŠ¤', 'êµ¬ê¸°ì¢…ëª©', 'ìì „ê±°']}, {id: 3, type: 'radio', question: 'ìš´ë™í•˜ëŠ” ì£¼ëœ ì´ìœ ëŠ”?', required: true, options: ['ê±´ê°• ê´€ë¦¬', 'ë‹¤ì´ì–´íŠ¸', 'ì²´ë ¥ ì¦ì§„', 'ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ', 'ì·¨ë¯¸']}]},
                    {id: 'sample6', creatorId: 'system', title: 'ğŸ• ìŒì‹ ì„ í˜¸ë„ ì¡°ì‚¬', description: 'ì¢‹ì•„í•˜ëŠ” ìŒì‹ê³¼ ì‹ì‚¬ ìŠµê´€ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', targetResponses: 150, rewardPoints: 60, targetRegion: '', targetJob: 'í•™ìƒ', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'checkbox', question: 'ì¢‹ì•„í•˜ëŠ” ìŒì‹ ì¢…ë¥˜ëŠ”? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['í•œì‹', 'ì¤‘ì‹', 'ì¼ì‹', 'ì–‘ì‹', 'ë¶„ì‹', 'íŒ¨ìŠ¤íŠ¸í‘¸ë“œ']}, {id: 2, type: 'radio', question: 'í•˜ë£¨ í‰ê·  ì™¸ì‹ íšŸìˆ˜ëŠ”?', required: true, options: ['ê±°ì˜ ì•ˆ í•¨', '1íšŒ', '2íšŒ', '3íšŒ ì´ìƒ']}, {id: 3, type: 'select', question: 'ì‹ì‚¬ ë©”ë‰´ ì„ íƒ ì‹œ ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†ŒëŠ”?', required: true, options: ['ë§›', 'ê°€ê²©', 'ê±´ê°•', 'í¸ì˜ì„±', 'ë¶„ìœ„ê¸°']}]},
                    {id: 'sample7', creatorId: 'system', title: 'ğŸš— ì¶œí‡´ê·¼/í†µí•™ ìˆ˜ë‹¨ ì„¤ë¬¸', description: 'ì¼ìƒì ì¸ ì´ë™ ìˆ˜ë‹¨ê³¼ ì†Œìš” ì‹œê°„ì— ëŒ€í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', targetResponses: 120, rewardPoints: 90, targetRegion: 'ê²½ê¸°', targetJob: '', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'radio', question: 'ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì´ë™ ìˆ˜ë‹¨ì€?', required: true, options: ['ì§€í•˜ì² ', 'ë²„ìŠ¤', 'ìê°€ìš©', 'ë„ë³´', 'ìì „ê±°/í‚¥ë³´ë“œ', 'íƒì‹œ/ì¹´í’€']}, {id: 2, type: 'radio', question: 'í‰ê·  í†µê·¼/í†µí•™ ì‹œê°„ì€?', required: true, options: ['30ë¶„ ë¯¸ë§Œ', '30ë¶„-1ì‹œê°„', '1-2ì‹œê°„', '2ì‹œê°„ ì´ìƒ']}, {id: 3, type: 'checkbox', question: 'ì´ë™ ì¤‘ ì£¼ë¡œ í•˜ëŠ” í™œë™ì€? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ìŠ¤ë§ˆíŠ¸í° ì‚¬ìš©', 'ìŒì•… ë“£ê¸°', 'ë…ì„œ', 'ìˆ˜ë©´', 'ì—…ë¬´/ê³µë¶€', 'ì•„ë¬´ê²ƒë„ ì•ˆ í•¨']}]},
                    {id: 'sample8', creatorId: 'system', title: 'ğŸ¨ ì·¨ë¯¸ ìƒí™œ ì¡°ì‚¬', description: 'ì—¬ê°€ ì‹œê°„ í™œìš©ê³¼ ì·¨ë¯¸ í™œë™ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', targetResponses: 100, rewardPoints: 70, targetRegion: '', targetJob: '', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'checkbox', question: 'í˜„ì¬ ì¦ê¸°ëŠ” ì·¨ë¯¸ëŠ”? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ìš´ë™', 'ë…ì„œ', 'ì˜í™”/ë“œë¼ë§ˆ', 'ê²Œì„', 'ìš”ë¦¬', 'ì—¬í–‰', 'ìŒì•… ê°ìƒ', 'ì‚¬ì§„/ì˜ìƒ']}, {id: 2, type: 'radio', question: 'ì£¼ë§ì— ì·¨ë¯¸ í™œë™ì— í• ì• í•˜ëŠ” ì‹œê°„ì€?', required: true, options: ['1ì‹œê°„ ë¯¸ë§Œ', '1-3ì‹œê°„', '3-5ì‹œê°„', '5ì‹œê°„ ì´ìƒ']}, {id: 3, type: 'text', question: 'ìƒˆë¡­ê²Œ ì‹œì‘í•˜ê³  ì‹¶ì€ ì·¨ë¯¸ê°€ ìˆë‹¤ë©´?', required: false}]},
                    {id: 'sample9', creatorId: 'system', title: 'ğŸ¥ ê±´ê°•ê´€ë¦¬ ì‹¤íƒœ ì¡°ì‚¬', description: 'ê±´ê°• ê´€ë¦¬ì™€ ìƒí™œ ìŠµê´€ì— ëŒ€í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', targetResponses: 80, rewardPoints: 110, targetRegion: '', targetJob: 'ì „ë¬¸ì§', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'radio', question: 'í‰ê·  ìˆ˜ë©´ ì‹œê°„ì€?', required: true, options: ['5ì‹œê°„ ë¯¸ë§Œ', '5-6ì‹œê°„', '7-8ì‹œê°„', '8ì‹œê°„ ì´ìƒ']}, {id: 2, type: 'checkbox', question: 'ê±´ê°•ì„ ìœ„í•´ ì‹¤ì²œí•˜ëŠ” ê²ƒì€? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ê·œì¹™ì ì¸ ìš´ë™', 'ê±´ê°•ì‹ ì„­ì·¨', 'ì¶©ë¶„í•œ ìˆ˜ë©´', 'ê¸ˆì—°/ê¸ˆì£¼', 'ê±´ê°•ê²€ì§„', 'íŠ¹ë³„íˆ ì—†ìŒ']}, {id: 3, type: 'radio', question: 'ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ì€?', required: true, options: ['ë§¤ìš° ë†’ìŒ', 'ë†’ìŒ', 'ë³´í†µ', 'ë‚®ìŒ', 'ë§¤ìš° ë‚®ìŒ']}]}
                ];
                localStorage.setItem('surveys', JSON.stringify(sampleSurveys));
                localStorage.setItem('surveyVersion', '5.0');
            }
        }

        function showScreen(screenId) {
            const screens = ['welcomeScreen', 'loginScreen', 'registerScreen', 'dashboardScreen', 'createSurveyScreen', 'participateScreen', 'giftShopScreen'];
            screens.forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
        }

        function showLogin() { showScreen('loginScreen'); }
        function showRegister() { showScreen('registerScreen'); }

        function updatePoints() {
            const points = currentUser.points || 0;
            ['userPoints', 'userPoints2', 'userPoints3', 'userPoints4'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = `ğŸ’° ${points.toLocaleString()} P`;
            });
            const display = document.getElementById('userPointsDisplay');
            if (display) display.textContent = points.toLocaleString();
            const currentPointsEl = document.getElementById('currentPoints');
            if (currentPointsEl) currentPointsEl.textContent = points.toLocaleString();
        }

        function register() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const phone = document.getElementById('regPhone').value;
            const birthDate = document.getElementById('regBirthDate').value;
            const region = document.getElementById('regRegion').value;
            const job = document.getElementById('regJob').value;

            if (!name || !email || !password || !phone || !birthDate || !region || !job) {
                document.getElementById('registerMessage').innerHTML = '<div class="error-msg">ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
                return;
            }
            if (password.length < 8) {
                document.getElementById('registerMessage').innerHTML = '<div class="error-msg">ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.</div>';
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            if (users.find(u => u.email === email)) {
                document.getElementById('registerMessage').innerHTML = '<div class="error-msg">ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.</div>';
                return;
            }

            users.push({
                id: Date.now().toString(),
                name, email, password, phone, birthDate, region, job,
                points: 1000,
                createdAt: new Date().toISOString()
            });
            localStorage.setItem('users', JSON.stringify(users));
            document.getElementById('registerMessage').innerHTML = '<div class="success-msg">ğŸ‰ íšŒì›ê°€ì… ì™„ë£Œ! 1,000P ì§€ê¸‰!</div>';
            setTimeout(() => showLogin(), 2000);
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                document.getElementById('loginMessage').innerHTML = '<div class="error-msg">ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>';
                return;
            }

            let users = JSON.parse(localStorage.getItem('users') || '[]');

            if (email === 'test@example.com' && !users.find(u => u.email === email)) {
                users.push({
                    id: 'test-user', name: 'í…ŒìŠ¤í„°', email: 'test@example.com', password: 'password123',
                    phone: '010-1234-5678', birthDate: '1990-01-01', region: 'ì„œìš¸', job: 'íšŒì‚¬ì›',
                    points: 5000, createdAt: new Date().toISOString()
                });
                localStorage.setItem('users', JSON.stringify(users));
            }

            const user = users.find(u => u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                showDashboard();
            } else {
                document.getElementById('loginMessage').innerHTML = '<div class="error-msg">ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>';
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            editMode = false;
            linksLocked = false;
            showScreen('welcomeScreen');
        }

        function showDashboard() {
            showScreen('dashboardScreen');
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userInfo').innerHTML = `ğŸ“§ ${currentUser.email} | ğŸ“ ${currentUser.region} | ğŸ’¼ ${currentUser.job}`;
            updatePoints();
            updateDashboardStats();
            loadMySurveys();
            loadAvailableSurveys();

            // í¸ì§‘ ëª¨ë“œ ìƒíƒœ ìœ ì§€
            if (editMode) {
                document.getElementById('editModeText').textContent = 'ë¹„ì£¼ì–¼ ìˆ˜ì • ëª¨ë“œ ë¹„í™œì„±í™”';
                document.getElementById('editModeTextNav').textContent = 'âœï¸ í¸ì§‘ì¤‘';
                document.getElementById('editStatus').textContent = 'í¸ì§‘ ëª¨ë“œ: í™œì„±';
                document.getElementById('editStatus').classList.remove('inactive');
                document.getElementById('editStatus').classList.add('active');
                document.getElementById('editIndicator').style.display = 'block';
                document.getElementById('linkLockBtn').disabled = false;
            } else {
                document.getElementById('linkLockBtn').disabled = true;
            }
        }

        function updateDashboardStats() {
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            const mySurveys = surveys.filter(s => s.creatorId === currentUser.id);
            const participations = JSON.parse(localStorage.getItem('participations') || '[]');
            const myParticipations = participations.filter(p => p.userId === currentUser.id);
            const availableSurveys = surveys.filter(s => {
                if (s.creatorId === currentUser.id) return false;
                if (myParticipations.find(p => p.surveyId === s.id)) return false;
                if (s.targetRegion && s.targetRegion !== currentUser.region) return false;
                if (s.targetJob && s.targetJob !== currentUser.job) return false;
                return true;
            });

            document.getElementById('mySurveysCount').textContent = mySurveys.length;
            document.getElementById('availableSurveysCount').textContent = availableSurveys.length;
            document.getElementById('completedSurveysCount').textContent = myParticipations.length;
        }

        function loadMySurveys() {
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            const mySurveys = surveys.filter(s => s.creatorId === currentUser.id);
            const list = document.getElementById('mySurveysList');

            if (mySurveys.length === 0) {
                list.innerHTML = '<p style="color: #999; margin-top: 15px;">ì•„ì§ ë§Œë“  ì„¤ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = mySurveys.map(survey => `
                <div class="survey-item" onclick="viewMySurveyDetail('${survey.id}')">
                    <div class="survey-title">${survey.title}</div>
                    <div class="survey-desc">${survey.description}</div>
                    <div class="survey-info">
                        <span>ëª©í‘œ: ${survey.targetResponses}ëª…</span>
                        <span>ë³´ìƒ: ${survey.rewardPoints}P</span>
                    </div>
                </div>
            `).join('');

            // í¸ì§‘ ëª¨ë“œê°€ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ í¸ì§‘ ê°€ëŠ¥í•˜ê²Œ
            if (editMode) {
                document.querySelectorAll('.survey-item').forEach(card => {
                    card.classList.add('editable');
                    card.setAttribute('contenteditable', 'true');
                    if (linksLocked) {
                        card.classList.add('link-locked');
                    }
                });
            }
        }

        function loadAvailableSurveys() {
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            const participations = JSON.parse(localStorage.getItem('participations') || '[]');
            const myParticipations = participations.filter(p => p.userId === currentUser.id);
            const available = surveys.filter(s => {
                if (s.creatorId === currentUser.id) return false;
                if (myParticipations.find(p => p.surveyId === s.id)) return false;
                if (s.targetRegion && s.targetRegion !== currentUser.region) return false;
                if (s.targetJob && s.targetJob !== currentUser.job) return false;
                return true;
            });

            const list = document.getElementById('availableSurveysList');
            if (available.length === 0) {
                list.innerHTML = '<p style="color: #999; margin-top: 15px;">í˜„ì¬ ì°¸ì—¬ ê°€ëŠ¥í•œ ì„¤ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = available.map(survey => `
                <div class="survey-item" onclick="startSurveyParticipation('${survey.id}')">
                    <div class="survey-title">${survey.title} <span class="badge">ì°¸ì—¬ ê°€ëŠ¥</span></div>
                    <div class="survey-desc">${survey.description}</div>
                    <div class="survey-info">
                        <span>ğŸ ë³´ìƒ: ${survey.rewardPoints}P</span>
                        <span class="badge badge-points">+${survey.rewardPoints}P</span>
                    </div>
                </div>
            `).join('');

            // í¸ì§‘ ëª¨ë“œê°€ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ í¸ì§‘ ê°€ëŠ¥í•˜ê²Œ
            if (editMode) {
                document.querySelectorAll('.survey-item').forEach(card => {
                    card.classList.add('editable');
                    card.setAttribute('contenteditable', 'true');
                    if (linksLocked) {
                        card.classList.add('link-locked');
                    }
                });
            }
        }

        function showCreateSurvey() {
            showScreen('createSurveyScreen');
            updatePoints();
            questions = [];
            questionCounter = 0;
            document.getElementById('questionsContainer').innerHTML = '';
            addQuestion();
        }

        function addQuestion() {
            questionCounter++;
            const questionId = questionCounter;
            const questionHtml = `
                <div class="question-item" id="question${questionId}">
                    <div class="question-header">
                        <h4>ì§ˆë¬¸ ${questionId}</h4>
                        <div class="question-controls">
                            <button type="button" class="btn btn-small btn-danger" onclick="removeQuestion(${questionId})">ì‚­ì œ</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ì§ˆë¬¸ ë‚´ìš©</label>
                        <input type="text" id="qText${questionId}" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ì§ˆë¬¸ ìœ í˜•</label>
                        <select id="qType${questionId}" onchange="updateQuestionType(${questionId})">
                            <option value="radio">ê°ê´€ì‹ (ë‹¨ì¼ì„ íƒ)</option>
                            <option value="checkbox">ì²´í¬ë°•ìŠ¤ (ë³µìˆ˜ì„ íƒ)</option>
                            <option value="select">ë“œë¡­ë‹¤ìš´</option>
                            <option value="text">ë‹¨ë‹µí˜•</option>
                            <option value="textarea">ì¥ë¬¸í˜•</option>
                        </select>
                    </div>
                    <div id="optionsContainer${questionId}" class="form-group">
                        <label>ì„ íƒì§€</label>
                        <div id="options${questionId}">
                            <div class="option-item">
                                <input type="text" class="option-input" placeholder="ì„ íƒì§€ 1">
                                <button type="button" class="btn btn-small btn-primary" onclick="addOption(${questionId})">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" id="qRequired${questionId}" checked> í•„ìˆ˜ ì§ˆë¬¸</label>
                    </div>
                </div>
            `;
            document.getElementById('questionsContainer').insertAdjacentHTML('beforeend', questionHtml);
        }

        function removeQuestion(questionId) {
            document.getElementById(`question${questionId}`).remove();
        }

        function updateQuestionType(questionId) {
            const type = document.getElementById(`qType${questionId}`).value;
            const optionsContainer = document.getElementById(`optionsContainer${questionId}`);
            optionsContainer.style.display = (type === 'text' || type === 'textarea') ? 'none' : 'block';
        }

        function addOption(questionId) {
            const container = document.getElementById(`options${questionId}`);
            const optionCount = container.children.length + 1;
            const optionHtml = `
                <div class="option-item">
                    <input type="text" class="option-input" placeholder="ì„ íƒì§€ ${optionCount}">
                    <button type="button" class="btn btn-small btn-danger" onclick="this.parentElement.remove()">-</button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', optionHtml);
        }

        function createSurvey() {
            const title = document.getElementById('surveyTitle').value;
            const description = document.getElementById('surveyDesc').value;
            const targetResponses = document.getElementById('surveyTarget').value;
            const rewardPoints = parseInt(document.getElementById('surveyRewardPoints').value) || 0;
            const targetRegion = document.getElementById('surveyTargetRegion').value;
            const targetJob = document.getElementById('surveyTargetJob').value;

            if (!title || !description) {
                document.getElementById('createMessage').innerHTML = '<div class="error-msg">ì œëª©ê³¼ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.</div>';
                return;
            }

            const collectedQuestions = [];
            const questionElements = document.querySelectorAll('.question-item');

            questionElements.forEach((el, index) => {
                const id = el.id.replace('question', '');
                const text = document.getElementById(`qText${id}`).value;
                const type = document.getElementById(`qType${id}`).value;
                const required = document.getElementById(`qRequired${id}`).checked;

                if (!text) return;

                const question = {id: index + 1, type: type, question: text, required: required};

                if (type === 'radio' || type === 'checkbox' || type === 'select') {
                    const optionInputs = document.querySelectorAll(`#options${id} .option-input`);
                    const options = Array.from(optionInputs).map(input => input.value).filter(val => val.trim() !== '');
                    if (options.length === 0) {
                        alert(`ì§ˆë¬¸ ${index + 1}ì— ì„ íƒì§€ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.`);
                        return;
                    }
                    question.options = options;
                }

                collectedQuestions.push(question);
            });

            if (collectedQuestions.length === 0) {
                document.getElementById('createMessage').innerHTML = '<div class="error-msg">ìµœì†Œ 1ê°œ ì´ìƒì˜ ì§ˆë¬¸ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.</div>';
                return;
            }

            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            surveys.push({
                id: Date.now().toString(),
                creatorId: currentUser.id,
                title, description, targetResponses, rewardPoints,
                targetRegion, targetJob,
                questions: collectedQuestions,
                createdAt: new Date().toISOString(),
                participants: 0
            });

            localStorage.setItem('surveys', JSON.stringify(surveys));
            document.getElementById('createMessage').innerHTML = '<div class="success-msg">ì„¤ë¬¸ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
            setTimeout(() => showDashboard(), 1500);
        }

        function startSurveyParticipation(surveyId) {
            // í¸ì§‘ ëª¨ë“œì´ê³  ë§í¬ê°€ ì ê²¨ìˆìœ¼ë©´ í˜ì´ì§€ ì´ë™ ì•ˆ í•¨
            if (editMode && linksLocked) {
                return;
            }

            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            currentSurvey = surveys.find(s => s.id === surveyId);

            showScreen('participateScreen');
            updatePoints();

            document.getElementById('participateTitle').textContent = currentSurvey.title;
            document.getElementById('participateDesc').textContent = currentSurvey.description;
            document.getElementById('participateReward').innerHTML = `<strong>ğŸ’° ì°¸ì—¬ ë³´ìƒ: ${currentSurvey.rewardPoints} í¬ì¸íŠ¸</strong><br><small>ì„¤ë¬¸ ì™„ë£Œ ì‹œ ìë™ìœ¼ë¡œ í¬ì¸íŠ¸ê°€ ì§€ê¸‰ë©ë‹ˆë‹¤.</small>`;

            const questionsHtml = currentSurvey.questions.map(q => {
                let inputHtml = '';
                switch(q.type) {
                    case 'radio':
                        inputHtml = `<div class="answer-form">${q.options.map(opt => `<label class="answer-option"><input type="radio" name="q${q.id}" value="${opt}" ${q.required ? 'required' : ''}>${opt}</label>`).join('')}</div>`;
                        break;
                    case 'checkbox':
                        inputHtml = `<div class="answer-form">${q.options.map(opt => `<label class="answer-option"><input type="checkbox" name="q${q.id}" value="${opt}">${opt}</label>`).join('')}</div>`;
                        break;
                    case 'select':
                        inputHtml = `<div class="answer-form"><select name="q${q.id}" class="answer-input" ${q.required ? 'required' : ''}><option value="">ì„ íƒí•˜ì„¸ìš”</option>${q.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}</select></div>`;
                        break;
                    case 'text':
                        inputHtml = `<div class="answer-form"><input type="text" name="q${q.id}" class="answer-input" placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”" ${q.required ? 'required' : ''}></div>`;
                        break;
                    case 'textarea':
                        inputHtml = `<div class="answer-form"><textarea name="q${q.id}" class="answer-input" rows="4" placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”" ${q.required ? 'required' : ''}></textarea></div>`;
                        break;
                }
                return `<div class="question-item"><p><strong>ì§ˆë¬¸ ${q.id}. ${q.question}</strong> ${q.required ? '<span style="color: red;">*</span>' : ''}</p>${inputHtml}</div>`;
            }).join('');

            document.getElementById('participateQuestions').innerHTML = questionsHtml;
        }

        function submitSurveyAnswers() {
            const form = document.getElementById('participateForm');
            if (!form.checkValidity()) {
                alert('í•„ìˆ˜ ì§ˆë¬¸ì— ëª¨ë‘ ì‘ë‹µí•´ì£¼ì„¸ìš”.');
                return;
            }

            const answers = {};
            currentSurvey.questions.forEach(q => {
                if (q.type === 'checkbox') {
                    answers[q.id] = Array.from(document.querySelectorAll(`input[name="q${q.id}"]:checked`)).map(input => input.value);
                } else {
                    const input = document.querySelector(`[name="q${q.id}"]`);
                    if (input.type === 'radio') {
                        const selected = document.querySelector(`input[name="q${q.id}"]:checked`);
                        answers[q.id] = selected ? selected.value : '';
                    } else {
                        answers[q.id] = input.value;
                    }
                }
            });

            const participations = JSON.parse(localStorage.getItem('participations') || '[]');
            participations.push({
                id: Date.now().toString(),
                surveyId: currentSurvey.id,
                userId: currentUser.id,
                answers: answers,
                completedAt: new Date().toISOString()
            });
            localStorage.setItem('participations', JSON.stringify(participations));

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].points = (users[userIndex].points || 0) + currentSurvey.rewardPoints;
                localStorage.setItem('users', JSON.stringify(users));
                currentUser.points = users[userIndex].points;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }

            alert(`ğŸ‰ ì„¤ë¬¸ ì°¸ì—¬ ì™„ë£Œ!\nğŸ’° ${currentSurvey.rewardPoints} í¬ì¸íŠ¸ ì§€ê¸‰!`);
            showDashboard();
        }

        function viewMySurveyDetail(surveyId) {
            // í¸ì§‘ ëª¨ë“œì´ê³  ë§í¬ê°€ ì ê²¨ìˆìœ¼ë©´ í˜ì´ì§€ ì´ë™ ì•ˆ í•¨
            if (editMode && linksLocked) {
                return;
            }

            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            const survey = surveys.find(s => s.id === surveyId);
            const participations = JSON.parse(localStorage.getItem('participations') || '[]');
            const surveyParticipations = participations.filter(p => p.surveyId === surveyId);
            alert(`ì„¤ë¬¸ ìƒì„¸\n\nì œëª©: ${survey.title}\nì°¸ì—¬ì: ${surveyParticipations.length}ëª…\nëª©í‘œ: ${survey.targetResponses}ëª…\në³´ìƒ: ${survey.rewardPoints}P`);
        }

        // ìƒí’ˆ êµí™˜ì†Œ ê´€ë ¨ í•¨ìˆ˜
        function showGiftShop() {
            showScreen('giftShopScreen');
            updatePoints();
            loadProducts();
            switchGiftTab('products');
        }

        function switchGiftTab(tabName) {
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => tab.classList.remove('active'));

            if (tabName === 'products') {
                tabs[0].classList.add('active');
                document.getElementById('productsTab').classList.remove('hidden');
                document.getElementById('historyTab').classList.add('hidden');
                loadProducts();
            } else {
                tabs[1].classList.add('active');
                document.getElementById('productsTab').classList.add('hidden');
                document.getElementById('historyTab').classList.remove('hidden');
                loadExchangeHistory();
            }
        }

        function loadProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = giftProducts.map(product => `
                <div class="product-item" onclick="confirmExchange('${product.id}')">
                    <div class="product-icon">${product.icon}</div>
                    <div class="product-name">${product.name} ${product.popular ? '<span class="badge badge-popular">ì¸ê¸°</span>' : ''}</div>
                    <div class="product-price">${product.price.toLocaleString()} P</div>
                    <div class="product-desc">${product.description}</div>
                    <div class="product-stock ${product.stock ? '' : 'out-of-stock'}">${product.stock ? 'âœ… êµí™˜ ê°€ëŠ¥' : 'âŒ í’ˆì ˆ'}</div>
                    <button class="btn btn-success btn-small" onclick="event.stopPropagation(); confirmExchange('${product.id}')" ${!product.stock ? 'disabled' : ''}>êµí™˜í•˜ê¸°</button>
                </div>
            `).join('');
        }

        function confirmExchange(productId) {
            const product = giftProducts.find(p => p.id === productId);
            if (!product || !product.stock) {
                alert('âŒ í˜„ì¬ í’ˆì ˆëœ ìƒí’ˆì…ë‹ˆë‹¤.');
                return;
            }

            if (currentUser.points < product.price) {
                alert(`âŒ í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.\n\ní•„ìš” í¬ì¸íŠ¸: ${product.price.toLocaleString()} P\në³´ìœ  í¬ì¸íŠ¸: ${currentUser.points.toLocaleString()} P\në¶€ì¡± í¬ì¸íŠ¸: ${(product.price - currentUser.points).toLocaleString()} P`);
                return;
            }

            if (confirm(`${product.icon} ${product.name}\nê°€ê²©: ${product.price.toLocaleString()} P\n\ní¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ êµí™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€» êµí™˜ í›„ ë‚¨ì€ í¬ì¸íŠ¸: ${(currentUser.points - product.price).toLocaleString()} P`)) {
                exchangeProduct(product);
            }
        }

        function exchangeProduct(product) {
            // í¬ì¸íŠ¸ ì°¨ê°
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].points = currentUser.points - product.price;
                localStorage.setItem('users', JSON.stringify(users));
                currentUser.points = users[userIndex].points;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }

            // êµí™˜ ë‚´ì—­ ì €ì¥
            const exchanges = JSON.parse(localStorage.getItem('exchanges') || '[]');
            exchanges.push({
                id: Date.now().toString(),
                userId: currentUser.id,
                productId: product.id,
                productName: product.name,
                productIcon: product.icon,
                price: product.price,
                exchangedAt: new Date().toISOString(),
                status: 'completed'
            });
            localStorage.setItem('exchanges', JSON.stringify(exchanges));

            updatePoints();
            alert(`ğŸ‰ êµí™˜ ì™„ë£Œ!\n\n${product.icon} ${product.name}\n\nâ€» êµí™˜ê¶Œì€ ë“±ë¡í•˜ì‹  ì´ë©”ì¼ë¡œ ë°œì†¡ë©ë‹ˆë‹¤.\nâ€» ë‚¨ì€ í¬ì¸íŠ¸: ${currentUser.points.toLocaleString()} P`);
            loadProducts();
        }

        function loadExchangeHistory() {
            const exchanges = JSON.parse(localStorage.getItem('exchanges') || '[]');
            const myExchanges = exchanges.filter(e => e.userId === currentUser.id).reverse();
            const list = document.getElementById('exchangeHistoryList');

            if (myExchanges.length === 0) {
                list.innerHTML = '<p style="color: #999; margin-top: 15px; text-align: center;">ì•„ì§ êµí™˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = myExchanges.map(exchange => `
                <div class="exchange-history-item">
                    <div class="exchange-date">${new Date(exchange.exchangedAt).toLocaleString('ko-KR')}</div>
                    <div class="exchange-product">${exchange.productIcon} ${exchange.productName}</div>
                    <div class="exchange-points">-${exchange.price.toLocaleString()} P</div>
                </div>
            `).join('');
        }

        function showMySurveys() { showDashboard(); }
        function showAvailableSurveys() { showDashboard(); }

        // ë¹„ì£¼ì–¼ ìˆ˜ì • ëª¨ë“œ í† ê¸€
        function toggleEditMode() {
            editMode = !editMode;
            const editModeText = document.getElementById('editModeText');
            const editModeTextNav = document.getElementById('editModeTextNav');
            const editStatus = document.getElementById('editStatus');
            const editIndicator = document.getElementById('editIndicator');

            if (editMode) {
                editModeText.textContent = 'ë¹„ì£¼ì–¼ ìˆ˜ì • ëª¨ë“œ ë¹„í™œì„±í™”';
                editModeTextNav.textContent = 'âœï¸ í¸ì§‘ì¤‘';
                editStatus.textContent = 'í¸ì§‘ ëª¨ë“œ: í™œì„±';
                editStatus.classList.remove('inactive');
                editStatus.classList.add('active');
                editIndicator.style.display = 'block';

                // ëª¨ë“  ì¹´ë“œë¥¼ í¸ì§‘ ê°€ëŠ¥í•˜ê²Œ
                document.querySelectorAll('.survey-card, .survey-item').forEach(card => {
                    card.classList.add('editable');
                    card.setAttribute('contenteditable', 'true');
                });

                // ìƒì„¸ í˜ì´ì§€ì˜ ìš”ì†Œë“¤ë„ í¸ì§‘ ê°€ëŠ¥í•˜ê²Œ
                document.querySelectorAll('.question-item').forEach(el => {
                    el.classList.add('editable');
                    el.setAttribute('contenteditable', 'true');
                });

                // ë§í¬ ì ê¸ˆ ë²„íŠ¼ í™œì„±í™”
                document.getElementById('linkLockBtn').disabled = false;
            } else {
                editModeText.textContent = 'ë¹„ì£¼ì–¼ ìˆ˜ì • ëª¨ë“œ í™œì„±í™”';
                editModeTextNav.textContent = 'âœï¸ í¸ì§‘ëª¨ë“œ';
                editStatus.textContent = 'í¸ì§‘ ëª¨ë“œ: ë¹„í™œì„±';
                editStatus.classList.remove('active');
                editStatus.classList.add('inactive');
                editIndicator.style.display = 'none';

                // í¸ì§‘ ëª¨ë“œ í•´ì œ
                document.querySelectorAll('[contenteditable="true"]').forEach(el => {
                    el.classList.remove('editable');
                    el.setAttribute('contenteditable', 'false');
                });

                // ë§í¬ ì ê¸ˆë„ í•´ì œ
                if (linksLocked) {
                    toggleLinkLock();
                }

                document.getElementById('linkLockBtn').disabled = true;
            }
        }

        // ë§í¬ ì ê¸ˆ/í•´ì œ
        function toggleLinkLock() {
            if (!editMode) {
                alert('ë¨¼ì € ë¹„ì£¼ì–¼ ìˆ˜ì • ëª¨ë“œë¥¼ í™œì„±í™”í•´ì£¼ì„¸ìš”.');
                return;
            }

            linksLocked = !linksLocked;
            const linkLockText = document.getElementById('linkLockText');
            const linkStatus = document.getElementById('linkStatus');

            if (linksLocked) {
                linkLockText.textContent = 'ë§í¬ ì ê¸ˆ í•´ì œ';
                linkStatus.textContent = 'ë§í¬: ì ê¸ˆ';
                linkStatus.classList.remove('inactive');
                linkStatus.classList.add('locked');

                document.querySelectorAll('.survey-card, .survey-item').forEach(card => {
                    card.classList.add('link-locked');
                });
            } else {
                linkLockText.textContent = 'ë§í¬ ì ê¸ˆ';
                linkStatus.textContent = 'ë§í¬: í™œì„±';
                linkStatus.classList.remove('locked');
                linkStatus.classList.add('inactive');

                document.querySelectorAll('.survey-card, .survey-item').forEach(card => {
                    card.classList.remove('link-locked');
                });
            }
        }

        // ì´ˆê¸° ì„¤ì •
        window.onload = init;
    </script>
</body>
</html>
