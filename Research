<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¤ë¬¸ ë§¤ì¹­ í”Œë«í¼ - ë°ëª¨ v5.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #E8EEF2 0%, #D5DDE5 50%, #C7D3DD 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e0e0e0;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #5B7C99;
            flex-shrink: 0;
        }
        .user-info-header {
            display: flex;
            gap: 15px;
            align-items: center;
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }
        .nav { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
        .points-badge {
            background: #ffd700;
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        .nav-btn {
            padding: 8px 16px;
            background: #5B7C99;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        .nav-btn:hover { background: #4A6A85; }
        .btn-reset {
            background: #dc3545;
            padding: 6px 12px;
            font-size: 12px;
        }
        .btn-reset:hover { background: #c82333; }
        .card {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.12), 0 2px 6px rgba(0,0,0,0.04);
            margin-bottom: 20px;
            border: 1px solid rgba(102, 126, 234, 0.08);
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.16), 0 4px 12px rgba(0,0,0,0.06);
            transform: translateY(-2px);
        }
        .card h2 { margin-bottom: 20px; color: #1a1a2e; font-weight: 700; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #555; font-weight: 500; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .btn {
            padding: 12px 24px;
            background: #5B7C99;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            margin-right: 10px;
            transition: all 0.2s ease;
        }
        .btn:hover { background: #4A6A85; }
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        .btn-small { padding: 6px 12px; font-size: 14px; }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .survey-item, .product-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
            margin-bottom: 18px;
        }
        .survey-item:hover, .product-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            border-color: #5B7C99;
        }
        .survey-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333; }
        .survey-desc { color: #666; font-size: 14px; margin-bottom: 10px; }
        .survey-info { font-size: 12px; color: #999; }
        .product-item {
            border: 2px solid #e9ecef;
            position: relative;
        }
        .product-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 15px;
        }
        .product-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
            text-align: center;
        }
        .product-price {
            font-size: 24px;
            font-weight: bold;
            color: #5B7C99;
            text-align: center;
            margin-bottom: 10px;
        }
        .product-desc {
            font-size: 13px;
            color: #666;
            text-align: center;
            margin-bottom: 15px;
        }
        .product-stock {
            font-size: 12px;
            color: #28a745;
            text-align: center;
            margin-bottom: 10px;
        }
        .product-stock.out-of-stock {
            color: #dc3545;
        }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            background: #28a745;
            color: white;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 10px;
        }
        .badge-points { background: #ffd700; color: #333; }
        .badge-popular { background: #ff6b6b; color: white; }
        .hidden { display: none; }
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            color: #333;
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            border-color: #5B7C99;
        }
        .stat-number { font-size: 36px; font-weight: bold; margin-bottom: 5px; color: #5B7C99; }
        .stat-label { font-size: 14px; color: #666; }
        .user-info { color: #333; font-size: 14px; }
        .success-msg {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
            border: 1px solid #c3e6cb;
        }
        .error-msg {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
            border: 1px solid #f5c6cb;
        }
        .question-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.1);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.06);
            transition: all 0.2s ease;
        }
        .question-item:hover {
            border-color: rgba(102, 126, 234, 0.2);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .question-controls { display: flex; gap: 10px; }
        .option-item { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .option-input { flex: 1; }
        .welcome { text-align: center; padding: 50px 20px; color: #1a1a2e; }
        .welcome h1 {
            font-size: 48px;
            margin-bottom: 20px;
            color: #5B7C99;
            font-weight: 800;
        }
        .welcome p { font-size: 20px; margin-bottom: 30px; color: #4a4a6a; }
        .answer-form { background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 10px; }
        .answer-option { display: block; padding: 10px; margin: 5px 0; }
        .answer-option input[type="radio"], .answer-option input[type="checkbox"] { margin-right: 10px; }
        .answer-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-top: 5px; }
        .version-info {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            color: #666;
        }
        .rating-badge {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            position: relative;
            cursor: help;
        }
        .rating-tooltip {
            display: none;
            position: absolute;
            top: 45px;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: normal;
            width: 280px;
            z-index: 1000;
            line-height: 1.6;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .rating-badge:hover .rating-tooltip {
            display: block;
        }
        .rating-tooltip::before {
            content: '';
            position: absolute;
            top: -8px;
            right: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid rgba(0, 0, 0, 0.9);
        }
        .exchange-history-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #5B7C99;
        }
        .exchange-date {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
        }
        .exchange-product {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .exchange-points {
            font-size: 14px;
            color: #dc3545;
        }
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab-btn {
            padding: 10px 20px;
            background: #e9ecef;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            color: #495057;
        }
        .tab-btn.active {
            background: #5B7C99;
            color: white;
        }
        .featured-banner {
            background: linear-gradient(135deg, #7B9FB8 0%, #5B7C99 100%);
            padding: 20px 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .featured-banner:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .featured-tag {
            display: inline-block;
            background: #FFD700;
            color: #333;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .featured-title {
            font-size: 20px;
            font-weight: bold;
            color: white;
            margin-bottom: 8px;
        }
        .featured-desc {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
        }
        .featured-info {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }
    </style>
</head>
<body>
    <div class="version-info">v5.0 âœ¨</div>

    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="container">
        <div class="welcome">
            <h1>ğŸ¯ ì„¤ë¬¸ ë§¤ì¹­ í”Œë«í¼</h1>
            <p>ì„¤ë¬¸ ì˜ë¢°ìì™€ ì°¸ì—¬ìë¥¼ ì—°ê²°í•˜ëŠ” ìŠ¤ë§ˆíŠ¸ í”Œë«í¼</p>
            <p style="font-size: 16px; margin-bottom: 20px;">âœ¨ íšŒì›ê°€ì… ì‹œ 100,000P ì§€ê¸‰! ì„¤ë¬¸ ì°¸ì—¬ë¡œ í¬ì¸íŠ¸ ì ë¦½!</p>
            <p style="font-size: 16px; margin-bottom: 20px;">ğŸ í¬ì¸íŠ¸ë¡œ í‚¤í”„í‹°ì½˜, ë¬¸í™”ìƒí’ˆê¶Œ êµí™˜ ê°€ëŠ¥!</p>
            <p style="font-size: 16px; margin-bottom: 20px; color: #5B7C99; font-weight: 600;">ğŸ¯ íƒ€ê²Ÿ ë§¤ì¹­: ë‚˜ì´Â·ì„±ë³„Â·ì§€ì—­ë³„ ë§ì¶¤ ì„¤ë¬¸</p>
            <button class="btn" onclick="showLogin()">ì‹œì‘í•˜ê¸°</button>
            <br><br>
            <p style="font-size: 14px; opacity: 0.8;">ğŸ’¡ v5.0 ë°ëª¨ ë²„ì „ - ë¸Œë¼ìš°ì €ì— ë°ì´í„° ì €ì¥</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="container hidden">
        <div class="card" style="max-width: 400px; margin: 100px auto;">
            <h2>ë¡œê·¸ì¸</h2>
            <div id="loginMessage"></div>
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="loginEmail" placeholder="test@example.com" value="test@example.com">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" value="password123">
            </div>
            <button class="btn" onclick="login()">ë¡œê·¸ì¸</button>
            <button class="btn btn-secondary" onclick="showRegister()">íšŒì›ê°€ì…</button>
            <p style="margin-top: 15px; font-size: 12px; color: #666;">ğŸ’¡ í…ŒìŠ¤íŠ¸: test@example.com / password123</p>
        </div>
    </div>

    <!-- Register Screen -->
    <div id="registerScreen" class="container hidden">
        <div class="card" style="max-width: 500px; margin: 50px auto;">
            <h2>íšŒì›ê°€ì… ğŸ 100,000P ì§€ê¸‰!</h2>
            <div id="registerMessage"></div>
            <div class="form-group">
                <label>ì´ë¦„</label>
                <input type="text" id="regName" placeholder="í™ê¸¸ë™">
            </div>
            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="regEmail" placeholder="test@example.com">
            </div>
            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="regPassword" placeholder="8ì ì´ìƒ">
            </div>
            <div class="form-group">
                <label>ì „í™”ë²ˆí˜¸</label>
                <input type="tel" id="regPhone" placeholder="01012345678" maxlength="11"
                       oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                <small style="color: #666;">ìˆ«ìë§Œ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 01012345678)</small>
            </div>
            <div class="form-group">
                <label>ìƒë…„ì›”ì¼</label>
                <input type="date" id="regBirthDate">
            </div>
            <div class="form-group">
                <label>ì„±ë³„</label>
                <select id="regGender">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ë‚¨ì„±">ë‚¨ì„±</option>
                    <option value="ì—¬ì„±">ì—¬ì„±</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
            </div>
            <div class="form-group">
                <label>ì§€ì—­ (ê´‘ì—­ì‹œë„)</label>
                <select id="regRegionSido" onchange="updateRegionDistricts('reg')">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>
            <div class="form-group">
                <label>ì‹œêµ°êµ¬</label>
                <select id="regRegionDistrict" onchange="updateRegionDongs('reg')" disabled>
                    <option value="">ê´‘ì—­ì‹œë„ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>
            <div class="form-group">
                <label>ìë©´ë™</label>
                <select id="regRegionDong" disabled>
                    <option value="">ì‹œêµ°êµ¬ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>
            <div class="form-group">
                <label>ì§ì—…</label>
                <select id="regJob">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="í•™ìƒ">í•™ìƒ</option>
                    <option value="íšŒì‚¬ì›">íšŒì‚¬ì›</option>
                    <option value="ì „ë¬¸ì§">ì „ë¬¸ì§</option>
                    <option value="ìì˜ì—…">ìì˜ì—…</option>
                    <option value="ì£¼ë¶€">ì£¼ë¶€</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
            </div>

            <div class="form-group">
                <label>ğŸ‘¥ ì¶”ì²œì¸ ì½”ë“œ (ì„ íƒ)</label>
                <input type="text" id="regReferralCode" placeholder="ì¶”ì²œì¸ ì½”ë“œ 6ìë¦¬" maxlength="6"
                       style="text-transform: uppercase;"
                       oninput="this.value = this.value.toUpperCase()">
                <small style="color: #666;">ì¹œêµ¬ ì¶”ì²œ ì½”ë“œê°€ ìˆë‹¤ë©´ ì…ë ¥í•˜ì„¸ìš”. ì„¤ë¬¸ 3ê°œ ì™„ë£Œ ì‹œ ì–‘ì¸¡ ëª¨ë‘ ë³´ìƒ ì§€ê¸‰!</small>
            </div>

            <button class="btn" onclick="register()">ê°€ì…í•˜ê¸°</button>
            <button class="btn btn-secondary" onclick="showLogin()">ë¡œê·¸ì¸ìœ¼ë¡œ</button>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboardScreen" class="container hidden">
        <div class="header">
            <div class="logo">ğŸ¯ ì„¤ë¬¸ ë§¤ì¹­ í”Œë«í¼ v5.0</div>
            <div class="user-info-header">
                <span id="userNameHeader"></span>ë‹˜
                <div class="points-badge" id="userPoints">ğŸ’° 0 P</div>
                <div class="rating-badge" id="userRatingBadge">
                    â­ 0.0
                    <div class="rating-tooltip">
                        <strong>ğŸ“Š í‰ì  ì‹œìŠ¤í…œ ì•ˆë‚´</strong><br><br>
                        <strong>í‰ì  ì‚°ì •:</strong><br>
                        â€¢ ì‹ ê·œ ê°€ì…: 3.0ì  ì‹œì‘<br>
                        â€¢ ì„¤ë¬¸ ì™„ë£Œ: +0.1ì <br>
                        â€¢ ìµœëŒ€ í‰ì : 5.0ì <br><br>
                        <strong>í‰ì  í˜œíƒ:</strong><br>
                        â€¢ 3.0ì  ì´í•˜: ë¬´ë£Œ ì„¤ë¬¸ë§Œ ì°¸ì—¬<br>
                        â€¢ 3.1~4.0ì : ì¼ë°˜ ì„¤ë¬¸ ì°¸ì—¬<br>
                        â€¢ 4.1ì  ì´ìƒ: í”„ë¦¬ë¯¸ì—„ ì„¤ë¬¸ ì°¸ì—¬<br><br>
                        <strong>ğŸ’¡ í‰ì  ì˜¬ë¦¬ëŠ” ë°©ë²•:</strong><br>
                        ì„±ì‹¤í•˜ê²Œ ì„¤ë¬¸ì— ëê¹Œì§€ ì°¸ì—¬í•˜ì„¸ìš”!
                    </div>
                </div>
            </div>
            <div class="nav">
                <button class="nav-btn" onclick="showDashboard()">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="showMyPage()">ë§ˆì´í˜ì´ì§€</button>
                <button class="nav-btn" onclick="showMySurveys()">ë‚´ ì„¤ë¬¸</button>
                <button class="nav-btn" onclick="showAvailableSurveys()">ì°¸ì—¬í•˜ê¸°</button>
                <button class="nav-btn" onclick="showTemplateMarket()">ğŸ“ í…œí”Œë¦¿ ë§ˆì¼“</button>
                <button class="nav-btn" onclick="showGiftShop()">ğŸ ìƒí’ˆêµí™˜ì†Œ</button>
                <button class="nav-btn" id="adminModeBtn" onclick="showAdminSettings()" style="background: #ff6b6b; display: none;">âš™ï¸ ê´€ë¦¬ì</button>
                <button class="nav-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <!-- ë‚´ ì •ë³´ ì˜ì—­ -->
        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; gap: 30px; align-items: center; flex: 1;">
                    <div>
                        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">í™˜ì˜í•©ë‹ˆë‹¤!</div>
                        <div style="font-size: 24px; font-weight: bold;"><span id="dashboardUserName"></span>ë‹˜</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 12px;">
                        <div style="font-size: 13px; opacity: 0.9; margin-bottom: 5px;">ë³´ìœ  í¬ì¸íŠ¸</div>
                        <div style="font-size: 28px; font-weight: bold;">ğŸ’° <span id="dashboardPoints">0</span> P</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 12px;">
                        <div style="font-size: 13px; opacity: 0.9; margin-bottom: 5px;">ë‚´ í‰ì </div>
                        <div style="font-size: 28px; font-weight: bold;">â­ <span id="dashboardRating">0.0</span></div>
                    </div>
                </div>
                <button class="btn" style="background: white; color: #667eea; font-weight: bold; padding: 12px 30px; font-size: 16px;" onclick="showMyPage()">
                    ğŸ‘¤ ë§ˆì´í˜ì´ì§€
                </button>
            </div>
        </div>

        <!-- í™ë³´ ê³µì§€ì‚¬í•­ ì˜ì—­ -->
        <div class="featured-banner" id="featuredBanner" style="display: none;"></div>

        <div class="dashboard-stats">
            <div class="stat-card">
                <div class="stat-number" id="mySurveysCount">0</div>
                <div class="stat-label">ë‚´ê°€ ë§Œë“  ì„¤ë¬¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="availableSurveysCount">0</div>
                <div class="stat-label">ì°¸ì—¬ ê°€ëŠ¥ ì„¤ë¬¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedSurveysCount">0</div>
                <div class="stat-label">ì°¸ì—¬ ì™„ë£Œ ì„¤ë¬¸</div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h2>ë‚´ê°€ ë§Œë“  ì„¤ë¬¸</h2>
                <button class="btn" onclick="showCreateSurvey()">+ ìƒˆ ì„¤ë¬¸ ë§Œë“¤ê¸°</button>
                <div id="mySurveysList" style="margin-top: 20px;"></div>
            </div>
            <div class="card">
                <h2>ì°¸ì—¬ ê°€ëŠ¥í•œ ì„¤ë¬¸</h2>
                <div id="availableSurveysList"></div>
            </div>
        </div>
    </div>

    <!-- Available Surveys Screen -->
    <div id="availableSurveysScreen" class="container hidden">
        <div class="header">
            <div class="logo">ğŸ“‹ ì°¸ì—¬ ê°€ëŠ¥í•œ ì„¤ë¬¸</div>
            <div class="user-info-header">
                <span id="userNameHeader2"></span>ë‹˜
                <div class="points-badge" id="userPoints2">ğŸ’° 0 P</div>
                <div class="rating-badge" id="userRatingBadge2">â­ 0.0</div>
            </div>
            <div class="nav">
                <button class="nav-btn" onclick="showDashboard()">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="showMyPage()">ë§ˆì´í˜ì´ì§€</button>
                <button class="nav-btn" onclick="showMySurveys()">ë‚´ ì„¤ë¬¸</button>
                <button class="nav-btn" onclick="showAvailableSurveys()">ì°¸ì—¬í•˜ê¸°</button>
                <button class="nav-btn" onclick="showTemplateMarket()">ğŸ“ í…œí”Œë¦¿ ë§ˆì¼“</button>
                <button class="nav-btn" onclick="showGiftShop()">ğŸ ìƒí’ˆêµí™˜ì†Œ</button>
                <button class="nav-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="card">
            <h2>ì°¸ì—¬ ê°€ëŠ¥í•œ ëª¨ë“  ì„¤ë¬¸</h2>
            <p style="color: #666; margin-bottom: 20px;">ë‚˜ì˜ ì¡°ê±´ì— ë§ëŠ” ëª¨ë“  ì„¤ë¬¸ì„ í™•ì¸í•˜ê³  ì°¸ì—¬í•˜ì„¸ìš”!</p>
            <div id="allAvailableSurveysList" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;"></div>
        </div>
    </div>

    <!-- Gift Shop Screen -->
    <div id="giftShopScreen" class="container hidden">
        <div class="header">
            <div class="logo">ğŸ ìƒí’ˆ êµí™˜ì†Œ</div>
            <div class="nav">
                <div class="points-badge" id="userPoints4">ğŸ’° 0 P</div>
                <button class="nav-btn" onclick="showDashboard()">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="showGiftShop()">ğŸ ìƒí’ˆêµí™˜ì†Œ</button>
                <button class="nav-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="card">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('products')">ğŸ›ï¸ ìƒí’ˆ ëª©ë¡</button>
                <button class="tab-btn" onclick="switchTab('history')">ğŸ“œ êµí™˜ ë‚´ì—­</button>
            </div>

            <!-- Products Tab -->
            <div id="productsTab">
                <h2>í¬ì¸íŠ¸ë¡œ êµí™˜ ê°€ëŠ¥í•œ ìƒí’ˆ</h2>
                <p style="color: #666; margin-bottom: 20px;">í˜„ì¬ ë³´ìœ  í¬ì¸íŠ¸: <strong id="currentPoints">0</strong> P</p>
                <div id="productsGrid" class="grid"></div>
            </div>

            <!-- Exchange History Tab -->
            <div id="historyTab" class="hidden">
                <h2>ë‚˜ì˜ êµí™˜ ë‚´ì—­</h2>
                <div id="exchangeHistoryList"></div>
            </div>
        </div>
    </div>

    <!-- Template Market Screen -->
    <div id="templateMarketScreen" class="container hidden">
        <div class="header">
            <div class="logo">ğŸ“ í…œí”Œë¦¿ ë§ˆì¼“</div>
            <div class="nav">
                <div class="points-badge" id="userPoints7">ğŸ’° 0 P</div>
                <button class="nav-btn" onclick="showDashboard()">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="showTemplateMarket()">ğŸ“ í…œí”Œë¦¿ ë§ˆì¼“</button>
                <button class="nav-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="card">
            <div style="margin-bottom: 20px;">
                <h2 style="margin-bottom: 10px;">ğŸ“‹ í”„ë¦¬ë¯¸ì—„ ì„¤ë¬¸ í…œí”Œë¦¿</h2>
                <p style="color: #666; font-size: 14px;">ì „ë¬¸ê°€ê°€ ë§Œë“  ê²€ì¦ëœ í…œí”Œë¦¿ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì„¤ë¬¸ì„ ì‹œì‘í•˜ì„¸ìš”</p>
            </div>

            <!-- Category Filter -->
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333;">ğŸ“‚ ì¹´í…Œê³ ë¦¬:</label>
                <select id="templateCategory" onchange="filterTemplates()" style="padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; width: 250px;">
                    <option value="all">ì „ì²´ ë³´ê¸°</option>
                    <option value="business">ë¹„ì¦ˆë‹ˆìŠ¤</option>
                    <option value="academic">í•™ìˆ /ì—°êµ¬</option>
                    <option value="marketing">ë§ˆì¼€íŒ…</option>
                    <option value="hr">ì¸ì‚¬/ì±„ìš©</option>
                    <option value="feedback">í”¼ë“œë°±</option>
                    <option value="event">ì´ë²¤íŠ¸</option>
                </select>
            </div>

            <!-- Templates Grid -->
            <div id="templatesGrid" class="grid"></div>
        </div>

        <!-- Purchase History -->
        <div class="card">
            <h2>ğŸ›ï¸ êµ¬ë§¤í•œ í…œí”Œë¦¿</h2>
            <div id="purchasedTemplates"></div>
        </div>
    </div>

    <!-- Admin Settings Screen -->
    <div id="adminSettingsScreen" class="container hidden">
        <div class="header">
            <div class="logo">âš™ï¸ ê´€ë¦¬ì ëª¨ë“œ</div>
            <div class="nav">
                <button class="nav-btn" onclick="showDashboard()">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ¨ í…Œë§ˆ ë° ë ˆì´ì•„ì›ƒ ì„¤ì •</h2>
            <p style="color: #666; margin-bottom: 20px;">ëŒ€ì‹œë³´ë“œì˜ ê° íƒ­ ë°°ê²½ê³¼ ìƒ‰ìƒì„ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchAdminTab('stats')">ğŸ“Š í†µê³„ ì¹´ë“œ</button>
                <button class="tab-btn" onclick="switchAdminTab('created')">ğŸ“ ë‚´ê°€ ë§Œë“  ì„¤ë¬¸</button>
                <button class="tab-btn" onclick="switchAdminTab('available')">ğŸ“‹ ì°¸ì—¬ ê°€ëŠ¥ ì„¤ë¬¸</button>
            </div>

            <!-- í†µê³„ ì¹´ë“œ ì„¤ì • -->
            <div id="statsSettingsTab">
                <h3 style="margin-top: 25px; margin-bottom: 15px;">ğŸ“Š í†µê³„ ì¹´ë“œ ì„¤ì •</h3>
                <div class="form-group">
                    <label>ë°°ê²½ ì´ë¯¸ì§€ URL</label>
                    <input type="text" id="statsBackgroundImage" placeholder="https://example.com/image.jpg" style="width: 100%;">
                    <small style="color: #666;">ë¹ˆì¹¸ìœ¼ë¡œ ë‘ë©´ ì´ë¯¸ì§€ê°€ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</small>
                </div>
                <div class="form-group">
                    <label>ë°°ê²½ìƒ‰</label>
                    <input type="color" id="statsBackgroundColor" value="#ffffff">
                </div>
                <div class="form-group">
                    <label>ê¸€ììƒ‰</label>
                    <input type="color" id="statsTextColor" value="#333333">
                </div>
                <div class="form-group">
                    <label>ì¹´ë“œ íˆ¬ëª…ë„ (0-100%)</label>
                    <input type="range" id="statsOpacity" min="0" max="100" value="100" oninput="this.nextElementSibling.textContent = this.value + '%'">
                    <span>100%</span>
                </div>
            </div>

            <!-- ë‚´ê°€ ë§Œë“  ì„¤ë¬¸ ì„¤ì • -->
            <div id="createdSettingsTab" class="hidden">
                <h3 style="margin-top: 25px; margin-bottom: 15px;">ğŸ“ ë‚´ê°€ ë§Œë“  ì„¤ë¬¸ ì¹´ë“œ ì„¤ì •</h3>
                <div class="form-group">
                    <label>ë°°ê²½ ì´ë¯¸ì§€ URL</label>
                    <input type="text" id="createdBackgroundImage" placeholder="https://example.com/image.jpg" style="width: 100%;">
                </div>
                <div class="form-group">
                    <label>ë°°ê²½ìƒ‰</label>
                    <input type="color" id="createdBackgroundColor" value="#ffffff">
                </div>
                <div class="form-group">
                    <label>ê¸€ììƒ‰</label>
                    <input type="color" id="createdTextColor" value="#333333">
                </div>
                <div class="form-group">
                    <label>ì¹´ë“œ íˆ¬ëª…ë„ (0-100%)</label>
                    <input type="range" id="createdOpacity" min="0" max="100" value="100" oninput="this.nextElementSibling.textContent = this.value + '%'">
                    <span>100%</span>
                </div>
            </div>

            <!-- ì°¸ì—¬ ê°€ëŠ¥ ì„¤ë¬¸ ì„¤ì • -->
            <div id="availableSettingsTab" class="hidden">
                <h3 style="margin-top: 25px; margin-bottom: 15px;">ğŸ“‹ ì°¸ì—¬ ê°€ëŠ¥ ì„¤ë¬¸ ì¹´ë“œ ì„¤ì •</h3>
                <div class="form-group">
                    <label>ë°°ê²½ ì´ë¯¸ì§€ URL</label>
                    <input type="text" id="availableBackgroundImage" placeholder="https://example.com/image.jpg" style="width: 100%;">
                </div>
                <div class="form-group">
                    <label>ë°°ê²½ìƒ‰</label>
                    <input type="color" id="availableBackgroundColor" value="#ffffff">
                </div>
                <div class="form-group">
                    <label>ê¸€ììƒ‰</label>
                    <input type="color" id="availableTextColor" value="#333333">
                </div>
                <div class="form-group">
                    <label>ì¹´ë“œ íˆ¬ëª…ë„ (0-100%)</label>
                    <input type="range" id="availableOpacity" min="0" max="100" value="100" oninput="this.nextElementSibling.textContent = this.value + '%'">
                    <span>100%</span>
                </div>
            </div>

            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; display: flex; gap: 10px;">
                <button class="btn btn-success" onclick="applyAdminSettings()">âœ… ë³€ê²½ì‚¬í•­ ì ìš©</button>
                <button class="btn" style="background: #6c757d;" onclick="resetAdminSettings()">ğŸ”„ ì´ˆê¸°í™”</button>
                <button class="btn btn-secondary" onclick="showDashboard()">ëŒì•„ê°€ê¸°</button>
            </div>
        </div>

        <!-- ë¯¸ë¦¬ë³´ê¸° -->
        <div class="card">
            <h2>ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</h2>
            <div id="adminPreview" style="padding: 20px; border: 2px dashed #ddd; border-radius: 8px; min-height: 200px;">
                <div class="dashboard-stats" id="previewStats">
                    <div class="stat-card" style="position: relative; overflow: hidden;">
                        <div style="position: absolute; inset: 0; background-size: cover; background-position: center;" id="previewStatsBackground"></div>
                        <div style="position: relative; z-index: 1;">
                            <div class="stat-number" style="color: inherit;">42</div>
                            <div class="stat-label" style="color: inherit;">ë‚´ê°€ ë§Œë“  ì„¤ë¬¸</div>
                        </div>
                    </div>
                    <div class="stat-card" style="position: relative; overflow: hidden;">
                        <div style="position: absolute; inset: 0; background-size: cover; background-position: center;" id="previewCreatedBackground"></div>
                        <div style="position: relative; z-index: 1;">
                            <div class="stat-number" style="color: inherit;">18</div>
                            <div class="stat-label" style="color: inherit;">ì°¸ì—¬ ê°€ëŠ¥ ì„¤ë¬¸</div>
                        </div>
                    </div>
                    <div class="stat-card" style="position: relative; overflow: hidden;">
                        <div style="position: absolute; inset: 0; background-size: cover; background-position: center;" id="previewAvailableBackground"></div>
                        <div style="position: relative; z-index: 1;">
                            <div class="stat-number" style="color: inherit;">25</div>
                            <div class="stat-label" style="color: inherit;">ì°¸ì—¬ ì™„ë£Œ ì„¤ë¬¸</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- My Page Screen -->
    <div id="myPageScreen" class="container hidden">
        <div class="header">
            <div class="logo">ğŸ‘¤ ë§ˆì´í˜ì´ì§€</div>
            <div class="nav">
                <div class="points-badge" id="userPoints5">ğŸ’° 0 P</div>
                <button class="nav-btn" onclick="showDashboard()">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="showMyPage()">ë§ˆì´í˜ì´ì§€</button>
                <button class="nav-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="card">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchMyPageTab('profile')">ğŸ“ ë‚´ ì •ë³´</button>
                <button class="tab-btn" onclick="switchMyPageTab('created')">ğŸ“‹ ë“±ë¡í•œ ì„¤ë¬¸</button>
                <button class="tab-btn" onclick="switchMyPageTab('participated')">âœ… ì°¸ì—¬í•œ ì„¤ë¬¸</button>
                <button class="tab-btn" onclick="switchMyPageTab('referral')">ğŸ‘¥ ì¹œêµ¬ ì¶”ì²œ</button>
            </div>

            <!-- Profile Edit Tab -->
            <div id="profileTab">
                <h2>ë‚´ ì •ë³´</h2>
                <div style="background: linear-gradient(135deg, #7B9FB8 0%, #5B7C99 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
                    <div style="font-size: 48px; font-weight: bold; margin-bottom: 10px;">â­ <span id="myPageRating">3.0</span></div>
                    <div style="font-size: 16px; margin-bottom: 5px;">ë‚´ í‰ì  (5.0 ë§Œì )</div>
                    <div style="font-size: 14px; opacity: 0.9;">ì™„ë£Œí•œ ì„¤ë¬¸: <span id="myPageCompletedCount">0</span>ê°œ | í‰ì ì€ ì„¤ë¬¸ ì°¸ì—¬ ì‹œ 0.1ì”© ì¦ê°€í•©ë‹ˆë‹¤</div>
                </div>
                <h3>ì •ë³´ ìˆ˜ì •</h3>
                <div id="profileMessage"></div>
                <div class="form-group">
                    <label>ì´ë¦„</label>
                    <input type="text" id="editName">
                </div>
                <div class="form-group">
                    <label>ì´ë©”ì¼ (ë³€ê²½ ë¶ˆê°€)</label>
                    <input type="email" id="editEmail" disabled style="background: #f5f5f5;">
                </div>
                <div class="form-group">
                    <label>ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="editPhone" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                </div>
                <div class="form-group">
                    <label>ìƒë…„ì›”ì¼</label>
                    <input type="date" id="editBirthDate">
                </div>
                <div class="form-group">
                    <label>ì„±ë³„</label>
                    <select id="editGender">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="ë‚¨ì„±">ë‚¨ì„±</option>
                        <option value="ì—¬ì„±">ì—¬ì„±</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì§€ì—­ (ê´‘ì—­ì‹œë„)</label>
                    <select id="editRegionSido" onchange="updateRegionDistricts('edit')">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì‹œêµ°êµ¬</label>
                    <select id="editRegionDistrict" onchange="updateRegionDongs('edit')" disabled>
                        <option value="">ê´‘ì—­ì‹œë„ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ìë©´ë™</label>
                    <select id="editRegionDong" disabled>
                        <option value="">ì‹œêµ°êµ¬ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì§ì—…</label>
                    <select id="editJob">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="í•™ìƒ">í•™ìƒ</option>
                        <option value="íšŒì‚¬ì›">íšŒì‚¬ì›</option>
                        <option value="ì „ë¬¸ì§">ì „ë¬¸ì§</option>
                        <option value="ìì˜ì—…">ìì˜ì—…</option>
                        <option value="ì£¼ë¶€">ì£¼ë¶€</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                </div>
                <button class="btn" onclick="updateProfile()">ì •ë³´ ì €ì¥</button>
            </div>

            <!-- Created Surveys Tab -->
            <div id="createdTab" class="hidden">
                <h2>ë‚´ê°€ ë“±ë¡í•œ ì„¤ë¬¸</h2>
                <div id="createdSurveysList"></div>
            </div>

            <!-- Participated Surveys Tab -->
            <div id="participatedTab" class="hidden">
                <h2>ë‚´ê°€ ì°¸ì—¬í•œ ì„¤ë¬¸</h2>
                <div id="participatedSurveysList"></div>
            </div>

            <!-- Referral Tab -->
            <div id="referralTab" class="hidden">
                <h2>ğŸ‘¥ ì¹œêµ¬ ì¶”ì²œí•˜ê³  í¬ì¸íŠ¸ ë°›ê¸°</h2>

                <div style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: #333; padding: 25px; border-radius: 12px; margin-bottom: 25px; text-align: center; box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);">
                    <div style="font-size: 18px; font-weight: bold; margin-bottom: 15px;">ğŸ ë‚´ ì¶”ì²œ ì½”ë“œ</div>
                    <div style="font-size: 48px; font-weight: bold; letter-spacing: 8px; margin-bottom: 15px; font-family: monospace;" id="myReferralCode">------</div>
                    <button class="btn" onclick="copyReferralCode()" style="background: #333; margin-right: 10px;">ğŸ“‹ ì½”ë“œ ë³µì‚¬</button>
                    <button class="btn" onclick="shareReferralLink()" style="background: #28a745;">ğŸ”— ë§í¬ ê³µìœ </button>
                    <div style="margin-top: 15px; font-size: 14px; opacity: 0.9;">
                        ì¹œêµ¬ê°€ ì´ ì½”ë“œë¡œ ê°€ì…í•˜ê³  ì„¤ë¬¸ 3ê°œë¥¼ ì™„ë£Œí•˜ë©´<br>
                        <strong>ì¹œêµ¬ëŠ” 3,000P, ë‚˜ëŠ” 5,000P</strong>ë¥¼ ë°›ì•„ìš”!
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 12px; border: 1px solid #e0e0e0; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">ğŸ“Š ì¶”ì²œ í†µê³„</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; text-align: center;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="font-size: 32px; font-weight: bold; color: #5B7C99;" id="totalReferrals">0</div>
                            <div style="font-size: 13px; color: #666; margin-top: 5px;">ì´ ì¶”ì²œ ìˆ˜</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="font-size: 32px; font-weight: bold; color: #28a745;" id="completedReferrals">0</div>
                            <div style="font-size: 13px; color: #666; margin-top: 5px;">ë³´ìƒ ì™„ë£Œ</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="font-size: 32px; font-weight: bold; color: #FFD700;" id="totalReferralEarnings">0</div>
                            <div style="font-size: 13px; color: #666; margin-top: 5px;">ëˆ„ì  ìˆ˜ìµ (P)</div>
                        </div>
                    </div>
                </div>

                <h3>ğŸ’š ì¶”ì²œí•œ ì¹œêµ¬ ëª©ë¡</h3>
                <div id="referralList"></div>
            </div>
        </div>
    </div>

    <!-- Survey Analytics Screen -->
    <div id="analyticsScreen" class="container hidden">
        <div class="header">
            <div class="logo">ğŸ“Š ì„¤ë¬¸ ê²°ê³¼ ë¶„ì„</div>
            <div class="nav">
                <div class="points-badge" id="userPoints6">ğŸ’° 0 P</div>
                <button class="nav-btn" onclick="showMyPage()">ë§ˆì´í˜ì´ì§€</button>
                <button class="nav-btn" onclick="showDashboard()">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                    <h2 id="analyticsTitle" style="margin-bottom: 5px;">ì„¤ë¬¸ ì œëª©</h2>
                    <p id="analyticsDesc" style="color: #666; font-size: 14px;"></p>
                </div>
                <button class="btn btn-success" onclick="downloadResults()">ğŸ“¥ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ (CSV)</button>
            </div>

            <!-- í†µê³„ ìš”ì•½ -->
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px;">
                <div class="stat-card">
                    <div class="stat-number" id="totalResponses">0</div>
                    <div class="stat-label">ì´ ì‘ë‹µ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="targetResponses">0</div>
                    <div class="stat-label">ëª©í‘œ ì‘ë‹µ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completionRate">0%</div>
                    <div class="stat-label">ë‹¬ì„±ë¥ </div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="qualityScoreDisplay">-</div>
                    <div class="stat-label">í’ˆì§ˆ ì ìˆ˜</div>
                </div>
            </div>

            <!-- ì§ˆë¬¸ë³„ ê²°ê³¼ -->
            <div id="analyticsCharts"></div>

            <div style="margin-top: 30px; text-align: center;">
                <button class="btn btn-secondary" onclick="showMyPage()">ëŒì•„ê°€ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Create Survey -->
    <div id="createSurveyScreen" class="container hidden">
        <div class="header">
            <div class="logo">ğŸ¯ ì„¤ë¬¸ ë§¤ì¹­ í”Œë«í¼</div>
            <div class="nav">
                <div class="points-badge" id="userPoints3">ğŸ’° 0 P</div>
                <button class="nav-btn" onclick="showDashboard()">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="card">
            <h2>ìƒˆ ì„¤ë¬¸ ë§Œë“¤ê¸° (êµ¬ê¸€ í¼ ìŠ¤íƒ€ì¼)</h2>
            <p style="background: #e7f3ff; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #2196F3;">
                ğŸ’° <strong>í˜„ì¬ ë³´ìœ  í¬ì¸íŠ¸: <span id="createSurveyPoints" style="color: #2196F3; font-size: 18px;">0</span> P</strong>
            </p>
            <div id="createMessage"></div>

            <div class="form-group">
                <label>ì„¤ë¬¸ ì œëª©</label>
                <input type="text" id="surveyTitle" placeholder="ì˜ˆ: ì˜¨ë¼ì¸ ì‡¼í•‘ ë§Œì¡±ë„ ì¡°ì‚¬">
            </div>
            <div class="form-group">
                <label>ì„¤ë¬¸ ì„¤ëª…</label>
                <textarea id="surveyDesc" placeholder="ì„¤ë¬¸ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="form-group">
                <label>ì£¼ê´€ ê¸°ê´€/ë‹¨ì²´ëª…</label>
                <input type="text" id="surveyOrganizer" placeholder="ì˜ˆ: ì„œìš¸ëŒ€í•™êµ ì†Œë¹„ìì—°êµ¬ì†Œ, ãˆœë¦¬ì„œì¹˜ì»´í¼ë‹ˆ">
                <small style="color: #666;">ì„¤ë¬¸ì„ ì£¼ê´€í•˜ëŠ” ê¸°ê´€ì´ë‚˜ ë‹¨ì²´ëª…ì„ ì…ë ¥í•˜ì„¸ìš”</small>
            </div>
            <div class="form-group">
                <label>ëª©í‘œ ì‘ë‹µ ìˆ˜</label>
                <input type="number" id="surveyTarget" value="100">
            </div>
            <div class="form-group">
                <label>ë³´ìƒ í¬ì¸íŠ¸</label>
                <input type="number" id="surveyRewardPoints" value="100" placeholder="ì˜ˆ: 100">
                <small style="color: #666;">ì°¸ì—¬ìì—ê²Œ ì§€ê¸‰í•  í¬ì¸íŠ¸</small>
            </div>

            <div class="form-group">
                <label>ğŸ’° ì„¤ë¬¸ ë“±ë¡ ìš”ê¸ˆì œ</label>
                <select id="surveyPricingPlan" onchange="updatePricingInfo()">
                    <option value="basic">ê¸°ë³¸ (50ëª… ì´í•˜) - 3,000 P</option>
                    <option value="standard" selected>í‘œì¤€ (100ëª… ì´í•˜) - 7,000 P</option>
                    <option value="premium">í”„ë¦¬ë¯¸ì—„ (200ëª… ì´í•˜) - 15,000 P</option>
                    <option value="enterprise">ì—”í„°í”„ë¼ì´ì¦ˆ (ë¬´ì œí•œ) - 30,000 P</option>
                </select>
                <div id="pricingInfo" style="margin-top: 10px; padding: 12px; background: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107;">
                    <strong>ğŸ’¡ í‘œì¤€ ìš”ê¸ˆì œ</strong><br>
                    â€¢ ë¹„ìš©: 7,000 P<br>
                    â€¢ ìµœëŒ€ ì‘ë‹µ ìˆ˜: 100ëª…<br>
                    â€¢ ì„¤ë¬¸ ë“±ë¡ ì‹œ í¬ì¸íŠ¸ê°€ ì°¨ê°ë©ë‹ˆë‹¤
                </div>
            </div>

            <div class="form-group">
                <label>ğŸ“… ì„¤ë¬¸ ì‹œì‘ì¼</label>
                <input type="date" id="surveyStartDate">
                <small style="color: #666;">ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ì¦‰ì‹œ ë…¸ì¶œë©ë‹ˆë‹¤</small>
            </div>
            <div class="form-group">
                <label>ğŸ“… ì„¤ë¬¸ ì¢…ë£Œì¼</label>
                <input type="date" id="surveyEndDate">
                <small style="color: #666;">ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ëª©í‘œ ì‘ë‹µ ìˆ˜ ë‹¬ì„± ì‹œê¹Œì§€ ë…¸ì¶œë©ë‹ˆë‹¤</small>
            </div>
            <hr style="margin: 30px 0;">
            <h3>ğŸ¯ íƒ€ê²ŸíŒ… ì˜µì…˜ (ì„ íƒì‚¬í•­)</h3>
            <p style="color: #666; margin-bottom: 20px; font-size: 14px;">íƒ€ê²Ÿ ì¡°ê±´ì„ ì„¤ì •í•˜ë©´ ì¡°ê±´ì— ë§ëŠ” ì‚¬ìš©ìì—ê²Œë§Œ ì„¤ë¬¸ì´ ë…¸ì¶œë©ë‹ˆë‹¤.</p>

            <div class="form-group">
                <label>íƒ€ê¹ƒ ë‚˜ì´ ë²”ìœ„</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="number" id="surveyTargetAgeMin" placeholder="ìµœì†Œ" min="0" max="120" style="flex: 1;">
                    <span>~</span>
                    <input type="number" id="surveyTargetAgeMax" placeholder="ìµœëŒ€" min="0" max="120" style="flex: 1;">
                    <span style="font-size: 14px; color: #666;">ì„¸</span>
                </div>
                <small style="color: #666;">ë¹ˆì¹¸ìœ¼ë¡œ ë‘ë©´ ì „ì²´ ì—°ë ¹ ëŒ€ìƒ</small>
            </div>

            <div class="form-group">
                <label>íƒ€ê¹ƒ ì„±ë³„</label>
                <select id="surveyTargetGender">
                    <option value="">ì „ì²´</option>
                    <option value="ë‚¨ì„±">ë‚¨ì„±</option>
                    <option value="ì—¬ì„±">ì—¬ì„±</option>
                </select>
            </div>

            <div class="form-group">
                <label>íƒ€ê¹ƒ ì§€ì—­ (ê´‘ì—­ì‹œë„)</label>
                <select id="surveyTargetRegionSido" onchange="updateRegionDistricts('surveyTarget')">
                    <option value="">ì „ì²´</option>
                </select>
            </div>
            <div class="form-group">
                <label>íƒ€ê¹ƒ ì§€ì—­ (ì‹œêµ°êµ¬)</label>
                <select id="surveyTargetRegionDistrict" onchange="updateRegionDongs('surveyTarget')" disabled>
                    <option value="">ê´‘ì—­ì‹œë„ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>
            <div class="form-group">
                <label>íƒ€ê¹ƒ ì§€ì—­ (ìë©´ë™)</label>
                <select id="surveyTargetRegionDong" disabled>
                    <option value="">ì‹œêµ°êµ¬ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>

            <div class="form-group">
                <label>íƒ€ê¹ƒ ì§ì—…</label>
                <select id="surveyTargetJob">
                    <option value="">ì „ì²´</option>
                    <option value="í•™ìƒ">í•™ìƒ</option>
                    <option value="íšŒì‚¬ì›">íšŒì‚¬ì›</option>
                    <option value="ì „ë¬¸ì§">ì „ë¬¸ì§</option>
                    <option value="ìì˜ì—…">ìì˜ì—…</option>
                    <option value="ì£¼ë¶€">ì£¼ë¶€</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
            </div>

            <div class="form-group">
                <label>ìµœì†Œ ì°¸ì—¬ì í‰ì </label>
                <select id="surveyMinRating">
                    <option value="">ì œí•œ ì—†ìŒ</option>
                    <option value="3.0">â­ 3.0 ì´ìƒ (ë³´í†µ)</option>
                    <option value="3.5">â­ 3.5 ì´ìƒ</option>
                    <option value="4.0">â­ 4.0 ì´ìƒ (ìš°ìˆ˜)</option>
                    <option value="4.5">â­ 4.5 ì´ìƒ (ë§¤ìš° ìš°ìˆ˜)</option>
                    <option value="5.0">â­ 5.0 (ìµœê³ )</option>
                </select>
                <small style="color: #666;">ì„±ì‹¤í•œ ì°¸ì—¬ìë§Œ ì„¤ë¬¸ì— ì°¸ì—¬í•  ìˆ˜ ìˆë„ë¡ í‰ì  ì¡°ê±´ì„ ì„¤ì •í•˜ì„¸ìš”</small>
            </div>

            <hr style="margin: 30px 0;">

            <h3>ì„¤ë¬¸ ë¬¸í•­ ì‘ì„±</h3>
            <div id="questionsContainer"></div>

            <button class="btn btn-secondary" onclick="addQuestion()">+ ì§ˆë¬¸ ì¶”ê°€</button>
            <br><br>

            <!-- í’ˆì§ˆ ê²€ì¦ ì„¹ì…˜ -->
            <div id="qualityCheckSection" style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #5B7C99;">
                <h3 style="margin-bottom: 15px;">ğŸ” ì„¤ë¬¸ í’ˆì§ˆ ê²€ì¦</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">AI ê¸°ë°˜ í’ˆì§ˆ ê²€ì¦ìœ¼ë¡œ ë” ë‚˜ì€ ì„¤ë¬¸ì„ ë§Œë“œì„¸ìš”. í’ˆì§ˆ ì ìˆ˜ê°€ 60ì  ë¯¸ë§Œì¼ ê²½ìš° ë“±ë¡ì´ ì œí•œë©ë‹ˆë‹¤.</p>
                <button class="btn" onclick="validateSurveyQuality()" style="background: #28a745;">âœ“ í’ˆì§ˆ ê²€ì¦ ì‹¤í–‰</button>
                <div id="qualityResult" style="margin-top: 15px;"></div>
            </div>

            <button class="btn" onclick="createSurvey()">ì„¤ë¬¸ ìƒì„±</button>
            <button class="btn btn-secondary" onclick="showDashboard()">ì·¨ì†Œ</button>
        </div>
    </div>

    <!-- Survey Participate -->
    <div id="participateScreen" class="container hidden">
        <div class="header">
            <div class="logo">ğŸ¯ ì„¤ë¬¸ ë§¤ì¹­ í”Œë«í¼</div>
            <div class="nav">
                <div class="points-badge" id="userPoints3">ğŸ’° 0 P</div>
                <button class="nav-btn" onclick="showDashboard()">ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="card">
            <h2 id="participateTitle"></h2>
            <p id="participateDesc" style="color: #666; margin-bottom: 20px;"></p>
            <div id="participateReward" style="background: #fff3cd; padding: 15px; border-radius: 5px; margin-bottom: 20px;"></div>

            <form id="participateForm">
                <div id="participateQuestions"></div>
                <button type="button" class="btn" onclick="submitSurveyAnswers()">ì œì¶œí•˜ê¸°</button>
                <button type="button" class="btn btn-secondary" onclick="showDashboard()">ì·¨ì†Œ</button>
            </form>
        </div>
    </div>

    <script>
        let currentUser = null;
        let currentSurvey = null;
        let questions = [];
        let questionCounter = 0;

        // ë‚˜ì´ ê³„ì‚° í•¨ìˆ˜
        function calculateAge(birthDate) {
            if (!birthDate) return null;
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age;
        }

        // ì„¤ë¬¸ ë§¤ì¹­ ë¡œì§ (AND ì¡°ê±´)
        function matchesSurveyTarget(survey, user) {
            // ë‚˜ì´ ë§¤ì¹­
            if (survey.targetAgeMin !== null || survey.targetAgeMax !== null) {
                const userAge = calculateAge(user.birthDate);
                if (userAge === null) return false;
                if (survey.targetAgeMin && userAge < survey.targetAgeMin) return false;
                if (survey.targetAgeMax && userAge > survey.targetAgeMax) return false;
            }

            // ì„±ë³„ ë§¤ì¹­
            if (survey.targetGender && survey.targetGender !== user.gender) return false;

            // ì§€ì—­ ê³„ì¸µ ë§¤ì¹­
            if (survey.targetRegion && typeof survey.targetRegion === 'object') {
                const userRegion = typeof user.region === 'object' ? user.region : {sido: user.region, district: '', dong: ''};

                // ì‹œë„ ë§¤ì¹­
                if (survey.targetRegion.sido && survey.targetRegion.sido !== userRegion.sido) return false;

                // ì‹œêµ°êµ¬ ë§¤ì¹­ (ì„¤ë¬¸ì— ì‹œêµ°êµ¬ê°€ ì§€ì •ëœ ê²½ìš°ì—ë§Œ)
                if (survey.targetRegion.district && survey.targetRegion.district !== userRegion.district) return false;

                // ìë©´ë™ ë§¤ì¹­ (ì„¤ë¬¸ì— ìë©´ë™ì´ ì§€ì •ëœ ê²½ìš°ì—ë§Œ)
                if (survey.targetRegion.dong && survey.targetRegion.dong !== userRegion.dong) return false;
            }

            // ì§ì—… ë§¤ì¹­
            if (survey.targetJob && survey.targetJob !== user.job) return false;

            // í‰ì  ë§¤ì¹­
            if (survey.minRating) {
                const userRating = user.rating || 3.0;
                if (userRating < survey.minRating) return false;
            }

            // í‰ì  3ì  ì´í•˜ëŠ” ë¬´ë£Œ ì„¤ë¬¸ë§Œ ì°¸ì—¬ ê°€ëŠ¥
            const userRating = user.rating || 3.0;
            if (userRating <= 3.0 && survey.rewardPoints > 0) return false;

            return true;
        }

        // ì „êµ­ í–‰ì •êµ¬ì—­ ë°ì´í„° (17ê°œ ê´‘ì—­ + ì‹œêµ°êµ¬ + í–‰ì •ë™)
        const regionsData = {
            "ì„œìš¸íŠ¹ë³„ì‹œ": {
                districts: ["ì¢…ë¡œêµ¬", "ì¤‘êµ¬", "ìš©ì‚°êµ¬", "ì„±ë™êµ¬", "ê´‘ì§„êµ¬", "ë™ëŒ€ë¬¸êµ¬", "ì¤‘ë‘êµ¬", "ì„±ë¶êµ¬", "ê°•ë¶êµ¬", "ë„ë´‰êµ¬", "ë…¸ì›êµ¬", "ì€í‰êµ¬", "ì„œëŒ€ë¬¸êµ¬", "ë§ˆí¬êµ¬", "ì–‘ì²œêµ¬", "ê°•ì„œêµ¬", "êµ¬ë¡œêµ¬", "ê¸ˆì²œêµ¬", "ì˜ë“±í¬êµ¬", "ë™ì‘êµ¬", "ê´€ì•…êµ¬", "ì„œì´ˆêµ¬", "ê°•ë‚¨êµ¬", "ì†¡íŒŒêµ¬", "ê°•ë™êµ¬"],
                dongs: {
                    "ê°•ë‚¨êµ¬": ["ì‚¼ì„±ë™", "ì—­ì‚¼ë™", "ì²­ë‹´ë™", "ì••êµ¬ì •ë™", "ë…¼í˜„ë™", "ì‹ ì‚¬ë™", "ëŒ€ì¹˜ë™", "ë„ê³¡ë™", "ê°œí¬ë™", "ì„¸ê³¡ë™"],
                    "ì„œì´ˆêµ¬": ["ì„œì´ˆë™", "ì ì›ë™", "ë°˜í¬ë™", "ë°©ë°°ë™", "ì–‘ì¬ë™", "ë‚´ê³¡ë™"],
                    "ì†¡íŒŒêµ¬": ["ì ì‹¤ë™", "ì‹ ì²œë™", "í’ë‚©ë™", "ì†¡íŒŒë™", "ì„ì´Œë™", "ì‚¼ì „ë™", "ê°€ë½ë™", "ë¬¸ì •ë™", "ì¥ì§€ë™"],
                    "ë§ˆí¬êµ¬": ["ê³µë•ë™", "ì•„í˜„ë™", "ë„í™”ë™", "ìš©ê°•ë™", "ëŒ€í¥ë™", "ì—¼ë¦¬ë™", "ì‹ ìˆ˜ë™", "ì„œê°•ë™", "ì„œêµë™", "í•©ì •ë™", "ë§ì›ë™", "ì—°ë‚¨ë™", "ì„±ì‚°ë™", "ìƒì•”ë™"],
                    "ì¢…ë¡œêµ¬": ["ì²­ìš´íš¨ìë™", "ì‚¬ì§ë™", "ì‚¼ì²­ë™", "ë¶€ì•”ë™", "í‰ì°½ë™", "ë¬´ì•…ë™", "êµë‚¨ë™", "ê°€íšŒë™", "ì¢…ë¡œ1.2.3.4ê°€ë™", "ì¢…ë¡œ5.6ê°€ë™", "ì´í™”ë™", "í˜œí™”ë™", "ì°½ì‹ ë™", "ìˆ­ì¸ë™"]
                }
            },
            "ë¶€ì‚°ê´‘ì—­ì‹œ": {
                districts: ["ì¤‘êµ¬", "ì„œêµ¬", "ë™êµ¬", "ì˜ë„êµ¬", "ë¶€ì‚°ì§„êµ¬", "ë™ë˜êµ¬", "ë‚¨êµ¬", "ë¶êµ¬", "í•´ìš´ëŒ€êµ¬", "ì‚¬í•˜êµ¬", "ê¸ˆì •êµ¬", "ê°•ì„œêµ¬", "ì—°ì œêµ¬", "ìˆ˜ì˜êµ¬", "ì‚¬ìƒêµ¬", "ê¸°ì¥êµ°"],
                dongs: {
                    "í•´ìš´ëŒ€êµ¬": ["ìš°ë™", "ì¤‘ë™", "ì¢Œë™", "ì†¡ì •ë™", "ë°˜ì—¬ë™", "ë°˜ì†¡ë™", "ì¬ì†¡ë™"],
                    "ë¶€ì‚°ì§„êµ¬": ["ë¶€ì „ë™", "ì—°ì§€ë™", "ì´ˆìë™", "ì–‘ì •ë™", "ì „í¬ë™", "ë¶€ì•”ë™", "ë‹¹ê°ë™"],
                    "ë™ë˜êµ¬": ["ìˆ˜ì•ˆë™", "ì˜¨ì²œë™", "ì‚¬ì§ë™", "ì•ˆë½ë™", "ëª…ë¥œë™", "ëª…ì¥ë™"]
                }
            },
            "ëŒ€êµ¬ê´‘ì—­ì‹œ": {
                districts: ["ì¤‘êµ¬", "ë™êµ¬", "ì„œêµ¬", "ë‚¨êµ¬", "ë¶êµ¬", "ìˆ˜ì„±êµ¬", "ë‹¬ì„œêµ¬", "ë‹¬ì„±êµ°"],
                dongs: {
                    "ìˆ˜ì„±êµ¬": ["ë²”ì–´ë™", "ë§Œì´Œë™", "ìˆ˜ì„±ë™", "í™©ê¸ˆë™", "ì¤‘ë™", "ìƒë™", "íŒŒë™", "ë‘ì‚°ë™", "ì§€ì‚°ë™"],
                    "ë‹¬ì„œêµ¬": ["ì„±ë‹¹ë™", "ë‘ë¥˜ë™", "ë³¸ë™", "ê°ì‚¼ë™", "ì£½ì „ë™", "ì¥ê¸°ë™", "ìš©ì‚°ë™", "ì´ê³¡ë™", "ì‹ ë‹¹ë™"]
                }
            },
            "ì¸ì²œê´‘ì—­ì‹œ": {
                districts: ["ì¤‘êµ¬", "ë™êµ¬", "ë¯¸ì¶”í™€êµ¬", "ì—°ìˆ˜êµ¬", "ë‚¨ë™êµ¬", "ë¶€í‰êµ¬", "ê³„ì–‘êµ¬", "ì„œêµ¬", "ê°•í™”êµ°", "ì˜¹ì§„êµ°"],
                dongs: {
                    "ì—°ìˆ˜êµ¬": ["ì˜¥ë ¨ë™", "ì„ í•™ë™", "ì—°ìˆ˜ë™", "ì²­í•™ë™", "ë™ì¶˜ë™", "ì†¡ë„ë™"],
                    "ë‚¨ë™êµ¬": ["êµ¬ì›”ë™", "ê°„ì„ë™", "ë§Œìˆ˜ë™", "ì¥ìˆ˜ë™", "ì„œì°½ë™", "ìš´ì—°ë™", "ë…¼í˜„ë™"],
                    "ë¶€í‰êµ¬": ["ë¶€í‰ë™", "ì‚°ê³¡ë™", "ì²­ì²œë™", "ì‚¼ì‚°ë™", "ê°ˆì‚°ë™", "ë¶€ê°œë™"]
                }
            },
            "ê´‘ì£¼ê´‘ì—­ì‹œ": {
                districts: ["ë™êµ¬", "ì„œêµ¬", "ë‚¨êµ¬", "ë¶êµ¬", "ê´‘ì‚°êµ¬"],
                dongs: {
                    "ì„œêµ¬": ["ì–‘ë™", "ë†ì„±ë™", "ê´‘ì²œë™", "ìœ ë•ë™", "ì¹˜í‰ë™", "ë‚´ë°©ë™"],
                    "ë‚¨êµ¬": ["ì‚¬ì§ë™", "ì›”ì‚°ë™", "ë°±ìš´ë™", "ì£¼ì›”ë™", "ë´‰ì„ ë™", "ëŒ€ì´Œë™", "ì§„ì›”ë™"],
                    "ë¶êµ¬": ["ì¤‘í¥ë™", "ìš©ë´‰ë™", "ìš´ì•”ë™", "ì‹ ì•ˆë™", "ìš°ì‚°ë™", "ì„ë™", "ë¬¸í¥ë™"]
                }
            },
            "ëŒ€ì „ê´‘ì—­ì‹œ": {
                districts: ["ë™êµ¬", "ì¤‘êµ¬", "ì„œêµ¬", "ìœ ì„±êµ¬", "ëŒ€ë•êµ¬"],
                dongs: {
                    "ìœ ì„±êµ¬": ["ì§„ì ë™", "í•™í•˜ë™", "êµ¬ì¦‰ë™", "ì›ì‹ í¥ë™", "ì˜¨ì²œë™", "ë…¸ì€ë™", "ì‹ ì„±ë™", "ì „ë¯¼ë™", "êµ¬ì•”ë™"],
                    "ì„œêµ¬": ["ë³µìˆ˜ë™", "ë„ë§ˆë™", "ì •ë¦¼ë™", "ì›”í‰ë™", "ë§Œë…„ë™", "ê°€ì¥ë™", "ë‚´ë™", "ê°ˆë§ˆë™", "ìš©ë¬¸ë™", "íƒ„ë°©ë™", "ë‘”ì‚°ë™"]
                }
            },
            "ìš¸ì‚°ê´‘ì—­ì‹œ": {
                districts: ["ì¤‘êµ¬", "ë‚¨êµ¬", "ë™êµ¬", "ë¶êµ¬", "ìš¸ì£¼êµ°"],
                dongs: {
                    "ë‚¨êµ¬": ["ì‚¼ì‚°ë™", "ì‹ ì •ë™", "ë‹¬ë™", "ë¬´ê±°ë™", "ì˜¥ë™"],
                    "ë¶êµ¬": ["í™”ë´‰ë™", "ì†¡ì •ë™", "ì—¼í¬ë™", "ë§¤ê³¡ë™", "ë‹¬ì²œë™"]
                }
            },
            "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ": {
                districts: ["ì„¸ì¢…ì‹œ"],
                dongs: {
                    "ì„¸ì¢…ì‹œ": ["ì¡°ì¹˜ì›ì", "ì—°ê¸°ë©´", "ì—°ë™ë©´", "ë¶€ê°•ë©´", "ê¸ˆë‚¨ë©´", "ì¥êµ°ë©´", "ì—°ì„œë©´", "ì „ì˜ë©´", "ì „ë™ë©´", "ì†Œì •ë©´", "í•œì†”ë™", "ë„ë‹´ë™", "ì•„ë¦„ë™", "ì¢…ì´Œë™", "ê³ ìš´ë™", "ë³´ëŒë™", "ëŒ€í‰ë™"]
                }
            },
            "ê²½ê¸°ë„": {
                districts: ["ìˆ˜ì›ì‹œ", "ì„±ë‚¨ì‹œ", "ê³ ì–‘ì‹œ", "ìš©ì¸ì‹œ", "ë¶€ì²œì‹œ", "ì•ˆì‚°ì‹œ", "ì•ˆì–‘ì‹œ", "ë‚¨ì–‘ì£¼ì‹œ", "í™”ì„±ì‹œ", "í‰íƒì‹œ", "ì˜ì •ë¶€ì‹œ", "ì‹œí¥ì‹œ", "íŒŒì£¼ì‹œ", "ê¹€í¬ì‹œ", "ê´‘ëª…ì‹œ", "ê´‘ì£¼ì‹œ", "êµ°í¬ì‹œ", "í•˜ë‚¨ì‹œ", "ì˜¤ì‚°ì‹œ", "ì–‘ì£¼ì‹œ", "ì´ì²œì‹œ", "êµ¬ë¦¬ì‹œ", "ì•ˆì„±ì‹œ", "í¬ì²œì‹œ", "ì˜ì™•ì‹œ", "ì–‘í‰êµ°", "ì—¬ì£¼ì‹œ", "ë™ë‘ì²œì‹œ", "ê³¼ì²œì‹œ", "ê°€í‰êµ°", "ì—°ì²œêµ°"],
                dongs: {
                    "ìˆ˜ì›ì‹œ": ["ì¥ì•ˆêµ¬", "ê¶Œì„ êµ¬", "íŒ”ë‹¬êµ¬", "ì˜í†µêµ¬"],
                    "ì„±ë‚¨ì‹œ": ["ìˆ˜ì •êµ¬", "ì¤‘ì›êµ¬", "ë¶„ë‹¹êµ¬"],
                    "ê³ ì–‘ì‹œ": ["ë•ì–‘êµ¬", "ì¼ì‚°ë™êµ¬", "ì¼ì‚°ì„œêµ¬"],
                    "ìš©ì¸ì‹œ": ["ì²˜ì¸êµ¬", "ê¸°í¥êµ¬", "ìˆ˜ì§€êµ¬"],
                    "ì•ˆì‚°ì‹œ": ["ìƒë¡êµ¬", "ë‹¨ì›êµ¬"],
                    "ì•ˆì–‘ì‹œ": ["ë§Œì•ˆêµ¬", "ë™ì•ˆêµ¬"]
                }
            },
            "ê°•ì›íŠ¹ë³„ìì¹˜ë„": {
                districts: ["ì¶˜ì²œì‹œ", "ì›ì£¼ì‹œ", "ê°•ë¦‰ì‹œ", "ë™í•´ì‹œ", "íƒœë°±ì‹œ", "ì†ì´ˆì‹œ", "ì‚¼ì²™ì‹œ", "í™ì²œêµ°", "íš¡ì„±êµ°", "ì˜ì›”êµ°", "í‰ì°½êµ°", "ì •ì„ êµ°", "ì² ì›êµ°", "í™”ì²œêµ°", "ì–‘êµ¬êµ°", "ì¸ì œêµ°", "ê³ ì„±êµ°", "ì–‘ì–‘êµ°"],
                dongs: {
                    "ì¶˜ì²œì‹œ": ["ì†Œì–‘ë™", "ì¡°ì–‘ë™", "í‡´ê³„ë™", "íš¨ìë™", "ì„ì‚¬ë™", "í›„í‰ë™", "ì˜¨ì˜ë™"],
                    "ì›ì£¼ì‹œ": ["ì¤‘ì•™ë™", "ì›ì¸ë™", "ê°œìš´ë™", "ëª…ë¥œë™", "ë‹¨êµ¬ë™", "í•™ì„±ë™", "íƒœì¥ë™", "ë´‰ì‚°ë™"],
                    "ê°•ë¦‰ì‹œ": ["í™ì œë™", "ì¤‘ì•™ë™", "ì˜¥ì²œë™", "êµë™", "í¬ë‚¨ë™", "ì„±ë‚¨ë™", "ê°•ë‚¨ë™"]
                }
            },
            "ì¶©ì²­ë¶ë„": {
                districts: ["ì²­ì£¼ì‹œ", "ì¶©ì£¼ì‹œ", "ì œì²œì‹œ", "ë³´ì€êµ°", "ì˜¥ì²œêµ°", "ì˜ë™êµ°", "ì¦í‰êµ°", "ì§„ì²œêµ°", "ê´´ì‚°êµ°", "ìŒì„±êµ°", "ë‹¨ì–‘êµ°"],
                dongs: {
                    "ì²­ì£¼ì‹œ": ["ìƒë‹¹êµ¬", "ì„œì›êµ¬", "í¥ë•êµ¬", "ì²­ì›êµ¬"],
                    "ì¶©ì£¼ì‹œ": ["êµí˜„ë™", "ì„±ë‚´ë™", "ë¬¸í™”ë™", "ì¹ ê¸ˆë™", "ë´‰ë°©ë™"],
                    "ì œì²œì‹œ": ["ì¤‘ì•™ë™", "ì˜ë¦¼ë™", "ëª…ë™", "ì²­ì „ë™", "ì˜ì²œë™"]
                }
            },
            "ì¶©ì²­ë‚¨ë„": {
                districts: ["ì²œì•ˆì‹œ", "ê³µì£¼ì‹œ", "ë³´ë ¹ì‹œ", "ì•„ì‚°ì‹œ", "ì„œì‚°ì‹œ", "ë…¼ì‚°ì‹œ", "ê³„ë£¡ì‹œ", "ë‹¹ì§„ì‹œ", "ê¸ˆì‚°êµ°", "ë¶€ì—¬êµ°", "ì„œì²œêµ°", "ì²­ì–‘êµ°", "í™ì„±êµ°", "ì˜ˆì‚°êµ°", "íƒœì•ˆêµ°"],
                dongs: {
                    "ì²œì•ˆì‹œ": ["ë™ë‚¨êµ¬", "ì„œë¶êµ¬"],
                    "ì•„ì‚°ì‹œ": ["ì—¼ì¹˜ì", "ë°°ë°©ì", "ì†¡ì•…ë©´", "íƒ•ì •ë©´"],
                    "ì„œì‚°ì‹œ": ["ë™ë¬¸ë™", "ìˆ˜ì„ë™", "ì˜¨ì„ë™", "ìë‚´ë™"]
                }
            },
            "ì „ë¶íŠ¹ë³„ìì¹˜ë„": {
                districts: ["ì „ì£¼ì‹œ", "êµ°ì‚°ì‹œ", "ìµì‚°ì‹œ", "ì •ìì‹œ", "ë‚¨ì›ì‹œ", "ê¹€ì œì‹œ", "ì™„ì£¼êµ°", "ì§„ì•ˆêµ°", "ë¬´ì£¼êµ°", "ì¥ìˆ˜êµ°", "ì„ì‹¤êµ°", "ìˆœì°½êµ°", "ê³ ì°½êµ°", "ë¶€ì•ˆêµ°"],
                dongs: {
                    "ì „ì£¼ì‹œ": ["ì™„ì‚°êµ¬", "ë•ì§„êµ¬"],
                    "êµ°ì‚°ì‹œ": ["í•´ë§ë™", "ì¤‘ì•™ë¡œ", "ê²½ì•”ë™", "ìˆ˜ì†¡ë™", "ì‚¼í•™ë™"],
                    "ìµì‚°ì‹œ": ["ì¤‘ì•™ë™", "ì–´ì–‘ë™", "ëª¨í˜„ë™", "ë‚¨ì¤‘ë™", "ì˜ë“±ë™"]
                }
            },
            "ì „ë¼ë‚¨ë„": {
                districts: ["ëª©í¬ì‹œ", "ì—¬ìˆ˜ì‹œ", "ìˆœì²œì‹œ", "ë‚˜ì£¼ì‹œ", "ê´‘ì–‘ì‹œ", "ë‹´ì–‘êµ°", "ê³¡ì„±êµ°", "êµ¬ë¡€êµ°", "ê³ í¥êµ°", "ë³´ì„±êµ°", "í™”ìˆœêµ°", "ì¥í¥êµ°", "ê°•ì§„êµ°", "í•´ë‚¨êµ°", "ì˜ì•”êµ°", "ë¬´ì•ˆêµ°", "í•¨í‰êµ°", "ì˜ê´‘êµ°", "ì¥ì„±êµ°", "ì™„ë„êµ°", "ì§„ë„êµ°", "ì‹ ì•ˆêµ°"],
                dongs: {
                    "ëª©í¬ì‹œ": ["ìš©í•´ë™", "ì—°ë™", "ì‚°ì •ë™", "í˜¸ë‚¨ë™", "ëŒ€ì„±ë™"],
                    "ì—¬ìˆ˜ì‹œ": ["ë¬¸ìˆ˜ë™", "ì—¬ì„œë™", "ë‘”ë•ë™", "êµ­ë™", "ì†Œë¼ë©´"],
                    "ìˆœì²œì‹œ": ["ì¡°ê³¡ë™", "ë•ì—°ë™", "ì—°í–¥ë™", "ì™•ì¡°ë™", "í’ë•ë™"]
                }
            },
            "ê²½ìƒë¶ë„": {
                districts: ["í¬í•­ì‹œ", "ê²½ì£¼ì‹œ", "ê¹€ì²œì‹œ", "ì•ˆë™ì‹œ", "êµ¬ë¯¸ì‹œ", "ì˜ì£¼ì‹œ", "ì˜ì²œì‹œ", "ìƒì£¼ì‹œ", "ë¬¸ê²½ì‹œ", "ê²½ì‚°ì‹œ", "ì˜ì„±êµ°", "ì²­ì†¡êµ°", "ì˜ì–‘êµ°", "ì˜ë•êµ°", "ì²­ë„êµ°", "ê³ ë ¹êµ°", "ì„±ì£¼êµ°", "ì¹ ê³¡êµ°", "ì˜ˆì²œêµ°", "ë´‰í™”êµ°", "ìš¸ì§„êµ°", "ìš¸ë¦‰êµ°"],
                dongs: {
                    "í¬í•­ì‹œ": ["ë‚¨êµ¬", "ë¶êµ¬"],
                    "ê²½ì£¼ì‹œ": ["ë™ì²œë™", "ì„±ê±´ë™", "í™©ë‚¨ë™", "ë³´ë•ë™", "ë¶ˆêµ­ë™"],
                    "êµ¬ë¯¸ì‹œ": ["ì†¡ì •ë™", "ì›í‰ë™", "ì§€ì‚°ë™", "í˜•ê³¡ë™", "ë„ëŸ‰ë™"]
                }
            },
            "ê²½ìƒë‚¨ë„": {
                districts: ["ì°½ì›ì‹œ", "ì§„ì£¼ì‹œ", "í†µì˜ì‹œ", "ì‚¬ì²œì‹œ", "ê¹€í•´ì‹œ", "ë°€ì–‘ì‹œ", "ê±°ì œì‹œ", "ì–‘ì‚°ì‹œ", "ì˜ë ¹êµ°", "í•¨ì•ˆêµ°", "ì°½ë…•êµ°", "ê³ ì„±êµ°", "ë‚¨í•´êµ°", "í•˜ë™êµ°", "ì‚°ì²­êµ°", "í•¨ì–‘êµ°", "ê±°ì°½êµ°", "í•©ì²œêµ°"],
                dongs: {
                    "ì°½ì›ì‹œ": ["ì˜ì°½êµ¬", "ì„±ì‚°êµ¬", "ë§ˆì‚°í•©í¬êµ¬", "ë§ˆì‚°íšŒì›êµ¬", "ì§„í•´êµ¬"],
                    "ê¹€í•´ì‹œ": ["íšŒí˜„ë™", "ë¶€ì›ë™", "ë‚´ë™", "ì™¸ë™", "ì‚¼ê³„ë™", "ë¶ˆì•”ë™"],
                    "ì–‘ì‚°ì‹œ": ["ì¤‘ë¶€ë™", "ë‚¨ë¶€ë™", "ë¶ë¶€ë™", "ì„œì°½ë™", "ì†Œì£¼ë™"]
                }
            },
            "ì œì£¼íŠ¹ë³„ìì¹˜ë„": {
                districts: ["ì œì£¼ì‹œ", "ì„œê·€í¬ì‹œ"],
                dongs: {
                    "ì œì£¼ì‹œ": ["ì¼ë„ë™", "ì´ë„ë™", "ì‚¼ë„ë™", "ìš©ë‹´ë™", "ê±´ì…ë™", "í™”ë¶ë™", "ì‚¼ì–‘ë™", "ë´‰ê°œë™", "ì•„ë¼ë™", "ì˜¤ë¼ë™", "ì—°ë™", "ë…¸í˜•ë™", "ì™¸ë„ë™", "ì´í˜¸ë™", "ë„ë‘ë™"],
                    "ì„œê·€í¬ì‹œ": ["ì„œê·€ë™", "ì„œí™ë™", "ì†¡ì‚°ë™", "ì •ë°©ë™", "ì¤‘ì•™ë™", "ì²œì§€ë™", "íš¨ëˆë™", "ì˜ì²œë™", "ë™í™ë™", "ì„œí˜¸ë™", "í˜¸ê·¼ë™"]
                }
            }
        };

        // ìƒí’ˆ ëª©ë¡ ë°ì´í„°
        const giftProducts = [
            {
                id: 'gifticon_5000',
                name: 'í‚¤í”„í‹°ì½˜ 5ì²œì›ê¶Œ',
                icon: 'â˜•',
                price: 5000,
                description: 'ìŠ¤íƒ€ë²…ìŠ¤, íˆ¬ì¸í”Œë ˆì´ìŠ¤ ë“±',
                category: 'gifticon',
                popular: true,
                stock: true
            },
            {
                id: 'gifticon_10000',
                name: 'í‚¤í”„í‹°ì½˜ 1ë§Œì›ê¶Œ',
                icon: 'ğŸ”',
                price: 10000,
                description: 'ë²„ê±°í‚¹, ë§¥ë„ë‚ ë“œ ë“±',
                category: 'gifticon',
                popular: true,
                stock: true
            },
            {
                id: 'culture_5000',
                name: 'ë¬¸í™”ìƒí’ˆê¶Œ 5ì²œì›',
                icon: 'ğŸ«',
                price: 5000,
                description: 'ì˜¨/ì˜¤í”„ë¼ì¸ ì‚¬ìš© ê°€ëŠ¥',
                category: 'culture',
                popular: false,
                stock: true
            },
            {
                id: 'culture_10000',
                name: 'ë¬¸í™”ìƒí’ˆê¶Œ 1ë§Œì›',
                icon: 'ğŸŸï¸',
                price: 10000,
                description: 'ì˜¨/ì˜¤í”„ë¼ì¸ ì‚¬ìš© ê°€ëŠ¥',
                category: 'culture',
                popular: true,
                stock: true
            },
            {
                id: 'starbucks_5000',
                name: 'ìŠ¤íƒ€ë²…ìŠ¤ 5ì²œì›',
                icon: 'â˜•',
                price: 5000,
                description: 'ìŠ¤íƒ€ë²…ìŠ¤ ì „ ë§¤ì¥',
                category: 'coffee',
                popular: true,
                stock: true
            },
            {
                id: 'convenience_3000',
                name: 'GS25 3ì²œì›ê¶Œ',
                icon: 'ğŸª',
                price: 3000,
                description: 'GS25 í¸ì˜ì ',
                category: 'convenience',
                popular: false,
                stock: true
            },
            {
                id: 'convenience_5000',
                name: 'CU 5ì²œì›ê¶Œ',
                icon: 'ğŸ¬',
                price: 5000,
                description: 'CU í¸ì˜ì ',
                category: 'convenience',
                popular: false,
                stock: true
            },
            {
                id: 'chicken_15000',
                name: 'ì¹˜í‚¨ êµí™˜ê¶Œ',
                icon: 'ğŸ—',
                price: 15000,
                description: 'BBQ, bhc, êµì´Œ ë“±',
                category: 'food',
                popular: true,
                stock: true
            },
            {
                id: 'icecream_3000',
                name: 'ë°°ìŠ¤í‚¨ë¼ë¹ˆìŠ¤ 3ì²œì›',
                icon: 'ğŸ¦',
                price: 3000,
                description: 'ë°°ìŠ¤í‚¨ë¼ë¹ˆìŠ¤ ë§¤ì¥',
                category: 'dessert',
                popular: false,
                stock: true
            },
            {
                id: 'movie_12000',
                name: 'ì˜í™” ê´€ëŒê¶Œ',
                icon: 'ğŸ¬',
                price: 12000,
                description: 'CGV, ë¡¯ë°ì‹œë„¤ë§ˆ ë“±',
                category: 'entertainment',
                popular: true,
                stock: true
            },
            {
                id: 'book_5000',
                name: 'ë„ì„œë¬¸í™”ìƒí’ˆê¶Œ 5ì²œì›',
                icon: 'ğŸ“š',
                price: 5000,
                description: 'ì˜¨/ì˜¤í”„ë¼ì¸ ì„œì ',
                category: 'book',
                popular: false,
                stock: true
            },
            {
                id: 'game_10000',
                name: 'êµ¬ê¸€ ê¸°í”„íŠ¸ì¹´ë“œ 1ë§Œì›',
                icon: 'ğŸ®',
                price: 10000,
                description: 'Google Play ìŠ¤í† ì–´',
                category: 'game',
                popular: true,
                stock: true
            }
        ];

        // ë°ì´í„° ì´ˆê¸°í™” í•¨ìˆ˜
        function resetAllData() {
            if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ê³  9ê°œ ìƒ˜í”Œ ì„¤ë¬¸ì„ ë‹¤ì‹œ ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€» íšŒì›, ì„¤ë¬¸, ì°¸ì—¬ ê¸°ë¡ì´ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.')) {
                localStorage.clear();
                alert('âœ… ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
                location.reload();
            }
        }

        function init() {
            initSampleSurveys();
            initRegionSelects();
            const user = localStorage.getItem('currentUser');
            if (user) {
                currentUser = JSON.parse(user);
                showDashboard();
            } else {
                showScreen('welcomeScreen');
            }
        }

        // ì§€ì—­ ì„ íƒ ì´ˆê¸°í™”
        function initRegionSelects() {
            const sidoSelects = ['regRegionSido', 'editRegionSido', 'surveyTargetRegionSido'];
            sidoSelects.forEach(selectId => {
                const sidoSelect = document.getElementById(selectId);
                if (sidoSelect) {
                    // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²«ë²ˆì§¸ ì˜µì…˜ ì œì™¸)
                    while (sidoSelect.options.length > 1) {
                        sidoSelect.remove(1);
                    }
                    // ê´‘ì—­ì‹œë„ ì¶”ê°€
                    Object.keys(regionsData).forEach(sido => {
                        const option = document.createElement('option');
                        option.value = sido;
                        option.textContent = sido;
                        sidoSelect.appendChild(option);
                    });
                }
            });
        }

        // ì‹œêµ°êµ¬ ì—…ë°ì´íŠ¸
        function updateRegionDistricts(prefix) {
            const sido = document.getElementById(prefix + 'RegionSido').value;
            const districtSelect = document.getElementById(prefix + 'RegionDistrict');
            const dongSelect = document.getElementById(prefix + 'RegionDong');

            // ì´ˆê¸°í™”
            districtSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            dongSelect.innerHTML = '<option value="">ì‹œêµ°êµ¬ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
            dongSelect.disabled = true;

            if (sido && regionsData[sido]) {
                districtSelect.disabled = false;
                regionsData[sido].districts.forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });
            } else {
                districtSelect.disabled = true;
            }
        }

        // ìë©´ë™ ì—…ë°ì´íŠ¸
        function updateRegionDongs(prefix) {
            const sido = document.getElementById(prefix + 'RegionSido').value;
            const district = document.getElementById(prefix + 'RegionDistrict').value;
            const dongSelect = document.getElementById(prefix + 'RegionDong');

            dongSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';

            if (sido && district && regionsData[sido] && regionsData[sido].dongs && regionsData[sido].dongs[district]) {
                dongSelect.disabled = false;
                regionsData[sido].dongs[district].forEach(dong => {
                    const option = document.createElement('option');
                    option.value = dong;
                    option.textContent = dong;
                    dongSelect.appendChild(option);
                });
            } else {
                dongSelect.disabled = true;
                dongSelect.innerHTML = '<option value="">ìë©´ë™ ë°ì´í„° ì—†ìŒ</option>';
            }
        }

        function initSampleSurveys() {
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            const version = localStorage.getItem('surveyVersion') || '0';

            // v5.0 ì„¤ë¬¸ ë¡œë“œ (ë²„ì „ ì²´í¬ë¡œ í•­ìƒ ìµœì‹  ìœ ì§€)
            if (surveys.length === 0 || version !== '5.0') {
                const sampleSurveys = [
                    {id: 'sample1', creatorId: 'system', title: 'ğŸ“± ëª¨ë°”ì¼ ì•± ì‚¬ìš©ì„± ì¡°ì‚¬', description: 'ì¼ìƒì—ì„œ ì‚¬ìš©í•˜ëŠ” ëª¨ë°”ì¼ ì•±ì— ëŒ€í•œ ë§Œì¡±ë„ë¥¼ ì¡°ì‚¬í•©ë‹ˆë‹¤.', organizer: 'ë””ì§€í„¸ë§ˆì¼€íŒ…ì—°êµ¬ì†Œ', targetResponses: 200, rewardPoints: 150, targetAgeMin: null, targetAgeMax: null, targetGender: '', targetRegion: null, targetJob: '', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'radio', question: 'í•˜ë£¨ì— ìŠ¤ë§ˆíŠ¸í°ì„ ì‚¬ìš©í•˜ëŠ” ì‹œê°„ì€?', required: true, options: ['1ì‹œê°„ ë¯¸ë§Œ', '1-3ì‹œê°„', '3-5ì‹œê°„', '5ì‹œê°„ ì´ìƒ']}, {id: 2, type: 'checkbox', question: 'ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì•± ìœ í˜•ì€? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['SNS', 'ì‡¼í•‘', 'ê²Œì„', 'ë‰´ìŠ¤', 'ë™ì˜ìƒ']}, {id: 3, type: 'text', question: 'ê°€ì¥ ìì£¼ ì‚¬ìš©í•˜ëŠ” ì•± ì´ë¦„ì„ ì•Œë ¤ì£¼ì„¸ìš”.', required: true}, {id: 4, type: 'radio', question: 'ì „ë°˜ì ì¸ ë§Œì¡±ë„ëŠ”?', required: true, options: ['ë§¤ìš° ë§Œì¡±', 'ë§Œì¡±', 'ë³´í†µ', 'ë¶ˆë§Œì¡±', 'ë§¤ìš° ë¶ˆë§Œì¡±']}]},
                    {id: 'sample2', creatorId: 'system', title: 'ğŸ›’ ì˜¨ë¼ì¸ ì‡¼í•‘ ê²½í—˜ ì„¤ë¬¸', description: 'ì˜¨ë¼ì¸ ì‡¼í•‘ëª° ì´ìš© ê²½í—˜ê³¼ ê°œì„ ì‚¬í•­ì„ íŒŒì•…í•˜ê¸° ìœ„í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', organizer: 'í•œêµ­ì´ì»¤ë¨¸ìŠ¤í˜‘íšŒ', targetResponses: 150, rewardPoints: 200, targetAgeMin: 20, targetAgeMax: 40, targetGender: '', targetRegion: null, targetJob: 'íšŒì‚¬ì›', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'radio', question: 'í•œ ë‹¬ í‰ê·  ì˜¨ë¼ì¸ ì‡¼í•‘ ë¹ˆë„ëŠ”?', required: true, options: ['ì£¼ 3íšŒ ì´ìƒ', 'ì£¼ 1-2íšŒ', 'ì›” 2-3íšŒ', 'ì›” 1íšŒ ë¯¸ë§Œ']}, {id: 2, type: 'checkbox', question: 'ì£¼ë¡œ êµ¬ë§¤í•˜ëŠ” ìƒí’ˆ ì¹´í…Œê³ ë¦¬ëŠ”? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ì˜ë¥˜/íŒ¨ì…˜', 'ì‹í’ˆ', 'ì „ìì œí’ˆ', 'ë„ì„œ/ë¬¸êµ¬', 'ìƒí™œìš©í’ˆ']}, {id: 3, type: 'select', question: 'ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ìš”ì†ŒëŠ”?', required: true, options: ['ê°€ê²©', 'ë°°ì†¡ì†ë„', 'í’ˆì§ˆ', 'í›„ê¸°', 'êµí™˜/í™˜ë¶ˆ ì •ì±…']}, {id: 4, type: 'textarea', question: 'ì˜¨ë¼ì¸ ì‡¼í•‘ëª°ì—ì„œ ê°œì„ ë˜ì—ˆìœ¼ë©´ í•˜ëŠ” ì ì´ ìˆë‹¤ë©´?', required: false}]},
                    {id: 'sample3', creatorId: 'system', title: 'â˜• ì¹´í˜ ì´ìš© ìŠµê´€ ì¡°ì‚¬', description: 'ì¹´í˜ ë°©ë¬¸ ë¹ˆë„ì™€ ì„ í˜¸ë„ë¥¼ ì•Œì•„ë³´ëŠ” ì„¤ë¬¸ì…ë‹ˆë‹¤.', organizer: 'ì„œìš¸ì‹œë¦½ëŒ€ ì†Œë¹„ìí–‰ë™ì—°êµ¬íŒ€', targetResponses: 100, rewardPoints: 100, targetAgeMin: null, targetAgeMax: null, targetGender: '', targetRegion: {sido: 'ì„œìš¸íŠ¹ë³„ì‹œ', district: '', dong: '', fullAddress: 'ì„œìš¸íŠ¹ë³„ì‹œ'}, targetJob: '', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'radio', question: 'ì¼ì£¼ì¼ì— ì¹´í˜ ë°©ë¬¸ íšŸìˆ˜ëŠ”?', required: true, options: ['ê±°ì˜ ë§¤ì¼', 'ì£¼ 3-4íšŒ', 'ì£¼ 1-2íšŒ', 'ì›” 1-2íšŒ', 'ê±°ì˜ ë°©ë¬¸ ì•ˆ í•¨']}, {id: 2, type: 'checkbox', question: 'ì¹´í˜ë¥¼ ë°©ë¬¸í•˜ëŠ” ì£¼ìš” ëª©ì ì€? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ì»¤í”¼/ìŒë£Œ', 'ê³µë¶€/ì—…ë¬´', 'ì¹œêµ¬ ë§Œë‚¨', 'í˜¼ìë§Œì˜ ì‹œê°„', 'ë””ì €íŠ¸']}, {id: 3, type: 'radio', question: '1íšŒ ë°©ë¬¸ ì‹œ í‰ê·  ì§€ì¶œ ê¸ˆì•¡ì€?', required: true, options: ['5,000ì› ë¯¸ë§Œ', '5,000-10,000ì›', '10,000-15,000ì›', '15,000ì› ì´ìƒ']}]},
                    {id: 'sample4', creatorId: 'system', title: 'ğŸ¬ OTT ì„œë¹„ìŠ¤ ì´ìš© ì‹¤íƒœ', description: 'ë„·í”Œë¦­ìŠ¤, ë””ì¦ˆë‹ˆ+, ì¿ íŒ¡í”Œë ˆì´ ë“± OTT ì„œë¹„ìŠ¤ ì´ìš©ì— ëŒ€í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', organizer: 'ë¯¸ë””ì–´ë¦¬ì„œì¹˜ì„¼í„°', targetResponses: 250, rewardPoints: 120, targetAgeMin: 15, targetAgeMax: 35, targetGender: '', targetRegion: null, targetJob: '', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'checkbox', question: 'í˜„ì¬ êµ¬ë… ì¤‘ì¸ OTT ì„œë¹„ìŠ¤ëŠ”? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ë„·í”Œë¦­ìŠ¤', 'ë””ì¦ˆë‹ˆ+', 'ì¿ íŒ¡í”Œë ˆì´', 'í‹°ë¹™', 'ì›¨ì´ë¸Œ', 'êµ¬ë… ì•ˆ í•¨']}, {id: 2, type: 'radio', question: 'í•˜ë£¨ í‰ê·  OTT ì‹œì²­ ì‹œê°„ì€?', required: true, options: ['1ì‹œê°„ ë¯¸ë§Œ', '1-2ì‹œê°„', '2-3ì‹œê°„', '3ì‹œê°„ ì´ìƒ']}, {id: 3, type: 'select', question: 'ì„ í˜¸í•˜ëŠ” ì½˜í…ì¸  ì¥ë¥´ëŠ”?', required: true, options: ['ë“œë¼ë§ˆ', 'ì˜í™”', 'ì˜ˆëŠ¥', 'ë‹¤íë©˜í„°ë¦¬', 'ì• ë‹ˆë©”ì´ì…˜']}, {id: 4, type: 'radio', question: 'ì›” êµ¬ë…ë£Œë¡œ ì ì •í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ê¸ˆì•¡ì€?', required: true, options: ['5,000ì› ì´í•˜', '5,000-10,000ì›', '10,000-15,000ì›', '15,000ì› ì´ìƒ']}]},
                    {id: 'sample5', creatorId: 'system', title: 'ğŸ’ª ìš´ë™ ìŠµê´€ ì„¤ë¬¸', description: 'ìš´ë™ ë¹ˆë„ì™€ ì„ í˜¸í•˜ëŠ” ìš´ë™ ìœ í˜•ì„ ì•Œì•„ë³´ëŠ” ê°„ë‹¨í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', organizer: 'ìŠ¤í¬ì¸ ê³¼í•™ì—°êµ¬ì›', targetResponses: 100, rewardPoints: 80, targetAgeMin: null, targetAgeMax: null, targetGender: '', targetRegion: null, targetJob: '', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'radio', question: 'ì¼ì£¼ì¼ì— ìš´ë™í•˜ëŠ” íšŸìˆ˜ëŠ”?', required: true, options: ['ê±°ì˜ ì•ˆ í•¨', 'ì£¼ 1íšŒ', 'ì£¼ 2-3íšŒ', 'ì£¼ 4íšŒ ì´ìƒ']}, {id: 2, type: 'checkbox', question: 'ì„ í˜¸í•˜ëŠ” ìš´ë™ ì¢…ë¥˜ëŠ”? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ê±·ê¸°/ëŸ¬ë‹', 'í—¬ìŠ¤/ì›¨ì´íŠ¸', 'ìˆ˜ì˜', 'ìš”ê°€/í•„ë¼í…ŒìŠ¤', 'êµ¬ê¸°ì¢…ëª©', 'ìì „ê±°']}, {id: 3, type: 'radio', question: 'ìš´ë™í•˜ëŠ” ì£¼ëœ ì´ìœ ëŠ”?', required: true, options: ['ê±´ê°• ê´€ë¦¬', 'ë‹¤ì´ì–´íŠ¸', 'ì²´ë ¥ ì¦ì§„', 'ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ', 'ì·¨ë¯¸']}]},
                    {id: 'sample6', creatorId: 'system', title: 'ğŸ• ìŒì‹ ì„ í˜¸ë„ ì¡°ì‚¬', description: 'ì¢‹ì•„í•˜ëŠ” ìŒì‹ê³¼ ì‹ì‚¬ ìŠµê´€ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', organizer: 'ì‹í’ˆì˜ì–‘í•™ê³¼', targetResponses: 150, rewardPoints: 60, targetAgeMin: null, targetAgeMax: null, targetGender: '', targetRegion: null, targetJob: 'í•™ìƒ', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'checkbox', question: 'ì¢‹ì•„í•˜ëŠ” ìŒì‹ ì¢…ë¥˜ëŠ”? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['í•œì‹', 'ì¤‘ì‹', 'ì¼ì‹', 'ì–‘ì‹', 'ë¶„ì‹', 'íŒ¨ìŠ¤íŠ¸í‘¸ë“œ']}, {id: 2, type: 'radio', question: 'í•˜ë£¨ í‰ê·  ì™¸ì‹ íšŸìˆ˜ëŠ”?', required: true, options: ['ê±°ì˜ ì•ˆ í•¨', '1íšŒ', '2íšŒ', '3íšŒ ì´ìƒ']}, {id: 3, type: 'select', question: 'ì‹ì‚¬ ë©”ë‰´ ì„ íƒ ì‹œ ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†ŒëŠ”?', required: true, options: ['ë§›', 'ê°€ê²©', 'ê±´ê°•', 'í¸ì˜ì„±', 'ë¶„ìœ„ê¸°']}]},
                    {id: 'sample7', creatorId: 'system', title: 'ğŸš— ì¶œí‡´ê·¼/í†µí•™ ìˆ˜ë‹¨ ì„¤ë¬¸', description: 'ì¼ìƒì ì¸ ì´ë™ ìˆ˜ë‹¨ê³¼ ì†Œìš” ì‹œê°„ì— ëŒ€í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', organizer: 'êµí†µì—°êµ¬ì›', targetResponses: 120, rewardPoints: 90, targetAgeMin: null, targetAgeMax: null, targetGender: '', targetRegion: {sido: 'ê²½ê¸°ë„', district: '', dong: '', fullAddress: 'ê²½ê¸°ë„'}, targetJob: '', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'radio', question: 'ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì´ë™ ìˆ˜ë‹¨ì€?', required: true, options: ['ì§€í•˜ì² ', 'ë²„ìŠ¤', 'ìê°€ìš©', 'ë„ë³´', 'ìì „ê±°/í‚¥ë³´ë“œ', 'íƒì‹œ/ì¹´í’€']}, {id: 2, type: 'radio', question: 'í‰ê·  í†µê·¼/í†µí•™ ì‹œê°„ì€?', required: true, options: ['30ë¶„ ë¯¸ë§Œ', '30ë¶„-1ì‹œê°„', '1-2ì‹œê°„', '2ì‹œê°„ ì´ìƒ']}, {id: 3, type: 'checkbox', question: 'ì´ë™ ì¤‘ ì£¼ë¡œ í•˜ëŠ” í™œë™ì€? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ìŠ¤ë§ˆíŠ¸í° ì‚¬ìš©', 'ìŒì•… ë“£ê¸°', 'ë…ì„œ', 'ìˆ˜ë©´', 'ì—…ë¬´/ê³µë¶€', 'ì•„ë¬´ê²ƒë„ ì•ˆ í•¨']}]},
                    {id: 'sample8', creatorId: 'system', title: 'ğŸ¨ ì·¨ë¯¸ ìƒí™œ ì¡°ì‚¬', description: 'ì—¬ê°€ ì‹œê°„ í™œìš©ê³¼ ì·¨ë¯¸ í™œë™ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', organizer: 'ë¬¸í™”ì—¬ê°€ì—°êµ¬ì†Œ', targetResponses: 100, rewardPoints: 70, targetAgeMin: null, targetAgeMax: null, targetGender: 'ì—¬ì„±', targetRegion: null, targetJob: '', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'checkbox', question: 'í˜„ì¬ ì¦ê¸°ëŠ” ì·¨ë¯¸ëŠ”? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ìš´ë™', 'ë…ì„œ', 'ì˜í™”/ë“œë¼ë§ˆ', 'ê²Œì„', 'ìš”ë¦¬', 'ì—¬í–‰', 'ìŒì•… ê°ìƒ', 'ì‚¬ì§„/ì˜ìƒ']}, {id: 2, type: 'radio', question: 'ì£¼ë§ì— ì·¨ë¯¸ í™œë™ì— í• ì• í•˜ëŠ” ì‹œê°„ì€?', required: true, options: ['1ì‹œê°„ ë¯¸ë§Œ', '1-3ì‹œê°„', '3-5ì‹œê°„', '5ì‹œê°„ ì´ìƒ']}, {id: 3, type: 'text', question: 'ìƒˆë¡­ê²Œ ì‹œì‘í•˜ê³  ì‹¶ì€ ì·¨ë¯¸ê°€ ìˆë‹¤ë©´?', required: false}]},
                    {id: 'sample9', creatorId: 'system', title: 'ğŸ¥ ê±´ê°•ê´€ë¦¬ ì‹¤íƒœ ì¡°ì‚¬', description: 'ê±´ê°• ê´€ë¦¬ì™€ ìƒí™œ ìŠµê´€ì— ëŒ€í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.', organizer: 'êµ­ë¦½ë³´ê±´ì—°êµ¬ì›', targetResponses: 80, rewardPoints: 110, targetAgeMin: 30, targetAgeMax: 50, targetGender: '', targetRegion: null, targetJob: 'ì „ë¬¸ì§', createdAt: new Date().toISOString(), participants: 0, questions: [{id: 1, type: 'radio', question: 'í‰ê·  ìˆ˜ë©´ ì‹œê°„ì€?', required: true, options: ['5ì‹œê°„ ë¯¸ë§Œ', '5-6ì‹œê°„', '7-8ì‹œê°„', '8ì‹œê°„ ì´ìƒ']}, {id: 2, type: 'checkbox', question: 'ê±´ê°•ì„ ìœ„í•´ ì‹¤ì²œí•˜ëŠ” ê²ƒì€? (ë³µìˆ˜ì„ íƒ)', required: true, options: ['ê·œì¹™ì ì¸ ìš´ë™', 'ê±´ê°•ì‹ ì„­ì·¨', 'ì¶©ë¶„í•œ ìˆ˜ë©´', 'ê¸ˆì—°/ê¸ˆì£¼', 'ê±´ê°•ê²€ì§„', 'íŠ¹ë³„íˆ ì—†ìŒ']}, {id: 3, type: 'radio', question: 'ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€ì€?', required: true, options: ['ë§¤ìš° ë†’ìŒ', 'ë†’ìŒ', 'ë³´í†µ', 'ë‚®ìŒ', 'ë§¤ìš° ë‚®ìŒ']}]}
                ];
                localStorage.setItem('surveys', JSON.stringify(sampleSurveys));
                localStorage.setItem('surveyVersion', '5.0');
            }
        }

        function showScreen(screenId) {
            const screens = ['welcomeScreen', 'loginScreen', 'registerScreen', 'dashboardScreen', 'createSurveyScreen', 'participateScreen', 'giftShopScreen', 'myPageScreen', 'analyticsScreen', 'availableSurveysScreen', 'templateMarketScreen', 'adminSettingsScreen'];
            screens.forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
        }

        function showLogin() { showScreen('loginScreen'); }
        function showRegister() { showScreen('registerScreen'); }

        function showMyPage() {
            showScreen('myPageScreen');
            updatePoints();
            switchMyPageTab('profile');
            loadProfileData();
        }

        function switchMyPageTab(tab) {
            const tabs = document.querySelectorAll('#myPageScreen .tab-btn');
            tabs.forEach(btn => btn.classList.remove('active'));

            document.getElementById('profileTab').classList.add('hidden');
            document.getElementById('createdTab').classList.add('hidden');
            document.getElementById('participatedTab').classList.add('hidden');
            document.getElementById('referralTab').classList.add('hidden');

            if (tab === 'profile') {
                tabs[0].classList.add('active');
                document.getElementById('profileTab').classList.remove('hidden');
                loadProfileData();
            } else if (tab === 'created') {
                tabs[1].classList.add('active');
                document.getElementById('createdTab').classList.remove('hidden');
                loadCreatedSurveys();
            } else if (tab === 'participated') {
                tabs[2].classList.add('active');
                document.getElementById('participatedTab').classList.remove('hidden');
                loadParticipatedSurveys();
            } else if (tab === 'referral') {
                tabs[3].classList.add('active');
                document.getElementById('referralTab').classList.remove('hidden');
                loadReferralData();
            }
        }

        // ì¶”ì²œ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function loadReferralData() {
            // ë‚´ ì¶”ì²œ ì½”ë“œ í‘œì‹œ
            document.getElementById('myReferralCode').textContent = currentUser.referralCode || '------';

            // ì¶”ì²œ í†µê³„ ê³„ì‚°
            const referrals = JSON.parse(localStorage.getItem('referrals') || '[]');
            const myReferrals = referrals.filter(r => r.referrerId === currentUser.id);
            const completedReferrals = myReferrals.filter(r => r.referrerRewardGiven);
            const totalEarnings = completedReferrals.length * 5000;

            document.getElementById('totalReferrals').textContent = myReferrals.length;
            document.getElementById('completedReferrals').textContent = completedReferrals.length;
            document.getElementById('totalReferralEarnings').textContent = totalEarnings.toLocaleString();

            // ì¶”ì²œí•œ ì¹œêµ¬ ëª©ë¡
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const referralList = document.getElementById('referralList');

            if (myReferrals.length === 0) {
                referralList.innerHTML = '<p style="color: #999; margin-top: 15px; text-align: center;">ì•„ì§ ì¶”ì²œí•œ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.<br>ì¹œêµ¬ì—ê²Œ ì½”ë“œë¥¼ ê³µìœ í•˜ê³  í•¨ê»˜ í¬ì¸íŠ¸ë¥¼ ë°›ì•„ë³´ì„¸ìš”!</p>';
                return;
            }

            referralList.innerHTML = myReferrals.map(referral => {
                const referee = users.find(u => u.id === referral.refereeId);
                if (!referee) return '';

                const completedSurveys = referee.completedSurveys || 0;
                const status = referral.referrerRewardGiven
                    ? `<span style="color: #28a745; font-weight: bold;">âœ… ë³´ìƒ ì™„ë£Œ (5,000P ì§€ê¸‰ë¨)</span>`
                    : `<span style="color: #666;">â³ ì§„í–‰ì¤‘ (${completedSurveys}/3ê°œ ì™„ë£Œ)</span>`;

                return `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid ${referral.referrerRewardGiven ? '#28a745' : '#5B7C99'};">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 16px; font-weight: bold; margin-bottom: 5px;">ğŸ‘¤ ${referee.name}</div>
                                <div style="font-size: 13px; color: #666;">ê°€ì…ì¼: ${new Date(referral.createdAt).toLocaleDateString('ko-KR')}</div>
                            </div>
                            <div style="text-align: right;">
                                ${status}
                                ${!referral.referrerRewardGiven && completedSurveys < 3 ? `<div style="font-size: 12px; color: #999; margin-top: 5px;">ì„¤ë¬¸ ${3 - completedSurveys}ê°œ ë” í•„ìš”</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).filter(html => html).join('');
        }

        function copyReferralCode() {
            const code = currentUser.referralCode;
            if (!code) {
                alert('ì¶”ì²œ ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // í´ë¦½ë³´ë“œì— ë³µì‚¬
            navigator.clipboard.writeText(code).then(() => {
                alert(`âœ… ì¶”ì²œ ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì½”ë“œ: ${code}\n\nì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ì„¸ìš”!`);
            }).catch(() => {
                // êµ¬ë²„ì „ ë¸Œë¼ìš°ì € ëŒ€ì‘
                const textarea = document.createElement('textarea');
                textarea.value = code;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert(`âœ… ì¶”ì²œ ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì½”ë“œ: ${code}\n\nì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ì„¸ìš”!`);
            });
        }

        function shareReferralLink() {
            const code = currentUser.referralCode;
            if (!code) {
                alert('ì¶”ì²œ ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const message = `ğŸ ì„¤ë¬¸ ë§¤ì¹­ í”Œë«í¼ ì´ˆëŒ€ì¥\n\níšŒì›ê°€ì… ì‹œ 100,000P ì§€ê¸‰!\në‚´ ì¶”ì²œ ì½”ë“œ: ${code}\n\níšŒì›ê°€ì… í›„ ì„¤ë¬¸ 3ê°œë§Œ ì™„ë£Œí•˜ë©´\nì¶”ê°€ë¡œ 3,000Pë¥¼ ë“œë¦½ë‹ˆë‹¤! ğŸ‰\n\nâ€» ë‚˜ë„ 5,000Pë¥¼ ë°›ì•„ìš”!`;

            if (navigator.share) {
                navigator.share({
                    title: 'ì„¤ë¬¸ ë§¤ì¹­ í”Œë«í¼ ì´ˆëŒ€',
                    text: message
                }).catch(() => {
                    copyTextToShare(message);
                });
            } else {
                copyTextToShare(message);
            }
        }

        function copyTextToShare(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('âœ… ì´ˆëŒ€ ë©”ì‹œì§€ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ì„¸ìš”!');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('âœ… ì´ˆëŒ€ ë©”ì‹œì§€ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ì„¸ìš”!');
            });
        }

        function loadProfileData() {
            // í‰ì  ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('myPageRating').textContent = (currentUser.rating || 3.0).toFixed(1);
            document.getElementById('myPageCompletedCount').textContent = currentUser.completedSurveys || 0;

            document.getElementById('editName').value = currentUser.name;
            document.getElementById('editEmail').value = currentUser.email;
            document.getElementById('editPhone').value = currentUser.phone;
            document.getElementById('editBirthDate').value = currentUser.birthDate;
            document.getElementById('editGender').value = currentUser.gender;
            document.getElementById('editJob').value = currentUser.job;

            // ì§€ì—­ ì •ë³´ ë¡œë“œ
            if (typeof currentUser.region === 'object' && currentUser.region.sido) {
                document.getElementById('editRegionSido').value = currentUser.region.sido;
                updateRegionDistricts('edit');
                setTimeout(() => {
                    document.getElementById('editRegionDistrict').value = currentUser.region.district;
                    updateRegionDongs('edit');
                    setTimeout(() => {
                        document.getElementById('editRegionDong').value = currentUser.region.dong;
                    }, 50);
                }, 50);
            }
        }

        function updateProfile() {
            const name = document.getElementById('editName').value;
            const phone = document.getElementById('editPhone').value;
            const birthDate = document.getElementById('editBirthDate').value;
            const gender = document.getElementById('editGender').value;
            const regionSido = document.getElementById('editRegionSido').value;
            const regionDistrict = document.getElementById('editRegionDistrict').value;
            const regionDong = document.getElementById('editRegionDong').value;
            const job = document.getElementById('editJob').value;

            if (!name || !phone || !birthDate || !gender || !regionSido || !regionDistrict || !job) {
                document.getElementById('profileMessage').innerHTML = '<div class="error-msg">ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
                return;
            }

            const region = {
                sido: regionSido,
                district: regionDistrict,
                dong: regionDong || '',
                fullAddress: `${regionSido} ${regionDistrict}${regionDong ? ' ' + regionDong : ''}`
            };

            currentUser.name = name;
            currentUser.phone = phone;
            currentUser.birthDate = birthDate;
            currentUser.gender = gender;
            currentUser.region = region;
            currentUser.job = job;

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                document.getElementById('profileMessage').innerHTML = '<div class="success-msg">ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
                setTimeout(() => {
                    document.getElementById('profileMessage').innerHTML = '';
                }, 3000);
            }
        }

        function loadCreatedSurveys() {
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            const mySurveys = surveys.filter(s => s.creatorId === currentUser.id);
            const list = document.getElementById('createdSurveysList');

            if (mySurveys.length === 0) {
                list.innerHTML = '<p style="color: #999; margin-top: 15px;">ì•„ì§ ë“±ë¡í•œ ì„¤ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = mySurveys.map(survey => `
                <div class="survey-item" onclick="viewMySurveyDetail('${survey.id}')">
                    <div class="survey-title">${survey.title}</div>
                    <div class="survey-desc">${survey.description}</div>
                    ${survey.organizer ? `<div class="survey-info" style="color: #5B7C99; font-weight: 500;">ğŸ¢ ${survey.organizer}</div>` : ''}
                    <div class="survey-info">ğŸ¯ ëŒ€ìƒ: ${formatTargetInfo(survey)}</div>
                    <div class="survey-info">ëª©í‘œ: ${survey.targetResponses}ëª… | ë³´ìƒ: ${survey.rewardPoints}P | ì°¸ì—¬: ${survey.participants || 0}ëª…</div>
                    <div class="survey-info" style="font-size: 11px; color: #999;">ìƒì„±ì¼: ${new Date(survey.createdAt).toLocaleString('ko-KR')}</div>
                </div>
            `).join('');
        }

        function loadParticipatedSurveys() {
            const participations = JSON.parse(localStorage.getItem('participations') || '[]');
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            const myParticipations = participations.filter(p => p.userId === currentUser.id);
            const list = document.getElementById('participatedSurveysList');

            if (myParticipations.length === 0) {
                list.innerHTML = '<p style="color: #999; margin-top: 15px;">ì•„ì§ ì°¸ì—¬í•œ ì„¤ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = myParticipations.map(participation => {
                const survey = surveys.find(s => s.id === participation.surveyId);
                if (!survey) return '';
                return `
                    <div class="survey-item">
                        <div class="survey-title">${survey.title} <span class="badge badge-points">+${survey.rewardPoints}P</span></div>
                        <div class="survey-desc">${survey.description}</div>
                        ${survey.organizer ? `<div class="survey-info" style="color: #5B7C99; font-weight: 500;">ğŸ¢ ${survey.organizer}</div>` : ''}
                        <div class="survey-info" style="font-size: 11px; color: #999;">ì°¸ì—¬ì¼: ${new Date(participation.completedAt).toLocaleString('ko-KR')}</div>
                    </div>
                `;
            }).join('');
        }

        function updatePoints() {
            const points = currentUser.points || 0;
            ['userPoints', 'userPoints2', 'userPoints3', 'userPoints4', 'userPoints5', 'userPoints6', 'userPoints7'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = `ğŸ’° ${points.toLocaleString()} P`;
            });
            const display = document.getElementById('userPointsDisplay');
            if (display) display.textContent = points.toLocaleString();
            const currentPointsEl = document.getElementById('currentPoints');
            if (currentPointsEl) currentPointsEl.textContent = points.toLocaleString();

            // í‰ì  ë°°ì§€ ì—…ë°ì´íŠ¸
            const rating = (currentUser.rating || 3.0).toFixed(1);
            const ratingBadge = document.getElementById('userRatingBadge');
            if (ratingBadge) {
                const tooltipHTML = ratingBadge.querySelector('.rating-tooltip').outerHTML;
                ratingBadge.innerHTML = `â­ ${rating}${tooltipHTML}`;
            }
        }

        // ì¶”ì²œ ì½”ë“œ ìƒì„± í•¨ìˆ˜ (6ìë¦¬ ëœë¤)
        function generateReferralCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function register() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const phone = document.getElementById('regPhone').value;
            const birthDate = document.getElementById('regBirthDate').value;
            const gender = document.getElementById('regGender').value;
            const regionSido = document.getElementById('regRegionSido').value;
            const regionDistrict = document.getElementById('regRegionDistrict').value;
            const regionDong = document.getElementById('regRegionDong').value;
            const job = document.getElementById('regJob').value;
            const referralCode = document.getElementById('regReferralCode').value.trim().toUpperCase();

            if (!name || !email || !password || !phone || !birthDate || !gender || !regionSido || !regionDistrict || !job) {
                document.getElementById('registerMessage').innerHTML = '<div class="error-msg">ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
                return;
            }
            if (password.length < 8) {
                document.getElementById('registerMessage').innerHTML = '<div class="error-msg">ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.</div>';
                return;
            }
            if (phone.length < 10) {
                document.getElementById('registerMessage').innerHTML = '<div class="error-msg">ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>';
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '[]');

            // ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸
            if (users.find(u => u.email === email)) {
                document.getElementById('registerMessage').innerHTML = '<div class="error-msg">ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.</div>';
                return;
            }

            // ì „í™”ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸ (ì–´ë·°ì§• ë°©ì§€)
            if (users.find(u => u.phone === phone)) {
                document.getElementById('registerMessage').innerHTML = '<div class="error-msg">âš ï¸ ì´ë¯¸ ë“±ë¡ëœ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤. (1ì¸ 1ê³„ì •ë§Œ ê°€ëŠ¥)</div>';
                return;
            }

            // ì¶”ì²œ ì½”ë“œ ê²€ì¦
            let referrerId = null;
            if (referralCode) {
                const referrer = users.find(u => u.referralCode === referralCode);
                if (!referrer) {
                    document.getElementById('registerMessage').innerHTML = '<div class="error-msg">âŒ ìœ íš¨í•˜ì§€ ì•Šì€ ì¶”ì²œì¸ ì½”ë“œì…ë‹ˆë‹¤.</div>';
                    return;
                }
                referrerId = referrer.id;
            }

            // ì§€ì—­ ì •ë³´ ì¡°í•©
            const region = {
                sido: regionSido,
                district: regionDistrict,
                dong: regionDong || '',
                fullAddress: `${regionSido} ${regionDistrict}${regionDong ? ' ' + regionDong : ''}`
            };

            // ê³ ìœ í•œ ì¶”ì²œ ì½”ë“œ ìƒì„±
            let myReferralCode;
            do {
                myReferralCode = generateReferralCode();
            } while (users.find(u => u.referralCode === myReferralCode));

            const newUserId = Date.now().toString();

            users.push({
                id: newUserId,
                name, email, password, phone, birthDate, gender, region, job,
                points: 100000,
                rating: 3.0,
                completedSurveys: 0,
                referralCode: myReferralCode,
                referredBy: referrerId,
                referralRewardReceived: false, // ì¶”ì²œ ë³´ìƒì„ ë°›ì•˜ëŠ”ì§€ ì—¬ë¶€
                createdAt: new Date().toISOString()
            });

            // ì¶”ì²œ ê´€ê³„ ì €ì¥
            if (referrerId) {
                const referrals = JSON.parse(localStorage.getItem('referrals') || '[]');
                referrals.push({
                    id: Date.now().toString(),
                    referrerId: referrerId,
                    refereeId: newUserId,
                    referrerRewardGiven: false,
                    refereeRewardGiven: false,
                    createdAt: new Date().toISOString()
                });
                localStorage.setItem('referrals', JSON.stringify(referrals));
            }

            localStorage.setItem('users', JSON.stringify(users));

            let message = `ğŸ‰ íšŒì›ê°€ì… ì™„ë£Œ! 100,000P ì§€ê¸‰!<br>ğŸ« ë‚´ ì¶”ì²œ ì½”ë“œ: <strong>${myReferralCode}</strong>`;
            if (referrerId) {
                message += '<br>ğŸ‘¥ ì¶”ì²œì¸ ë“±ë¡ ì™„ë£Œ! ì„¤ë¬¸ 3ê°œ ì™„ë£Œ ì‹œ ë³´ìƒì´ ì§€ê¸‰ë©ë‹ˆë‹¤.';
            }

            document.getElementById('registerMessage').innerHTML = `<div class="success-msg">${message}</div>`;
            setTimeout(() => showLogin(), 3000);
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                document.getElementById('loginMessage').innerHTML = '<div class="error-msg">ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>';
                return;
            }

            let users = JSON.parse(localStorage.getItem('users') || '[]');

            if (email === 'test@example.com' && !users.find(u => u.email === email)) {
                users.push({
                    id: 'test-user', name: 'í…ŒìŠ¤í„°', email: 'test@example.com', password: 'password123',
                    phone: '01012345678', birthDate: '1990-01-01', gender: 'ë‚¨ì„±',
                    region: {sido: 'ì„œìš¸íŠ¹ë³„ì‹œ', district: 'ê°•ë‚¨êµ¬', dong: 'ì—­ì‚¼ë™', fullAddress: 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™'},
                    job: 'íšŒì‚¬ì›',
                    points: 100000, rating: 3.0, completedSurveys: 0,
                    referralCode: 'TEST01',
                    referredBy: null,
                    referralRewardReceived: false,
                    createdAt: new Date().toISOString()
                });
                localStorage.setItem('users', JSON.stringify(users));
            }

            const user = users.find(u => u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                showDashboard();
            } else {
                document.getElementById('loginMessage').innerHTML = '<div class="error-msg">ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>';
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showScreen('welcomeScreen');
        }

        function showDashboard() {
            showScreen('dashboardScreen');
            document.getElementById('userNameHeader').textContent = currentUser.name;

            // ëŒ€ì‹œë³´ë“œ ë‚´ ì •ë³´ ì˜ì—­ ì—…ë°ì´íŠ¸
            document.getElementById('dashboardUserName').textContent = currentUser.name;
            document.getElementById('dashboardPoints').textContent = (currentUser.points || 0).toLocaleString();
            document.getElementById('dashboardRating').textContent = (currentUser.rating || 3.0).toFixed(1);

            // ê´€ë¦¬ì ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€ (ê´€ë¦¬ì ê³„ì •ë§Œ í‘œì‹œ)
            const adminBtn = document.getElementById('adminModeBtn');
            if (currentUser.id === 1 || currentUser.isAdmin) {
                adminBtn.style.display = 'inline-block';
            } else {
                adminBtn.style.display = 'none';
            }

            updatePoints();
            updateDashboardStats();
            loadMySurveys();
            loadAvailableSurveys(5); // ë©”ì¸ ëŒ€ì‹œë³´ë“œì—ëŠ” 5ê°œë§Œ í‘œì‹œ
            loadFeaturedBanner();
            applyThemeSettings(); // ì €ì¥ëœ í…Œë§ˆ ì„¤ì • ì ìš©
        }

        function updateDashboardStats() {
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            const mySurveys = surveys.filter(s => s.creatorId === currentUser.id);
            const participations = JSON.parse(localStorage.getItem('participations') || '[]');
            const myParticipations = participations.filter(p => p.userId === currentUser.id);
            const availableSurveys = surveys.filter(s => {
                if (s.creatorId === currentUser.id) return false;
                if (myParticipations.find(p => p.surveyId === s.id)) return false;
                if (!matchesSurveyTarget(s, currentUser)) return false;
                return true;
            });

            document.getElementById('mySurveysCount').textContent = mySurveys.length;
            document.getElementById('availableSurveysCount').textContent = availableSurveys.length;
            document.getElementById('completedSurveysCount').textContent = myParticipations.length;
        }

        function loadMySurveys() {
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            const mySurveys = surveys.filter(s => s.creatorId === currentUser.id);
            const list = document.getElementById('mySurveysList');

            if (mySurveys.length === 0) {
                list.innerHTML = '<p style="color: #999; margin-top: 15px;">ì•„ì§ ë§Œë“  ì„¤ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = mySurveys.map(survey => `
                <div class="survey-item" onclick="viewMySurveyDetail('${survey.id}')">
                    <div class="survey-title">${survey.title}</div>
                    <div class="survey-desc">${survey.description}</div>
                    ${survey.organizer ? `<div class="survey-info" style="color: #5B7C99; font-weight: 500;">ğŸ¢ ${survey.organizer}</div>` : ''}
                    <div class="survey-info">ğŸ¯ ëŒ€ìƒ: ${formatTargetInfo(survey)}</div>
                    <div class="survey-info">ëª©í‘œ: ${survey.targetResponses}ëª… | ë³´ìƒ: ${survey.rewardPoints}P</div>
                </div>
            `).join('');
        }

        // íƒ€ê²Ÿ ì¡°ê±´ í‘œì‹œ í•¨ìˆ˜
        function formatTargetInfo(survey) {
            const conditions = [];

            if (survey.targetAgeMin || survey.targetAgeMax) {
                if (survey.targetAgeMin && survey.targetAgeMax) {
                    conditions.push(`${survey.targetAgeMin}-${survey.targetAgeMax}ì„¸`);
                } else if (survey.targetAgeMin) {
                    conditions.push(`${survey.targetAgeMin}ì„¸ ì´ìƒ`);
                } else {
                    conditions.push(`${survey.targetAgeMax}ì„¸ ì´í•˜`);
                }
            }

            if (survey.targetGender) {
                conditions.push(survey.targetGender);
            }

            if (survey.targetRegion && survey.targetRegion.sido) {
                conditions.push(survey.targetRegion.fullAddress);
            }

            if (survey.targetJob) {
                conditions.push(survey.targetJob);
            }

            if (survey.minRating) {
                conditions.push(`â­${survey.minRating}ì  ì´ìƒ`);
            }

            return conditions.length > 0 ? conditions.join(' Â· ') : 'ì „ì²´ ëŒ€ìƒ';
        }

        function loadAvailableSurveys(limit = null) {
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            const participations = JSON.parse(localStorage.getItem('participations') || '[]');
            const myParticipations = participations.filter(p => p.userId === currentUser.id);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            let available = surveys.filter(s => {
                if (s.creatorId === currentUser.id) return false;
                if (myParticipations.find(p => p.surveyId === s.id)) return false;
                if (!matchesSurveyTarget(s, currentUser)) return false;

                // ê¸°ê°„ ì²´í¬
                if (s.startDate) {
                    const startDate = new Date(s.startDate);
                    startDate.setHours(0, 0, 0, 0);
                    if (today < startDate) return false;
                }
                if (s.endDate) {
                    const endDate = new Date(s.endDate);
                    endDate.setHours(23, 59, 59, 999);
                    if (today > endDate) return false;
                }

                return true;
            });

            // limitê°€ ìˆìœ¼ë©´ ì œí•œ
            if (limit) {
                available = available.slice(0, limit);
            }

            const list = document.getElementById('availableSurveysList');
            if (available.length === 0) {
                list.innerHTML = '<p style="color: #999; margin-top: 15px;">í˜„ì¬ ì°¸ì—¬ ê°€ëŠ¥í•œ ì„¤ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = available.map(survey => {
                let periodText = '';
                if (survey.startDate || survey.endDate) {
                    const start = survey.startDate ? new Date(survey.startDate).toLocaleDateString('ko-KR', {month: 'short', day: 'numeric'}) : 'ì¦‰ì‹œ';
                    const end = survey.endDate ? new Date(survey.endDate).toLocaleDateString('ko-KR', {month: 'short', day: 'numeric'}) : 'ëª©í‘œ ë‹¬ì„± ì‹œ';
                    periodText = `<div class="survey-info" style="color: #5B7C99;">ğŸ“… ê¸°ê°„: ${start} ~ ${end}</div>`;
                }
                return `
                    <div class="survey-item" onclick="startSurveyParticipation('${survey.id}')">
                        <div class="survey-title">${survey.title} <span class="badge">ì°¸ì—¬ ê°€ëŠ¥</span></div>
                        <div class="survey-desc">${survey.description}</div>
                        ${survey.organizer ? `<div class="survey-info" style="color: #5B7C99; font-weight: 500;">ğŸ¢ ${survey.organizer}</div>` : ''}
                        ${periodText}
                        <div class="survey-info">ğŸ¯ ëŒ€ìƒ: ${formatTargetInfo(survey)}</div>
                        <div class="survey-info">ğŸ ë³´ìƒ: ${survey.rewardPoints}P <span class="badge badge-points">+${survey.rewardPoints}P</span></div>
                    </div>
                `;
            }).join('');
        }

        function showCreateSurvey() {
            showScreen('createSurveyScreen');
            updatePoints();
            // í¬ì¸íŠ¸ ëª…ì‹œì  ì—…ë°ì´íŠ¸
            document.getElementById('createSurveyPoints').textContent = (currentUser.points || 0).toLocaleString();
            initRegionSelects();
            questions = [];
            questionCounter = 0;
            document.getElementById('questionsContainer').innerHTML = '';
            // íƒ€ê²ŸíŒ… í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('surveyTargetAgeMin').value = '';
            document.getElementById('surveyTargetAgeMax').value = '';
            document.getElementById('surveyTargetGender').value = '';
            document.getElementById('surveyTargetRegionSido').value = '';
            document.getElementById('surveyTargetRegionDistrict').value = '';
            document.getElementById('surveyTargetRegionDistrict').disabled = true;
            document.getElementById('surveyTargetRegionDong').value = '';
            document.getElementById('surveyTargetRegionDong').disabled = true;
            document.getElementById('surveyTargetJob').value = '';
            document.getElementById('surveyMinRating').value = '';
            document.getElementById('surveyStartDate').value = '';
            document.getElementById('surveyEndDate').value = '';
            updatePricingInfo(); // ìš”ê¸ˆì œ ì •ë³´ ì´ˆê¸°í™”
            addQuestion();
        }

        // ìš”ê¸ˆì œ ì •ë³´ ì—…ë°ì´íŠ¸
        function updatePricingInfo() {
            const plan = document.getElementById('surveyPricingPlan').value;
            const pricingPlans = {
                basic: { name: 'ê¸°ë³¸', price: 3000, maxResponses: 50 },
                standard: { name: 'í‘œì¤€', price: 7000, maxResponses: 100 },
                premium: { name: 'í”„ë¦¬ë¯¸ì—„', price: 15000, maxResponses: 200 },
                enterprise: { name: 'ì—”í„°í”„ë¼ì´ì¦ˆ', price: 30000, maxResponses: 'ë¬´ì œí•œ' }
            };

            const selectedPlan = pricingPlans[plan];
            const infoDiv = document.getElementById('pricingInfo');

            infoDiv.innerHTML = `
                <strong>ğŸ’¡ ${selectedPlan.name} ìš”ê¸ˆì œ</strong><br>
                â€¢ ë¹„ìš©: ${selectedPlan.price.toLocaleString()} P<br>
                â€¢ ìµœëŒ€ ì‘ë‹µ ìˆ˜: ${selectedPlan.maxResponses}ëª…<br>
                â€¢ ì„¤ë¬¸ ë“±ë¡ ì‹œ í¬ì¸íŠ¸ê°€ ì°¨ê°ë©ë‹ˆë‹¤<br>
                â€¢ í˜„ì¬ ë³´ìœ  í¬ì¸íŠ¸: ${currentUser.points.toLocaleString()} P
            `;

            // í¬ì¸íŠ¸ ë¶€ì¡± ì‹œ ê²½ê³  í‘œì‹œ
            if (currentUser.points < selectedPlan.price) {
                infoDiv.style.background = '#f8d7da';
                infoDiv.style.borderColor = '#dc3545';
                infoDiv.innerHTML += `<br><strong style="color: #dc3545;">âš ï¸ í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! (ë¶€ì¡±: ${(selectedPlan.price - currentUser.points).toLocaleString()} P)</strong>`;
            } else {
                infoDiv.style.background = '#fff3cd';
                infoDiv.style.borderColor = '#ffc107';
            }

            // ëª©í‘œ ì‘ë‹µ ìˆ˜ ìë™ ì¡°ì •
            const targetInput = document.getElementById('surveyTarget');
            if (plan !== 'enterprise' && parseInt(targetInput.value) > selectedPlan.maxResponses) {
                targetInput.value = selectedPlan.maxResponses;
            }
        }

        function addQuestion() {
            questionCounter++;
            const questionId = questionCounter;
            const questionHtml = `
                <div class="question-item" id="question${questionId}">
                    <div class="question-header">
                        <h4>ì§ˆë¬¸ ${questionId}</h4>
                        <div class="question-controls">
                            <button type="button" class="btn btn-small btn-danger" onclick="removeQuestion(${questionId})">ì‚­ì œ</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ì§ˆë¬¸ ë‚´ìš©</label>
                        <input type="text" id="qText${questionId}" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label>ì§ˆë¬¸ ìœ í˜•</label>
                        <select id="qType${questionId}" onchange="updateQuestionType(${questionId})">
                            <option value="radio">ê°ê´€ì‹ (ë‹¨ì¼ì„ íƒ)</option>
                            <option value="checkbox">ì²´í¬ë°•ìŠ¤ (ë³µìˆ˜ì„ íƒ)</option>
                            <option value="select">ë“œë¡­ë‹¤ìš´</option>
                            <option value="text">ë‹¨ë‹µí˜•</option>
                            <option value="textarea">ì¥ë¬¸í˜•</option>
                        </select>
                    </div>
                    <div id="optionsContainer${questionId}" class="form-group">
                        <label>ì„ íƒì§€</label>
                        <div id="options${questionId}">
                            <div class="option-item">
                                <input type="text" class="option-input" placeholder="ì„ íƒì§€ 1">
                                <button type="button" class="btn btn-small" onclick="addOption(${questionId})">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" id="qRequired${questionId}" checked> í•„ìˆ˜ ì§ˆë¬¸</label>
                    </div>
                </div>
            `;
            document.getElementById('questionsContainer').insertAdjacentHTML('beforeend', questionHtml);
        }

        function removeQuestion(questionId) {
            document.getElementById(`question${questionId}`).remove();
        }

        function updateQuestionType(questionId) {
            const type = document.getElementById(`qType${questionId}`).value;
            const optionsContainer = document.getElementById(`optionsContainer${questionId}`);
            optionsContainer.style.display = (type === 'text' || type === 'textarea') ? 'none' : 'block';
        }

        function addOption(questionId) {
            const container = document.getElementById(`options${questionId}`);
            const optionCount = container.children.length + 1;
            const optionHtml = `
                <div class="option-item">
                    <input type="text" class="option-input" placeholder="ì„ íƒì§€ ${optionCount}">
                    <button type="button" class="btn btn-small btn-danger" onclick="this.parentElement.remove()">-</button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', optionHtml);
        }

        // AI ê¸°ë°˜ ì„¤ë¬¸ í’ˆì§ˆ ê²€ì¦
        function validateSurveyQuality() {
            const title = document.getElementById('surveyTitle').value;
            const description = document.getElementById('surveyDesc').value;
            const questionElements = document.querySelectorAll('.question-item');

            // ê¸°ë³¸ ê²€ì¦
            if (!title || !description) {
                document.getElementById('qualityResult').innerHTML = '<div class="error-msg">âš ï¸ ì œëª©ê³¼ ì„¤ëª…ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.</div>';
                return;
            }

            if (questionElements.length === 0) {
                document.getElementById('qualityResult').innerHTML = '<div class="error-msg">âš ï¸ ìµœì†Œ 1ê°œ ì´ìƒì˜ ì§ˆë¬¸ì„ ì¶”ê°€í•˜ì„¸ìš”.</div>';
                return;
            }

            // ë¶€ì ì ˆí•œ í‚¤ì›Œë“œ ë°ì´í„°ë² ì´ìŠ¤
            const inappropriateKeywords = [
                'ê°œìƒˆë¼', 'ì”¨ë°œ', 'ë³‘ì‹ ', 'ì¢†', 'ë¯¸ì¹œ', 'ë˜ë¼ì´', 'ìƒˆë¼', 'ì£½ì–´', 'ì£½ì¼',
                'ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸', 'ê³„ì¢Œë²ˆí˜¸', 'ë¹„ë°€ë²ˆí˜¸', 'ì¹´ë“œë²ˆí˜¸', 'ì‹ ìš©ì¹´ë“œ',
                'í†µì¥', 'ê³µì¸ì¸ì¦ì„œ', 'ì€í–‰', 'ê³„ì¢Œ', 'ì†¡ê¸ˆ',
                'ëˆë²Œê¸°', 'ì¬í…Œí¬', 'íˆ¬ì', 'ìˆ˜ìµ', 'ë¶€ì—…', 'MLM', 'í”¼ë¼ë¯¸ë“œ'
            ];

            const lowQualityKeywords = ['ì–´ë–¤ì§€', 'ì–´ë– í•œì§€', 'ì–´ë–»ê²Œ', 'ì¢‹ì€ì§€', 'ì–´ë•Œìš”', '~ìš”'];

            let score = 100;
            let issues = [];
            let warnings = [];

            // 1. ì œëª© ê²€ì¦
            if (title.length < 5) {
                score -= 15;
                issues.push('ì œëª©ì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤ (5ì ì´ìƒ ê¶Œì¥)');
            }
            if (title.length > 100) {
                score -= 10;
                issues.push('ì œëª©ì´ ë„ˆë¬´ ê¹ë‹ˆë‹¤ (100ì ì´í•˜ ê¶Œì¥)');
            }

            // 2. ì„¤ëª… ê²€ì¦
            if (description.length < 10) {
                score -= 10;
                issues.push('ì„¤ëª…ì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤ (10ì ì´ìƒ ê¶Œì¥)');
            }

            // 3. ë¶€ì ì ˆí•œ í‚¤ì›Œë“œ ê²€ì¦
            const fullText = title + ' ' + description;
            let foundInappropriate = false;

            inappropriateKeywords.forEach(keyword => {
                if (fullText.includes(keyword)) {
                    score -= 40;
                    foundInappropriate = true;
                }
            });

            if (foundInappropriate) {
                issues.push('âš ï¸ ë¶€ì ì ˆí•œ í‘œí˜„ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤');
            }

            // 4. ì§ˆë¬¸ í’ˆì§ˆ ê²€ì¦
            let totalQuestions = 0;
            let shortQuestions = 0;
            let longQuestions = 0;
            let lowQualityQuestions = 0;
            let questionsWithoutOptions = 0;

            questionElements.forEach((el, index) => {
                const id = el.id.replace('question', '');
                const text = document.getElementById(`qText${id}`)?.value || '';
                const type = document.getElementById(`qType${id}`)?.value;

                if (!text) return;
                totalQuestions++;

                // ì§ˆë¬¸ ê¸¸ì´ ì²´í¬
                if (text.length < 5) {
                    shortQuestions++;
                    score -= 5;
                }
                if (text.length > 200) {
                    longQuestions++;
                    score -= 3;
                }

                // ì• ë§¤í•œ í‘œí˜„ ì²´í¬
                let foundLowQuality = false;
                lowQualityKeywords.forEach(keyword => {
                    if (text.includes(keyword)) {
                        foundLowQuality = true;
                    }
                });
                if (foundLowQuality) {
                    lowQualityQuestions++;
                    score -= 3;
                }

                // ë¶€ì ì ˆí•œ í‚¤ì›Œë“œ ì²´í¬
                inappropriateKeywords.forEach(keyword => {
                    if (text.includes(keyword)) {
                        score -= 30;
                        foundInappropriate = true;
                    }
                });

                // ì„ íƒí˜• ì§ˆë¬¸ì˜ ì„ íƒì§€ ì²´í¬
                if (type === 'radio' || type === 'checkbox' || type === 'select') {
                    const optionInputs = document.querySelectorAll(`#options${id} .option-input`);
                    const options = Array.from(optionInputs).map(input => input.value).filter(val => val.trim() !== '');
                    if (options.length < 2) {
                        questionsWithoutOptions++;
                        score -= 10;
                    }
                }
            });

            // ì´ìŠˆ ì •ë¦¬
            if (shortQuestions > 0) {
                warnings.push(`${shortQuestions}ê°œ ì§ˆë¬¸ì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤ (5ì ì´ìƒ ê¶Œì¥)`);
            }
            if (longQuestions > 0) {
                warnings.push(`${longQuestions}ê°œ ì§ˆë¬¸ì´ ë„ˆë¬´ ê¹ë‹ˆë‹¤ (200ì ì´í•˜ ê¶Œì¥)`);
            }
            if (lowQualityQuestions > 0) {
                warnings.push(`${lowQualityQuestions}ê°œ ì§ˆë¬¸ì— ì• ë§¤í•œ í‘œí˜„ì´ ìˆìŠµë‹ˆë‹¤ (êµ¬ì²´ì ì¸ ì§ˆë¬¸ ê¶Œì¥)`);
            }
            if (questionsWithoutOptions > 0) {
                issues.push(`${questionsWithoutOptions}ê°œ ì„ íƒí˜• ì§ˆë¬¸ì— ì„ íƒì§€ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤ (2ê°œ ì´ìƒ í•„ìš”)`);
            }

            // ìµœì†Œ ì§ˆë¬¸ ìˆ˜ ì²´í¬
            if (totalQuestions < 3) {
                score -= 10;
                warnings.push('ì§ˆë¬¸ì´ ë„ˆë¬´ ì ìŠµë‹ˆë‹¤ (3ê°œ ì´ìƒ ê¶Œì¥)');
            }

            // ìµœì¢… ì ìˆ˜ ì¡°ì •
            score = Math.max(0, Math.min(100, score));

            // ê²°ê³¼ í‘œì‹œ
            let scoreColor = '#dc3545'; // ë¹¨ê°•
            let scoreLabel = 'ë¶ˆí•©ê²©';
            let recommendation = 'ì„¤ë¬¸ì„ ë“±ë¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¬¸ì œë¥¼ ìˆ˜ì •í•˜ì„¸ìš”.';

            if (score >= 80) {
                scoreColor = '#28a745'; // ì´ˆë¡
                scoreLabel = 'ìš°ìˆ˜';
                recommendation = 'ë†’ì€ í’ˆì§ˆì˜ ì„¤ë¬¸ì…ë‹ˆë‹¤! ë°”ë¡œ ë“±ë¡í•˜ì„¸ìš”.';
            } else if (score >= 60) {
                scoreColor = '#ffc107'; // ë…¸ë‘
                scoreLabel = 'ë³´í†µ';
                recommendation = 'ë“±ë¡ ê°€ëŠ¥í•˜ì§€ë§Œ ê°œì„ ì„ ê¶Œì¥í•©ë‹ˆë‹¤.';
            }

            let resultHtml = `
                <div style="background: white; padding: 20px; border-radius: 8px; border: 2px solid ${scoreColor};">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 64px; font-weight: bold; color: ${scoreColor};">${score}</div>
                        <div style="font-size: 20px; color: ${scoreColor}; font-weight: bold;">${scoreLabel}</div>
                        <div style="font-size: 14px; color: #666; margin-top: 10px;">${recommendation}</div>
                    </div>

                    ${issues.length > 0 ? `
                        <div style="background: #f8d7da; padding: 15px; border-radius: 5px; margin-bottom: 10px;">
                            <strong style="color: #721c24;">ğŸš« ë¬¸ì œì  (${issues.length}ê°œ)</strong><br>
                            <ul style="margin: 10px 0 0 20px; color: #721c24;">
                                ${issues.map(issue => `<li>${issue}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    ${warnings.length > 0 ? `
                        <div style="background: #fff3cd; padding: 15px; border-radius: 5px;">
                            <strong style="color: #856404;">âš ï¸ ê°œì„  ê¶Œì¥ (${warnings.length}ê°œ)</strong><br>
                            <ul style="margin: 10px 0 0 20px; color: #856404;">
                                ${warnings.map(warning => `<li>${warning}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    <div style="margin-top: 15px; padding: 10px; background: #e7f3ff; border-radius: 5px; font-size: 13px; color: #004085;">
                        <strong>ğŸ’¡ í’ˆì§ˆ í–¥ìƒ íŒ:</strong><br>
                        â€¢ ëª…í™•í•˜ê³  êµ¬ì²´ì ì¸ ì§ˆë¬¸ì„ ì‘ì„±í•˜ì„¸ìš”<br>
                        â€¢ ì ì ˆí•œ ì„ íƒì§€ë¥¼ ì œê³µí•˜ì„¸ìš” (2-5ê°œ ê¶Œì¥)<br>
                        â€¢ ê°œì¸ì •ë³´ë¥¼ ìš”êµ¬í•˜ì§€ ë§ˆì„¸ìš”<br>
                        â€¢ ì¤‘ë¦½ì ì´ê³  ê³µì •í•œ ì§ˆë¬¸ì„ ì‚¬ìš©í•˜ì„¸ìš”
                    </div>
                </div>
            `;

            document.getElementById('qualityResult').innerHTML = resultHtml;

            // ì ìˆ˜ ì €ì¥ (ë‚˜ì¤‘ì— createSurveyì—ì„œ ì‚¬ìš©)
            window.lastQualityScore = score;
        }

        function createSurvey() {
            const title = document.getElementById('surveyTitle').value;
            const description = document.getElementById('surveyDesc').value;
            const organizer = document.getElementById('surveyOrganizer').value;
            const targetResponses = document.getElementById('surveyTarget').value;
            const rewardPoints = parseInt(document.getElementById('surveyRewardPoints').value) || 0;
            const startDate = document.getElementById('surveyStartDate').value || null;
            const endDate = document.getElementById('surveyEndDate').value || null;

            // íƒ€ê²ŸíŒ… ì •ë³´ ìˆ˜ì§‘
            const targetAgeMin = parseInt(document.getElementById('surveyTargetAgeMin').value) || null;
            const targetAgeMax = parseInt(document.getElementById('surveyTargetAgeMax').value) || null;
            const targetGender = document.getElementById('surveyTargetGender').value;
            const targetRegionSido = document.getElementById('surveyTargetRegionSido').value;
            const targetRegionDistrict = document.getElementById('surveyTargetRegionDistrict').value;
            const targetRegionDong = document.getElementById('surveyTargetRegionDong').value;
            const targetJob = document.getElementById('surveyTargetJob').value;
            const minRating = parseFloat(document.getElementById('surveyMinRating').value) || null;

            const targetRegion = targetRegionSido ? {
                sido: targetRegionSido,
                district: targetRegionDistrict || '',
                dong: targetRegionDong || '',
                fullAddress: `${targetRegionSido}${targetRegionDistrict ? ' ' + targetRegionDistrict : ''}${targetRegionDong ? ' ' + targetRegionDong : ''}`
            } : null;

            if (!title || !description) {
                document.getElementById('createMessage').innerHTML = '<div class="error-msg">ì œëª©ê³¼ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.</div>';
                return;
            }

            const collectedQuestions = [];
            const questionElements = document.querySelectorAll('.question-item');

            questionElements.forEach((el, index) => {
                const id = el.id.replace('question', '');
                const text = document.getElementById(`qText${id}`).value;
                const type = document.getElementById(`qType${id}`).value;
                const required = document.getElementById(`qRequired${id}`).checked;

                if (!text) return;

                const question = {id: index + 1, type: type, question: text, required: required};

                if (type === 'radio' || type === 'checkbox' || type === 'select') {
                    const optionInputs = document.querySelectorAll(`#options${id} .option-input`);
                    const options = Array.from(optionInputs).map(input => input.value).filter(val => val.trim() !== '');
                    if (options.length === 0) {
                        alert(`ì§ˆë¬¸ ${index + 1}ì— ì„ íƒì§€ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.`);
                        return;
                    }
                    question.options = options;
                }

                collectedQuestions.push(question);
            });

            if (collectedQuestions.length === 0) {
                document.getElementById('createMessage').innerHTML = '<div class="error-msg">ìµœì†Œ 1ê°œ ì´ìƒì˜ ì§ˆë¬¸ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.</div>';
                return;
            }

            // í’ˆì§ˆ ê²€ì¦ ì ìˆ˜ í™•ì¸
            if (!window.lastQualityScore) {
                if (!confirm('âš ï¸ í’ˆì§ˆ ê²€ì¦ì„ ì‹¤í–‰í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\ní’ˆì§ˆ ê²€ì¦ ì—†ì´ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(60ì  ë¯¸ë§Œ ì‹œ ë“±ë¡ì´ ì œí•œë©ë‹ˆë‹¤)')) {
                    return;
                }
                // í’ˆì§ˆ ê²€ì¦ ìë™ ì‹¤í–‰
                validateSurveyQuality();
                if (!window.lastQualityScore || window.lastQualityScore < 60) {
                    document.getElementById('createMessage').innerHTML = '<div class="error-msg">âŒ í’ˆì§ˆ ì ìˆ˜ê°€ 60ì  ë¯¸ë§Œì…ë‹ˆë‹¤. í’ˆì§ˆ ê²€ì¦ ê²°ê³¼ë¥¼ í™•ì¸í•˜ê³  ê°œì„  í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.</div>';
                    window.scrollTo({ top: document.getElementById('qualityCheckSection').offsetTop - 100, behavior: 'smooth' });
                    return;
                }
            } else if (window.lastQualityScore < 60) {
                document.getElementById('createMessage').innerHTML = '<div class="error-msg">âŒ í’ˆì§ˆ ì ìˆ˜ê°€ 60ì  ë¯¸ë§Œì…ë‹ˆë‹¤. ì„¤ë¬¸ì„ ê°œì„ í•˜ê³  í’ˆì§ˆ ê²€ì¦ì„ ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”.</div>';
                window.scrollTo({ top: document.getElementById('qualityCheckSection').offsetTop - 100, behavior: 'smooth' });
                return;
            }

            // ìš”ê¸ˆì œ í™•ì¸ ë° í¬ì¸íŠ¸ ì°¨ê°
            const selectedPlan = document.getElementById('surveyPricingPlan').value;
            const pricingPlans = {
                basic: { name: 'ê¸°ë³¸', price: 3000, maxResponses: 50 },
                standard: { name: 'í‘œì¤€', price: 7000, maxResponses: 100 },
                premium: { name: 'í”„ë¦¬ë¯¸ì—„', price: 15000, maxResponses: 200 },
                enterprise: { name: 'ì—”í„°í”„ë¼ì´ì¦ˆ', price: 30000, maxResponses: 999999 }
            };

            const plan = pricingPlans[selectedPlan];

            // ëª©í‘œ ì‘ë‹µ ìˆ˜ ê²€ì¦
            if (parseInt(targetResponses) > plan.maxResponses) {
                document.getElementById('createMessage').innerHTML = `<div class="error-msg">âŒ ${plan.name} ìš”ê¸ˆì œëŠ” ìµœëŒ€ ${plan.maxResponses}ëª…ê¹Œì§€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>ë” ë†’ì€ ìš”ê¸ˆì œë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>`;
                return;
            }

            // í¬ì¸íŠ¸ ë¶€ì¡± í™•ì¸
            if (currentUser.points < plan.price) {
                document.getElementById('createMessage').innerHTML = `<div class="error-msg">âŒ í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!<br><br>í•„ìš” í¬ì¸íŠ¸: ${plan.price.toLocaleString()} P<br>ë³´ìœ  í¬ì¸íŠ¸: ${currentUser.points.toLocaleString()} P<br>ë¶€ì¡± í¬ì¸íŠ¸: ${(plan.price - currentUser.points).toLocaleString()} P</div>`;
                return;
            }

            // ìµœì¢… í™•ì¸
            if (!confirm(`ğŸ’° ì„¤ë¬¸ ë“±ë¡ ìˆ˜ìˆ˜ë£Œ ì•ˆë‚´\n\nìš”ê¸ˆì œ: ${plan.name}\në¹„ìš©: ${plan.price.toLocaleString()} P\n\nì„¤ë¬¸ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€» ë“±ë¡ í›„ ë‚¨ì€ í¬ì¸íŠ¸: ${(currentUser.points - plan.price).toLocaleString()} P`)) {
                return;
            }

            // í¬ì¸íŠ¸ ì°¨ê°
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].points = currentUser.points - plan.price;
                localStorage.setItem('users', JSON.stringify(users));
                currentUser.points = users[userIndex].points;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }

            // ìˆ˜ìˆ˜ë£Œ ê²°ì œ ë‚´ì—­ ì €ì¥
            const feePayments = JSON.parse(localStorage.getItem('feePayments') || '[]');
            feePayments.push({
                id: Date.now().toString(),
                userId: currentUser.id,
                plan: selectedPlan,
                planName: plan.name,
                amount: plan.price,
                surveyTitle: title,
                paidAt: new Date().toISOString()
            });
            localStorage.setItem('feePayments', JSON.stringify(feePayments));

            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            surveys.push({
                id: Date.now().toString(),
                creatorId: currentUser.id,
                title, description, organizer, targetResponses, rewardPoints,
                startDate, endDate,
                targetAgeMin, targetAgeMax,
                targetGender,
                targetRegion,
                targetJob,
                minRating,
                questions: collectedQuestions,
                createdAt: new Date().toISOString(),
                participants: 0,
                pricingPlan: selectedPlan, // ìš”ê¸ˆì œ ì •ë³´ ì €ì¥
                registrationFee: plan.price, // ë“±ë¡ ìˆ˜ìˆ˜ë£Œ ì €ì¥
                qualityScore: window.lastQualityScore || 0 // í’ˆì§ˆ ì ìˆ˜ ì €ì¥
            });

            localStorage.setItem('surveys', JSON.stringify(surveys));

            let successMessage = `âœ… ì„¤ë¬¸ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!<br>ğŸ’° ${plan.price.toLocaleString()} Pê°€ ì°¨ê°ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ë‚¨ì€ í¬ì¸íŠ¸: ${currentUser.points.toLocaleString()} P`;
            if (window.lastQualityScore) {
                successMessage += `<br>ğŸ” í’ˆì§ˆ ì ìˆ˜: ${window.lastQualityScore}ì `;
            }

            document.getElementById('createMessage').innerHTML = `<div class="success-msg">${successMessage}</div>`;
            updatePoints(); // í¬ì¸íŠ¸ UI ì—…ë°ì´íŠ¸

            // í’ˆì§ˆ ì ìˆ˜ ì´ˆê¸°í™”
            window.lastQualityScore = null;

            setTimeout(() => showDashboard(), 2000);
        }

        function startSurveyParticipation(surveyId) {
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            currentSurvey = surveys.find(s => s.id === surveyId);

            showScreen('participateScreen');
            updatePoints();

            document.getElementById('participateTitle').textContent = currentSurvey.title;
            document.getElementById('participateDesc').textContent = currentSurvey.description;
            document.getElementById('participateReward').innerHTML = `<strong>ğŸ’° ì°¸ì—¬ ë³´ìƒ: ${currentSurvey.rewardPoints} í¬ì¸íŠ¸</strong><br><small>ì„¤ë¬¸ ì™„ë£Œ ì‹œ ìë™ìœ¼ë¡œ í¬ì¸íŠ¸ê°€ ì§€ê¸‰ë©ë‹ˆë‹¤.</small>`;

            const questionsHtml = currentSurvey.questions.map(q => {
                let inputHtml = '';
                switch(q.type) {
                    case 'radio':
                        inputHtml = `<div class="answer-form">${q.options.map(opt => `<label class="answer-option"><input type="radio" name="q${q.id}" value="${opt}" ${q.required ? 'required' : ''}>${opt}</label>`).join('')}</div>`;
                        break;
                    case 'checkbox':
                        inputHtml = `<div class="answer-form">${q.options.map(opt => `<label class="answer-option"><input type="checkbox" name="q${q.id}" value="${opt}">${opt}</label>`).join('')}</div>`;
                        break;
                    case 'select':
                        inputHtml = `<div class="answer-form"><select name="q${q.id}" class="answer-input" ${q.required ? 'required' : ''}><option value="">ì„ íƒí•˜ì„¸ìš”</option>${q.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}</select></div>`;
                        break;
                    case 'text':
                        inputHtml = `<div class="answer-form"><input type="text" name="q${q.id}" class="answer-input" placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”" ${q.required ? 'required' : ''}></div>`;
                        break;
                    case 'textarea':
                        inputHtml = `<div class="answer-form"><textarea name="q${q.id}" class="answer-input" rows="4" placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”" ${q.required ? 'required' : ''}></textarea></div>`;
                        break;
                }
                return `<div class="question-item"><p><strong>ì§ˆë¬¸ ${q.id}. ${q.question}</strong> ${q.required ? '<span style="color: red;">*</span>' : ''}</p>${inputHtml}</div>`;
            }).join('');

            document.getElementById('participateQuestions').innerHTML = questionsHtml;
        }

        function submitSurveyAnswers() {
            const form = document.getElementById('participateForm');
            if (!form.checkValidity()) {
                alert('í•„ìˆ˜ ì§ˆë¬¸ì— ëª¨ë‘ ì‘ë‹µí•´ì£¼ì„¸ìš”.');
                return;
            }

            const answers = {};
            currentSurvey.questions.forEach(q => {
                if (q.type === 'checkbox') {
                    answers[q.id] = Array.from(document.querySelectorAll(`input[name="q${q.id}"]:checked`)).map(input => input.value);
                } else {
                    const input = document.querySelector(`[name="q${q.id}"]`);
                    if (input.type === 'radio') {
                        const selected = document.querySelector(`input[name="q${q.id}"]:checked`);
                        answers[q.id] = selected ? selected.value : '';
                    } else {
                        answers[q.id] = input.value;
                    }
                }
            });

            const participations = JSON.parse(localStorage.getItem('participations') || '[]');
            participations.push({
                id: Date.now().toString(),
                surveyId: currentSurvey.id,
                userId: currentUser.id,
                answers: answers,
                completedAt: new Date().toISOString()
            });
            localStorage.setItem('participations', JSON.stringify(participations));

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            let referralBonus = '';

            if (userIndex !== -1) {
                // í¬ì¸íŠ¸ ì§€ê¸‰
                users[userIndex].points = (users[userIndex].points || 0) + currentSurvey.rewardPoints;

                // ì™„ë£Œ ì„¤ë¬¸ ìˆ˜ ì¦ê°€
                users[userIndex].completedSurveys = (users[userIndex].completedSurveys || 0) + 1;

                // í‰ì  ì¦ê°€ (ì„¤ë¬¸ ì™„ë£Œí•  ë•Œë§ˆë‹¤ +0.1, ìµœëŒ€ 5.0)
                const currentRating = users[userIndex].rating || 3.0;
                users[userIndex].rating = Math.min(5.0, currentRating + 0.1);

                // ì¶”ì²œ ë³´ìƒ ì²˜ë¦¬ (ì„¤ë¬¸ 3ê°œ ì™„ë£Œ ì‹œ)
                if (users[userIndex].completedSurveys === 3 && users[userIndex].referredBy && !users[userIndex].referralRewardReceived) {
                    const referralReward = 3000; // í”¼ì¶”ì²œì¸ ë³´ìƒ
                    const referrerReward = 5000; // ì¶”ì²œì¸ ë³´ìƒ

                    // í”¼ì¶”ì²œì¸ ë³´ìƒ
                    users[userIndex].points += referralReward;
                    users[userIndex].referralRewardReceived = true;

                    // ì¶”ì²œì¸ ì°¾ê¸° ë° ë³´ìƒ
                    const referrerIndex = users.findIndex(u => u.id === users[userIndex].referredBy);
                    if (referrerIndex !== -1) {
                        users[referrerIndex].points = (users[referrerIndex].points || 0) + referrerReward;
                    }

                    // ì¶”ì²œ ê´€ê³„ ì—…ë°ì´íŠ¸
                    const referrals = JSON.parse(localStorage.getItem('referrals') || '[]');
                    const referralIndex = referrals.findIndex(r => r.refereeId === currentUser.id);
                    if (referralIndex !== -1) {
                        referrals[referralIndex].refereeRewardGiven = true;
                        referrals[referralIndex].referrerRewardGiven = true;
                        referrals[referralIndex].completedAt = new Date().toISOString();
                    }
                    localStorage.setItem('referrals', JSON.stringify(referrals));

                    referralBonus = `\n\nğŸ ì¶”ì²œ ë³´ìƒ ì§€ê¸‰!\nğŸ’° ë‚˜: +${referralReward.toLocaleString()} P\nğŸ’° ì¶”ì²œì¸: +${referrerReward.toLocaleString()} P`;
                }

                localStorage.setItem('users', JSON.stringify(users));
                currentUser.points = users[userIndex].points;
                currentUser.completedSurveys = users[userIndex].completedSurveys;
                currentUser.rating = users[userIndex].rating;
                currentUser.referralRewardReceived = users[userIndex].referralRewardReceived;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }

            const newRating = currentUser.rating.toFixed(1);
            alert(`ğŸ‰ ì„¤ë¬¸ ì°¸ì—¬ ì™„ë£Œ!\nğŸ’° ${currentSurvey.rewardPoints} í¬ì¸íŠ¸ ì§€ê¸‰!\nâ­ í‰ì : ${newRating}/5.0${referralBonus}`);
            showDashboard();
        }

        function viewMySurveyDetail(surveyId) {
            showSurveyAnalytics(surveyId);
        }

        // ì„¤ë¬¸ ê²°ê³¼ ë¶„ì„ í™”ë©´ í‘œì‹œ
        let currentAnalyticsSurvey = null;
        let currentCharts = [];

        function showSurveyAnalytics(surveyId) {
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            const survey = surveys.find(s => s.id === surveyId);
            if (!survey) {
                alert('ì„¤ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const participations = JSON.parse(localStorage.getItem('participations') || '[]');
            const surveyParticipations = participations.filter(p => p.surveyId === surveyId);

            currentAnalyticsSurvey = survey;

            // í™”ë©´ ì „í™˜
            showScreen('analyticsScreen');
            updatePoints();

            // ê¸°ë³¸ ì •ë³´ í‘œì‹œ
            document.getElementById('analyticsTitle').textContent = survey.title;
            document.getElementById('analyticsDesc').textContent = survey.description + (survey.organizer ? ` (ì£¼ê´€: ${survey.organizer})` : '');
            document.getElementById('totalResponses').textContent = surveyParticipations.length;
            document.getElementById('targetResponses').textContent = survey.targetResponses || 100;

            const completionRate = survey.targetResponses > 0
                ? Math.round((surveyParticipations.length / survey.targetResponses) * 100)
                : 0;
            document.getElementById('completionRate').textContent = `${completionRate}%`;
            document.getElementById('qualityScoreDisplay').textContent = survey.qualityScore ? `${survey.qualityScore}ì ` : '-';

            // ì‘ë‹µì´ ì—†ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€
            if (surveyParticipations.length === 0) {
                document.getElementById('analyticsCharts').innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">ì•„ì§ ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            // ê¸°ì¡´ ì°¨íŠ¸ íŒŒê´´
            currentCharts.forEach(chart => chart.destroy());
            currentCharts = [];

            // ì‘ë‹µ ë°ì´í„° ì§‘ê³„ ë° ì°¨íŠ¸ ë Œë”ë§
            const aggregatedData = aggregateResponses(survey, surveyParticipations);
            renderCharts(survey, aggregatedData);
        }

        // ì‘ë‹µ ë°ì´í„° ì§‘ê³„
        function aggregateResponses(survey, participations) {
            const aggregated = {};

            survey.questions.forEach(question => {
                aggregated[question.id] = {
                    question: question.question,
                    type: question.type,
                    responses: []
                };

                participations.forEach(participation => {
                    const answer = participation.answers[question.id];
                    if (answer !== undefined && answer !== null && answer !== '') {
                        aggregated[question.id].responses.push(answer);
                    }
                });

                // ì„ íƒí˜• ì§ˆë¬¸ì€ ì¹´ìš´íŠ¸ ì§‘ê³„
                if (question.type === 'radio' || question.type === 'select') {
                    const counts = {};
                    aggregated[question.id].responses.forEach(answer => {
                        counts[answer] = (counts[answer] || 0) + 1;
                    });
                    aggregated[question.id].counts = counts;
                } else if (question.type === 'checkbox') {
                    const counts = {};
                    aggregated[question.id].responses.forEach(answers => {
                        if (Array.isArray(answers)) {
                            answers.forEach(answer => {
                                counts[answer] = (counts[answer] || 0) + 1;
                            });
                        }
                    });
                    aggregated[question.id].counts = counts;
                }
            });

            return aggregated;
        }

        // ì°¨íŠ¸ ë Œë”ë§
        function renderCharts(survey, aggregatedData) {
            const container = document.getElementById('analyticsCharts');
            container.innerHTML = '';

            survey.questions.forEach((question, index) => {
                const data = aggregatedData[question.id];
                if (!data || data.responses.length === 0) return;

                const chartSection = document.createElement('div');
                chartSection.style.cssText = 'margin-bottom: 40px; padding: 20px; background: white; border-radius: 12px; border: 1px solid #e0e0e0;';

                const title = document.createElement('h3');
                title.textContent = `ì§ˆë¬¸ ${question.id}. ${question.question}`;
                title.style.cssText = 'margin-bottom: 20px; color: #333; font-size: 16px;';
                chartSection.appendChild(title);

                // ì„ íƒí˜• ì§ˆë¬¸ - ì°¨íŠ¸ í‘œì‹œ
                if (question.type === 'radio' || question.type === 'select' || question.type === 'checkbox') {
                    const canvasContainer = document.createElement('div');
                    canvasContainer.style.cssText = 'max-width: 600px; margin: 0 auto;';

                    const canvas = document.createElement('canvas');
                    canvas.id = `chart${question.id}`;
                    canvasContainer.appendChild(canvas);
                    chartSection.appendChild(canvasContainer);

                    const labels = Object.keys(data.counts);
                    const values = Object.values(data.counts);
                    const total = values.reduce((a, b) => a + b, 0);

                    const ctx = canvas.getContext('2d');
                    const chart = new Chart(ctx, {
                        type: question.type === 'checkbox' ? 'bar' : 'pie',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'ì‘ë‹µ ìˆ˜',
                                data: values,
                                backgroundColor: [
                                    '#5B7C99', '#7B9FB8', '#9BBBD4', '#BCD7EE',
                                    '#FFD700', '#FFA500', '#FF6B6B', '#4ECDC4'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.parsed || context.parsed.y || 0;
                                            const percentage = ((value / total) * 100).toFixed(1);
                                            return `${label}: ${value}ëª… (${percentage}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    currentCharts.push(chart);

                    // í†µê³„ í‘œì‹œ
                    const stats = document.createElement('div');
                    stats.style.cssText = 'margin-top: 15px; font-size: 13px; color: #666;';
                    stats.innerHTML = `<strong>ì´ ì‘ë‹µ:</strong> ${total}ëª…`;
                    chartSection.appendChild(stats);

                } else {
                    // ì£¼ê´€ì‹ ì§ˆë¬¸ - ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
                    const responseList = document.createElement('div');
                    responseList.style.cssText = 'max-height: 300px; overflow-y: auto;';

                    data.responses.slice(0, 20).forEach((response, idx) => {
                        const item = document.createElement('div');
                        item.style.cssText = 'padding: 10px; margin-bottom: 8px; background: #f8f9fa; border-radius: 5px; font-size: 14px; color: #333;';
                        item.textContent = `${idx + 1}. ${response}`;
                        responseList.appendChild(item);
                    });

                    chartSection.appendChild(responseList);

                    if (data.responses.length > 20) {
                        const more = document.createElement('p');
                        more.style.cssText = 'margin-top: 10px; font-size: 13px; color: #999; text-align: center;';
                        more.textContent = `... ì™¸ ${data.responses.length - 20}ê°œ ì‘ë‹µ (CSV ë‹¤ìš´ë¡œë“œë¡œ ì „ì²´ í™•ì¸ ê°€ëŠ¥)`;
                        chartSection.appendChild(more);
                    }

                    const stats = document.createElement('div');
                    stats.style.cssText = 'margin-top: 15px; font-size: 13px; color: #666;';
                    stats.innerHTML = `<strong>ì´ ì‘ë‹µ:</strong> ${data.responses.length}ëª…`;
                    chartSection.appendChild(stats);
                }

                container.appendChild(chartSection);
            });
        }

        // CSV ë‹¤ìš´ë¡œë“œ
        function downloadResults() {
            if (!currentAnalyticsSurvey) {
                alert('ì„¤ë¬¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const participations = JSON.parse(localStorage.getItem('participations') || '[]');
            const surveyParticipations = participations.filter(p => p.surveyId === currentAnalyticsSurvey.id);

            if (surveyParticipations.length === 0) {
                alert('ë‹¤ìš´ë¡œë“œí•  ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // CSV í—¤ë” ìƒì„±
            let csv = '\uFEFF'; // UTF-8 BOM
            csv += 'ì‘ë‹µ ë²ˆí˜¸,ì°¸ì—¬ ì¼ì‹œ,';
            currentAnalyticsSurvey.questions.forEach(q => {
                csv += `"${q.question}",`;
            });
            csv += '\n';

            // CSV ë°ì´í„° ìƒì„±
            surveyParticipations.forEach((participation, index) => {
                csv += `${index + 1},`;
                csv += `"${new Date(participation.completedAt).toLocaleString('ko-KR')}",`;
                currentAnalyticsSurvey.questions.forEach(q => {
                    const answer = participation.answers[q.id];
                    if (Array.isArray(answer)) {
                        csv += `"${answer.join(', ')}",`;
                    } else {
                        csv += `"${answer || ''}",`;
                    }
                });
                csv += '\n';
            });

            // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `${currentAnalyticsSurvey.title}_ê²°ê³¼_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            alert('âœ… CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ìƒí’ˆ êµí™˜ì†Œ ê´€ë ¨ í•¨ìˆ˜
        function showGiftShop() {
            showScreen('giftShopScreen');
            updatePoints();
            loadProducts();
            switchTab('products');
        }

        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => tab.classList.remove('active'));

            if (tabName === 'products') {
                tabs[0].classList.add('active');
                document.getElementById('productsTab').classList.remove('hidden');
                document.getElementById('historyTab').classList.add('hidden');
                loadProducts();
            } else {
                tabs[1].classList.add('active');
                document.getElementById('productsTab').classList.add('hidden');
                document.getElementById('historyTab').classList.remove('hidden');
                loadExchangeHistory();
            }
        }

        function loadProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = giftProducts.map(product => `
                <div class="product-item" onclick="confirmExchange('${product.id}')">
                    <div class="product-icon">${product.icon}</div>
                    <div class="product-name">${product.name} ${product.popular ? '<span class="badge badge-popular">ì¸ê¸°</span>' : ''}</div>
                    <div class="product-price">${product.price.toLocaleString()} P</div>
                    <div class="product-desc">${product.description}</div>
                    <div class="product-stock ${product.stock ? '' : 'out-of-stock'}">${product.stock ? 'âœ… êµí™˜ ê°€ëŠ¥' : 'âŒ í’ˆì ˆ'}</div>
                    <button class="btn btn-success btn-small" onclick="event.stopPropagation(); confirmExchange('${product.id}')" ${!product.stock ? 'disabled' : ''}>êµí™˜í•˜ê¸°</button>
                </div>
            `).join('');
        }

        function confirmExchange(productId) {
            const product = giftProducts.find(p => p.id === productId);
            if (!product || !product.stock) {
                alert('âŒ í˜„ì¬ í’ˆì ˆëœ ìƒí’ˆì…ë‹ˆë‹¤.');
                return;
            }

            if (currentUser.points < product.price) {
                alert(`âŒ í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.\n\ní•„ìš” í¬ì¸íŠ¸: ${product.price.toLocaleString()} P\në³´ìœ  í¬ì¸íŠ¸: ${currentUser.points.toLocaleString()} P\në¶€ì¡± í¬ì¸íŠ¸: ${(product.price - currentUser.points).toLocaleString()} P`);
                return;
            }

            if (confirm(`${product.icon} ${product.name}\nê°€ê²©: ${product.price.toLocaleString()} P\n\ní¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ êµí™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€» êµí™˜ í›„ ë‚¨ì€ í¬ì¸íŠ¸: ${(currentUser.points - product.price).toLocaleString()} P`)) {
                exchangeProduct(product);
            }
        }

        function exchangeProduct(product) {
            // í¬ì¸íŠ¸ ì°¨ê°
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].points = currentUser.points - product.price;
                localStorage.setItem('users', JSON.stringify(users));
                currentUser.points = users[userIndex].points;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }

            // êµí™˜ ë‚´ì—­ ì €ì¥
            const exchanges = JSON.parse(localStorage.getItem('exchanges') || '[]');
            exchanges.push({
                id: Date.now().toString(),
                userId: currentUser.id,
                productId: product.id,
                productName: product.name,
                productIcon: product.icon,
                price: product.price,
                exchangedAt: new Date().toISOString(),
                status: 'completed'
            });
            localStorage.setItem('exchanges', JSON.stringify(exchanges));

            updatePoints();
            alert(`ğŸ‰ êµí™˜ ì™„ë£Œ!\n\n${product.icon} ${product.name}\n\nâ€» êµí™˜ê¶Œì€ ë“±ë¡í•˜ì‹  ì´ë©”ì¼ë¡œ ë°œì†¡ë©ë‹ˆë‹¤.\nâ€» ë‚¨ì€ í¬ì¸íŠ¸: ${currentUser.points.toLocaleString()} P`);
            loadProducts();
        }

        function loadExchangeHistory() {
            const exchanges = JSON.parse(localStorage.getItem('exchanges') || '[]');
            const myExchanges = exchanges.filter(e => e.userId === currentUser.id).reverse();
            const list = document.getElementById('exchangeHistoryList');

            if (myExchanges.length === 0) {
                list.innerHTML = '<p style="color: #999; margin-top: 15px; text-align: center;">ì•„ì§ êµí™˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = myExchanges.map(exchange => `
                <div class="exchange-history-item">
                    <div class="exchange-date">${new Date(exchange.exchangedAt).toLocaleString('ko-KR')}</div>
                    <div class="exchange-product">${exchange.productIcon} ${exchange.productName}</div>
                    <div class="exchange-points">-${exchange.price.toLocaleString()} P</div>
                </div>
            `).join('');
        }

        function showMySurveys() { showDashboard(); }
        function showAvailableSurveys() {
            showScreen('availableSurveysScreen');
            document.getElementById('userNameHeader2').textContent = currentUser.name;
            document.getElementById('userPoints2').textContent = `ğŸ’° ${currentUser.points.toLocaleString()} P`;
            document.getElementById('userRatingBadge2').textContent = `â­ ${(currentUser.rating || 3.0).toFixed(1)}`;
            loadAllAvailableSurveys();
        }

        function loadAllAvailableSurveys() {
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');
            const participations = JSON.parse(localStorage.getItem('participations') || '[]');
            const myParticipations = participations.filter(p => p.userId === currentUser.id);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const available = surveys.filter(s => {
                if (s.creatorId === currentUser.id) return false;
                if (myParticipations.find(p => p.surveyId === s.id)) return false;
                if (!matchesSurveyTarget(s, currentUser)) return false;

                // ê¸°ê°„ ì²´í¬
                if (s.startDate) {
                    const startDate = new Date(s.startDate);
                    startDate.setHours(0, 0, 0, 0);
                    if (today < startDate) return false;
                }
                if (s.endDate) {
                    const endDate = new Date(s.endDate);
                    endDate.setHours(23, 59, 59, 999);
                    if (today > endDate) return false;
                }

                return true;
            });

            const list = document.getElementById('allAvailableSurveysList');
            if (available.length === 0) {
                list.innerHTML = '<p style="color: #999; margin-top: 15px; grid-column: 1/-1;">í˜„ì¬ ì°¸ì—¬ ê°€ëŠ¥í•œ ì„¤ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            list.innerHTML = available.map(survey => {
                let periodText = '';
                if (survey.startDate || survey.endDate) {
                    const start = survey.startDate ? new Date(survey.startDate).toLocaleDateString('ko-KR', {month: 'short', day: 'numeric'}) : 'ì¦‰ì‹œ';
                    const end = survey.endDate ? new Date(survey.endDate).toLocaleDateString('ko-KR', {month: 'short', day: 'numeric'}) : 'ëª©í‘œ ë‹¬ì„± ì‹œ';
                    periodText = `<div class="survey-info" style="color: #5B7C99;">ğŸ“… ê¸°ê°„: ${start} ~ ${end}</div>`;
                }
                return `
                    <div class="survey-item" onclick="startSurveyParticipation('${survey.id}')">
                        <div class="survey-title">${survey.title} <span class="badge">ì°¸ì—¬ ê°€ëŠ¥</span></div>
                        <div class="survey-desc">${survey.description}</div>
                        ${survey.organizer ? `<div class="survey-info" style="color: #5B7C99; font-weight: 500;">ğŸ¢ ${survey.organizer}</div>` : ''}
                        ${periodText}
                        <div class="survey-info">ğŸ¯ ëŒ€ìƒ: ${formatTargetInfo(survey)}</div>
                        <div class="survey-info">ğŸ ë³´ìƒ: ${survey.rewardPoints}P <span class="badge badge-points">+${survey.rewardPoints}P</span></div>
                    </div>
                `;
            }).join('');
        }

        function loadFeaturedBanner() {
            const surveys = JSON.parse(localStorage.getItem('surveys') || '[]');

            // í™ë³´ ì„¤ë¬¸ ì°¾ê¸° (featured í”Œë˜ê·¸ê°€ ìˆëŠ” ê²ƒ ë˜ëŠ” ë³´ìƒì´ ê°€ì¥ ë†’ì€ ê²ƒ)
            const featuredSurvey = surveys.find(s => s.featured) ||
                                  surveys.filter(s => s.creatorId !== currentUser.id && s.rewardPoints > 0)
                                         .sort((a, b) => b.rewardPoints - a.rewardPoints)[0];

            const banner = document.getElementById('featuredBanner');
            if (!featuredSurvey) {
                banner.style.display = 'none';
                return;
            }

            banner.style.display = 'block';
            banner.innerHTML = `
                <div class="featured-tag">ğŸ”¥ í”„ë¦¬ë¯¸ì—„ ì„¤ë¬¸</div>
                <div class="featured-title">${featuredSurvey.title}</div>
                <div class="featured-desc">${featuredSurvey.description}</div>
                <div class="featured-info">ğŸ’° ${featuredSurvey.rewardPoints}P ë³´ìƒ | ğŸ¯ ${formatTargetInfo(featuredSurvey)}</div>
            `;
            banner.onclick = () => startSurveyParticipation(featuredSurvey.id);
        }

        // ==================== ê´€ë¦¬ì ëª¨ë“œ ====================

        function showAdminSettings() {
            showScreen('adminSettingsScreen');
            loadAdminSettings();
        }

        function switchAdminTab(tab) {
            // íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('#adminSettingsScreen .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // íƒ­ ì»¨í…ì¸  ì „í™˜
            document.getElementById('statsSettingsTab').classList.add('hidden');
            document.getElementById('createdSettingsTab').classList.add('hidden');
            document.getElementById('availableSettingsTab').classList.add('hidden');

            if (tab === 'stats') {
                document.getElementById('statsSettingsTab').classList.remove('hidden');
            } else if (tab === 'created') {
                document.getElementById('createdSettingsTab').classList.remove('hidden');
            } else if (tab === 'available') {
                document.getElementById('availableSettingsTab').classList.remove('hidden');
            }
        }

        function loadAdminSettings() {
            const settings = JSON.parse(localStorage.getItem('adminThemeSettings') || '{}');

            // í†µê³„ ì¹´ë“œ ì„¤ì • ë¡œë“œ
            document.getElementById('statsBackgroundImage').value = settings.statsBackgroundImage || '';
            document.getElementById('statsBackgroundColor').value = settings.statsBackgroundColor || '#ffffff';
            document.getElementById('statsTextColor').value = settings.statsTextColor || '#333333';
            document.getElementById('statsOpacity').value = settings.statsOpacity || 100;

            // ë‚´ê°€ ë§Œë“  ì„¤ë¬¸ ì„¤ì • ë¡œë“œ
            document.getElementById('createdBackgroundImage').value = settings.createdBackgroundImage || '';
            document.getElementById('createdBackgroundColor').value = settings.createdBackgroundColor || '#ffffff';
            document.getElementById('createdTextColor').value = settings.createdTextColor || '#333333';
            document.getElementById('createdOpacity').value = settings.createdOpacity || 100;

            // ì°¸ì—¬ ê°€ëŠ¥ ì„¤ë¬¸ ì„¤ì • ë¡œë“œ
            document.getElementById('availableBackgroundImage').value = settings.availableBackgroundImage || '';
            document.getElementById('availableBackgroundColor').value = settings.availableBackgroundColor || '#ffffff';
            document.getElementById('availableTextColor').value = settings.availableTextColor || '#333333';
            document.getElementById('availableOpacity').value = settings.availableOpacity || 100;

            // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            updateAdminPreview();
        }

        function updateAdminPreview() {
            const statsImg = document.getElementById('statsBackgroundImage').value;
            const statsBg = document.getElementById('statsBackgroundColor').value;
            const statsText = document.getElementById('statsTextColor').value;
            const statsOpacity = document.getElementById('statsOpacity').value / 100;

            const createdImg = document.getElementById('createdBackgroundImage').value;
            const createdBg = document.getElementById('createdBackgroundColor').value;
            const createdText = document.getElementById('createdTextColor').value;
            const createdOpacity = document.getElementById('createdOpacity').value / 100;

            const availableImg = document.getElementById('availableBackgroundImage').value;
            const availableBg = document.getElementById('availableBackgroundColor').value;
            const availableText = document.getElementById('availableTextColor').value;
            const availableOpacity = document.getElementById('availableOpacity').value / 100;

            // ë¯¸ë¦¬ë³´ê¸° ì ìš©
            const statCards = document.querySelectorAll('#previewStats .stat-card');

            if (statCards[0]) {
                const bg0 = statCards[0].querySelector('div');
                if (statsImg) {
                    bg0.style.backgroundImage = `url(${statsImg})`;
                    bg0.style.opacity = statsOpacity;
                } else {
                    bg0.style.backgroundImage = 'none';
                }
                bg0.style.backgroundColor = statsBg;
                statCards[0].querySelectorAll('.stat-number, .stat-label').forEach(el => el.style.color = statsText);
            }

            if (statCards[1]) {
                const bg1 = statCards[1].querySelector('div');
                if (createdImg) {
                    bg1.style.backgroundImage = `url(${createdImg})`;
                    bg1.style.opacity = createdOpacity;
                } else {
                    bg1.style.backgroundImage = 'none';
                }
                bg1.style.backgroundColor = createdBg;
                statCards[1].querySelectorAll('.stat-number, .stat-label').forEach(el => el.style.color = createdText);
            }

            if (statCards[2]) {
                const bg2 = statCards[2].querySelector('div');
                if (availableImg) {
                    bg2.style.backgroundImage = `url(${availableImg})`;
                    bg2.style.opacity = availableOpacity;
                } else {
                    bg2.style.backgroundImage = 'none';
                }
                bg2.style.backgroundColor = availableBg;
                statCards[2].querySelectorAll('.stat-number, .stat-label').forEach(el => el.style.color = availableText);
            }
        }

        function applyAdminSettings() {
            const settings = {
                statsBackgroundImage: document.getElementById('statsBackgroundImage').value,
                statsBackgroundColor: document.getElementById('statsBackgroundColor').value,
                statsTextColor: document.getElementById('statsTextColor').value,
                statsOpacity: document.getElementById('statsOpacity').value,

                createdBackgroundImage: document.getElementById('createdBackgroundImage').value,
                createdBackgroundColor: document.getElementById('createdBackgroundColor').value,
                createdTextColor: document.getElementById('createdTextColor').value,
                createdOpacity: document.getElementById('createdOpacity').value,

                availableBackgroundImage: document.getElementById('availableBackgroundImage').value,
                availableBackgroundColor: document.getElementById('availableBackgroundColor').value,
                availableTextColor: document.getElementById('availableTextColor').value,
                availableOpacity: document.getElementById('availableOpacity').value
            };

            localStorage.setItem('adminThemeSettings', JSON.stringify(settings));
            alert('âœ… í…Œë§ˆ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ì„œ í™•ì¸í•´ë³´ì„¸ìš”.');
            showDashboard();
        }

        function resetAdminSettings() {
            if (confirm('ëª¨ë“  í…Œë§ˆ ì„¤ì •ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('adminThemeSettings');
                loadAdminSettings();
                alert('âœ… í…Œë§ˆ ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                showDashboard();
            }
        }

        function applyThemeSettings() {
            const settings = JSON.parse(localStorage.getItem('adminThemeSettings') || '{}');
            const statCards = document.querySelectorAll('#dashboardScreen .dashboard-stats .stat-card');

            if (!statCards.length) return;

            // ì²« ë²ˆì§¸ ì¹´ë“œ (ë‚´ê°€ ë§Œë“  ì„¤ë¬¸)
            if (statCards[0] && settings.statsBackgroundImage) {
                const wrapper = document.createElement('div');
                wrapper.style.cssText = 'position: absolute; inset: 0; background-size: cover; background-position: center; z-index: 0;';
                wrapper.style.backgroundImage = `url(${settings.statsBackgroundImage})`;
                wrapper.style.backgroundColor = settings.statsBackgroundColor || '#ffffff';
                wrapper.style.opacity = (settings.statsOpacity || 100) / 100;
                statCards[0].style.position = 'relative';
                statCards[0].insertBefore(wrapper, statCards[0].firstChild);
                Array.from(statCards[0].children).forEach((child, idx) => {
                    if (idx > 0) child.style.position = 'relative';
                    child.style.zIndex = '1';
                });
                if (settings.statsTextColor) {
                    statCards[0].querySelectorAll('.stat-number, .stat-label').forEach(el => el.style.color = settings.statsTextColor);
                }
            } else if (statCards[0] && settings.statsBackgroundColor) {
                statCards[0].style.backgroundColor = settings.statsBackgroundColor;
                if (settings.statsTextColor) {
                    statCards[0].querySelectorAll('.stat-number, .stat-label').forEach(el => el.style.color = settings.statsTextColor);
                }
            }

            // ë‘ ë²ˆì§¸ ì¹´ë“œ (ì°¸ì—¬ ê°€ëŠ¥ ì„¤ë¬¸)
            if (statCards[1] && settings.createdBackgroundImage) {
                const wrapper = document.createElement('div');
                wrapper.style.cssText = 'position: absolute; inset: 0; background-size: cover; background-position: center; z-index: 0;';
                wrapper.style.backgroundImage = `url(${settings.createdBackgroundImage})`;
                wrapper.style.backgroundColor = settings.createdBackgroundColor || '#ffffff';
                wrapper.style.opacity = (settings.createdOpacity || 100) / 100;
                statCards[1].style.position = 'relative';
                statCards[1].insertBefore(wrapper, statCards[1].firstChild);
                Array.from(statCards[1].children).forEach((child, idx) => {
                    if (idx > 0) child.style.position = 'relative';
                    child.style.zIndex = '1';
                });
                if (settings.createdTextColor) {
                    statCards[1].querySelectorAll('.stat-number, .stat-label').forEach(el => el.style.color = settings.createdTextColor);
                }
            } else if (statCards[1] && settings.createdBackgroundColor) {
                statCards[1].style.backgroundColor = settings.createdBackgroundColor;
                if (settings.createdTextColor) {
                    statCards[1].querySelectorAll('.stat-number, .stat-label').forEach(el => el.style.color = settings.createdTextColor);
                }
            }

            // ì„¸ ë²ˆì§¸ ì¹´ë“œ (ì™„ë£Œ ì„¤ë¬¸)
            if (statCards[2] && settings.availableBackgroundImage) {
                const wrapper = document.createElement('div');
                wrapper.style.cssText = 'position: absolute; inset: 0; background-size: cover; background-position: center; z-index: 0;';
                wrapper.style.backgroundImage = `url(${settings.availableBackgroundImage})`;
                wrapper.style.backgroundColor = settings.availableBackgroundColor || '#ffffff';
                wrapper.style.opacity = (settings.availableOpacity || 100) / 100;
                statCards[2].style.position = 'relative';
                statCards[2].insertBefore(wrapper, statCards[2].firstChild);
                Array.from(statCards[2].children).forEach((child, idx) => {
                    if (idx > 0) child.style.position = 'relative';
                    child.style.zIndex = '1';
                });
                if (settings.availableTextColor) {
                    statCards[2].querySelectorAll('.stat-number, .stat-label').forEach(el => el.style.color = settings.availableTextColor);
                }
            } else if (statCards[2] && settings.availableBackgroundColor) {
                statCards[2].style.backgroundColor = settings.availableBackgroundColor;
                if (settings.availableTextColor) {
                    statCards[2].querySelectorAll('.stat-number, .stat-label').forEach(el => el.style.color = settings.availableTextColor);
                }
            }
        }

        // ê´€ë¦¬ì ì„¤ì • ì…ë ¥ í•„ë“œì— ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° ì—°ë™
        document.addEventListener('DOMContentLoaded', function() {
            const adminInputs = [
                'statsBackgroundImage', 'statsBackgroundColor', 'statsTextColor', 'statsOpacity',
                'createdBackgroundImage', 'createdBackgroundColor', 'createdTextColor', 'createdOpacity',
                'availableBackgroundImage', 'availableBackgroundColor', 'availableTextColor', 'availableOpacity'
            ];

            adminInputs.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('input', updateAdminPreview);
                    el.addEventListener('change', updateAdminPreview);
                }
            });
        });

        // ==================== í…œí”Œë¦¿ ë§ˆì¼“í”Œë ˆì´ìŠ¤ ====================

        // í…œí”Œë¦¿ ë°ì´í„°
        const surveyTemplates = [
            {
                id: 'T001',
                title: 'ê³ ê° ë§Œì¡±ë„ ì¡°ì‚¬',
                category: 'business',
                description: 'ì œí’ˆ/ì„œë¹„ìŠ¤ì— ëŒ€í•œ ê³ ê° ë§Œì¡±ë„ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ì¸¡ì •í•˜ëŠ” í‘œì¤€ í…œí”Œë¦¿',
                price: 5000,
                seller: 'ì„¤ë¬¸ì—°êµ¬ì†Œ',
                sales: 127,
                rating: 4.8,
                questions: [
                    { id: 1, type: 'radio', question: 'ì „ë°˜ì ì¸ ë§Œì¡±ë„ë¥¼ í‰ê°€í•´ì£¼ì„¸ìš”', options: ['ë§¤ìš° ë¶ˆë§Œì¡±', 'ë¶ˆë§Œì¡±', 'ë³´í†µ', 'ë§Œì¡±', 'ë§¤ìš° ë§Œì¡±'] },
                    { id: 2, type: 'radio', question: 'ì œí’ˆ/ì„œë¹„ìŠ¤ í’ˆì§ˆì€ ì–´ë– ì…¨ë‚˜ìš”?', options: ['ë§¤ìš° ë‚˜ì¨', 'ë‚˜ì¨', 'ë³´í†µ', 'ì¢‹ìŒ', 'ë§¤ìš° ì¢‹ìŒ'] },
                    { id: 3, type: 'radio', question: 'ê°€ê²© ëŒ€ë¹„ ë§Œì¡±ë„ëŠ”?', options: ['ë§¤ìš° ë¶ˆë§Œì¡±', 'ë¶ˆë§Œì¡±', 'ë³´í†µ', 'ë§Œì¡±', 'ë§¤ìš° ë§Œì¡±'] },
                    { id: 4, type: 'checkbox', question: 'ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”', options: ['ê°€ê²©', 'í’ˆì§ˆ', 'ê³ ê°ì„œë¹„ìŠ¤', 'ë°°ì†¡', 'ê¸°íƒ€'] },
                    { id: 5, type: 'textarea', question: 'ì¶”ê°€ë¡œ ê°œì„ í–ˆìœ¼ë©´ í•˜ëŠ” ì ì´ ìˆë‚˜ìš”?' }
                ]
            },
            {
                id: 'T002',
                title: 'ì§ì› ë§Œì¡±ë„ ì„¤ë¬¸',
                category: 'hr',
                description: 'ì¡°ì§ ë‚´ ì§ì› ë§Œì¡±ë„ì™€ ê·¼ë¬´í™˜ê²½ì„ í‰ê°€í•˜ëŠ” HR ì „ë¬¸ í…œí”Œë¦¿',
                price: 8000,
                seller: 'HRì†”ë£¨ì…˜',
                sales: 89,
                rating: 4.9,
                questions: [
                    { id: 1, type: 'radio', question: 'í˜„ì¬ ê·¼ë¬´í™˜ê²½ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”?', options: ['ë§¤ìš° ë¶ˆë§Œì¡±', 'ë¶ˆë§Œì¡±', 'ë³´í†µ', 'ë§Œì¡±', 'ë§¤ìš° ë§Œì¡±'] },
                    { id: 2, type: 'radio', question: 'ì—…ë¬´ëŸ‰ì€ ì ì ˆí•œê°€ìš”?', options: ['ë„ˆë¬´ ë§ìŒ', 'ì•½ê°„ ë§ìŒ', 'ì ì ˆí•¨', 'ì•½ê°„ ì ìŒ', 'ë„ˆë¬´ ì ìŒ'] },
                    { id: 3, type: 'radio', question: 'ê¸‰ì—¬ ë° ë³µì§€ì— ë§Œì¡±í•˜ì‹œë‚˜ìš”?', options: ['ë§¤ìš° ë¶ˆë§Œì¡±', 'ë¶ˆë§Œì¡±', 'ë³´í†µ', 'ë§Œì¡±', 'ë§¤ìš° ë§Œì¡±'] },
                    { id: 4, type: 'checkbox', question: 'ê°œì„ ì´ í•„ìš”í•œ ë³µì§€ì œë„ëŠ”?', options: ['ê±´ê°•ë³´í—˜', 'íœ´ê°€ì œë„', 'êµìœ¡ì§€ì›', 'ì‹ì‚¬ì œê³µ', 'ì¬íƒê·¼ë¬´', 'ê¸°íƒ€'] },
                    { id: 5, type: 'textarea', question: 'íšŒì‚¬ì— ë°”ë¼ëŠ” ì ì´ ìˆë‹¤ë©´?' }
                ]
            },
            {
                id: 'T003',
                title: 'í•™ìˆ  ì—°êµ¬ ì„¤ë¬¸',
                category: 'academic',
                description: 'í•™ìœ„ë…¼ë¬¸ ë° í•™ìˆ ì—°êµ¬ë¥¼ ìœ„í•œ í‘œì¤€í™”ëœ ì—°êµ¬ ì„¤ë¬¸ í…œí”Œë¦¿',
                price: 7000,
                seller: 'ëŒ€í•™ì—°êµ¬ì†Œ',
                sales: 156,
                rating: 4.7,
                questions: [
                    { id: 1, type: 'radio', question: 'ê·€í•˜ì˜ ì—°ë ¹ëŒ€ëŠ”?', options: ['20ëŒ€ ë¯¸ë§Œ', '20ëŒ€', '30ëŒ€', '40ëŒ€', '50ëŒ€', '60ëŒ€ ì´ìƒ'] },
                    { id: 2, type: 'radio', question: 'ìµœì¢… í•™ë ¥ì€?', options: ['ê³ ì¡¸ ì´í•˜', 'ëŒ€í•™ ì¬í•™', 'ëŒ€ì¡¸', 'ì„ì‚¬', 'ë°•ì‚¬'] },
                    { id: 3, type: 'checkbox', question: 'ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë§¤ì²´ëŠ”? (ë³µìˆ˜ì„ íƒ)', options: ['TV', 'ë¼ë””ì˜¤', 'ì‹ ë¬¸', 'ì¸í„°ë„·', 'SNS', 'ìœ íŠœë¸Œ'] },
                    { id: 4, type: 'radio', question: 'í•˜ë£¨ í‰ê·  ë¯¸ë””ì–´ ì´ìš© ì‹œê°„ì€?', options: ['1ì‹œê°„ ë¯¸ë§Œ', '1-2ì‹œê°„', '2-4ì‹œê°„', '4-6ì‹œê°„', '6ì‹œê°„ ì´ìƒ'] },
                    { id: 5, type: 'textarea', question: 'ì—°êµ¬ ì£¼ì œì— ëŒ€í•œ ì˜ê²¬ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”' }
                ]
            },
            {
                id: 'T004',
                title: 'ì œí’ˆ ì¶œì‹œ ì „ ì‹œì¥ì¡°ì‚¬',
                category: 'marketing',
                description: 'ì‹ ì œí’ˆ ì¶œì‹œ ì „ ì‹œì¥ ë°˜ì‘ê³¼ ìˆ˜ìš”ë¥¼ íŒŒì•…í•˜ëŠ” ë§ˆì¼€íŒ… í…œí”Œë¦¿',
                price: 9000,
                seller: 'ë§ˆì¼€íŒ…í”„ë¡œ',
                sales: 94,
                rating: 4.6,
                questions: [
                    { id: 1, type: 'radio', question: 'ì´ ì œí’ˆì— ëŒ€í•œ ê´€ì‹¬ë„ëŠ”?', options: ['ì „í˜€ ê´€ì‹¬ì—†ìŒ', 'ê´€ì‹¬ì—†ìŒ', 'ë³´í†µ', 'ê´€ì‹¬ìˆìŒ', 'ë§¤ìš° ê´€ì‹¬ìˆìŒ'] },
                    { id: 2, type: 'radio', question: 'êµ¬ë§¤ ì˜í–¥ì´ ìˆìœ¼ì‹ ê°€ìš”?', options: ['ì ˆëŒ€ êµ¬ë§¤ì•ˆí•¨', 'êµ¬ë§¤ì•ˆí•¨', 'ê³ ë ¤ì¤‘', 'êµ¬ë§¤í•  ê²ƒì„', 'ê¼­ êµ¬ë§¤í•  ê²ƒì„'] },
                    { id: 3, type: 'text', question: 'ì ì • ê°€ê²©ì€ ì–¼ë§ˆë¼ê³  ìƒê°í•˜ì‹œë‚˜ìš”? (ì› ë‹¨ìœ„)' },
                    { id: 4, type: 'checkbox', question: 'ì–´ë–¤ ì±„ë„ì—ì„œ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', options: ['ì˜¨ë¼ì¸ì‡¼í•‘ëª°', 'ì˜¤í”„ë¼ì¸ ë§¤ì¥', 'ë°±í™”ì ', 'í™ˆì‡¼í•‘', 'ì†Œì…œì»¤ë¨¸ìŠ¤'] },
                    { id: 5, type: 'textarea', question: 'ì œí’ˆì— ëŒ€í•œ ê°œì„  ì œì•ˆì‚¬í•­ì´ ìˆìœ¼ì‹ ê°€ìš”?' }
                ]
            },
            {
                id: 'T005',
                title: 'ì´ë²¤íŠ¸ ì°¸ê°€ì í”¼ë“œë°±',
                category: 'event',
                description: 'í–‰ì‚¬/ì´ë²¤íŠ¸ í›„ ì°¸ê°€ì í”¼ë“œë°± ìˆ˜ì§‘ì„ ìœ„í•œ í…œí”Œë¦¿',
                price: 4000,
                seller: 'ì´ë²¤íŠ¸í”Œë˜ë„ˆ',
                sales: 203,
                rating: 4.5,
                questions: [
                    { id: 1, type: 'radio', question: 'ì´ë²¤íŠ¸ ì „ë°˜ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”?', options: ['ë§¤ìš° ë¶ˆë§Œì¡±', 'ë¶ˆë§Œì¡±', 'ë³´í†µ', 'ë§Œì¡±', 'ë§¤ìš° ë§Œì¡±'] },
                    { id: 2, type: 'radio', question: 'í–‰ì‚¬ ì§„í–‰ì€ ì›í™œí–ˆë‚˜ìš”?', options: ['ë§¤ìš° ë‚˜ì¨', 'ë‚˜ì¨', 'ë³´í†µ', 'ì¢‹ìŒ', 'ë§¤ìš° ì¢‹ìŒ'] },
                    { id: 3, type: 'checkbox', question: 'ê°€ì¥ ì¢‹ì•˜ë˜ ë¶€ë¶„ì€?', options: ['í”„ë¡œê·¸ë¨ êµ¬ì„±', 'ì§„í–‰ ë°©ì‹', 'ì¥ì†Œ', 'ìŒì‹', 'ë„¤íŠ¸ì›Œí‚¹', 'ê¸°íƒ€'] },
                    { id: 4, type: 'radio', question: 'ë‹¤ìŒ í–‰ì‚¬ì—ë„ ì°¸ì—¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', options: ['ì ˆëŒ€ ì•ˆí•¨', 'ì•ˆí•¨', 'ê³ ë ¤ì¤‘', 'ì°¸ì—¬í•  ê²ƒ', 'ê¼­ ì°¸ì—¬í•  ê²ƒ'] },
                    { id: 5, type: 'textarea', question: 'ê°œì„ ì‚¬í•­ì´ë‚˜ ê±´ì˜ì‚¬í•­ì´ ìˆë‹¤ë©´?' }
                ]
            },
            {
                id: 'T006',
                title: 'ì„œë¹„ìŠ¤ í”¼ë“œë°± ìˆ˜ì§‘',
                category: 'feedback',
                description: 'ì¼ë°˜ì ì¸ ì„œë¹„ìŠ¤ í”¼ë“œë°±ì„ ì²´ê³„ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ëŠ” ë²”ìš© í…œí”Œë¦¿',
                price: 3000,
                seller: 'CXì»¨ì„¤íŒ…',
                sales: 312,
                rating: 4.4,
                questions: [
                    { id: 1, type: 'radio', question: 'ì„œë¹„ìŠ¤ ì´ìš©ì€ í¸ë¦¬í•˜ì…¨ë‚˜ìš”?', options: ['ë§¤ìš° ë¶ˆí¸', 'ë¶ˆí¸', 'ë³´í†µ', 'í¸ë¦¬', 'ë§¤ìš° í¸ë¦¬'] },
                    { id: 2, type: 'radio', question: 'ì§ì› ì‘ëŒ€ëŠ” ë§Œì¡±ìŠ¤ëŸ¬ìš°ì…¨ë‚˜ìš”?', options: ['ë§¤ìš° ë¶ˆë§Œì¡±', 'ë¶ˆë§Œì¡±', 'ë³´í†µ', 'ë§Œì¡±', 'ë§¤ìš° ë§Œì¡±'] },
                    { id: 3, type: 'checkbox', question: 'ì¶”ê°€ë¡œ ì›í•˜ëŠ” ì„œë¹„ìŠ¤ëŠ”?', options: ['ë°°ì†¡ ì„œë¹„ìŠ¤', 'ì„¤ì¹˜ ì„œë¹„ìŠ¤', 'A/S', 'ë§ì¶¤ ìƒë‹´', 'ì˜¨ë¼ì¸ ì§€ì›'] },
                    { id: 4, type: 'radio', question: 'ì¬ë°©ë¬¸/ì¬ì´ìš© ì˜ì‚¬ê°€ ìˆìœ¼ì‹ ê°€ìš”?', options: ['ì „í˜€ ì—†ìŒ', 'ì—†ìŒ', 'ë³´í†µ', 'ìˆìŒ', 'ë§¤ìš° ë†’ìŒ'] },
                    { id: 5, type: 'textarea', question: 'í•˜ê³  ì‹¶ìœ¼ì‹  ë§ì”€ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”' }
                ]
            },
            {
                id: 'T007',
                title: 'ì±„ìš© í›„ë³´ì í‰ê°€',
                category: 'hr',
                description: 'ë©´ì ‘ í›„ í›„ë³´ìë¥¼ ì²´ê³„ì ìœ¼ë¡œ í‰ê°€í•˜ëŠ” ì±„ìš© ì „ë¬¸ í…œí”Œë¦¿',
                price: 6000,
                seller: 'ì±„ìš©ì½”ì¹˜',
                sales: 76,
                rating: 4.7,
                questions: [
                    { id: 1, type: 'radio', question: 'ì§€ì›ìì˜ ì „ë¬¸ì„±ì€?', options: ['ë§¤ìš° ë¶€ì¡±', 'ë¶€ì¡±', 'ë³´í†µ', 'ìš°ìˆ˜', 'ë§¤ìš° ìš°ìˆ˜'] },
                    { id: 2, type: 'radio', question: 'ì˜ì‚¬ì†Œí†µ ëŠ¥ë ¥ì€?', options: ['ë§¤ìš° ë¶€ì¡±', 'ë¶€ì¡±', 'ë³´í†µ', 'ìš°ìˆ˜', 'ë§¤ìš° ìš°ìˆ˜'] },
                    { id: 3, type: 'radio', question: 'ì¡°ì§ ì í•©ë„ëŠ”?', options: ['ë§¤ìš° ë‚®ìŒ', 'ë‚®ìŒ', 'ë³´í†µ', 'ë†’ìŒ', 'ë§¤ìš° ë†’ìŒ'] },
                    { id: 4, type: 'checkbox', question: 'ê°•ì ìœ¼ë¡œ ë³´ì´ëŠ” ë¶€ë¶„ì€?', options: ['ì „ë¬¸ì§€ì‹', 'ê²½í—˜', 'íƒœë„', 'ì˜ì‚¬ì†Œí†µ', 'ë¬¸ì œí•´ê²°ë ¥', 'ë¦¬ë”ì‹­'] },
                    { id: 5, type: 'textarea', question: 'ì¢…í•© í‰ê°€ ë° ì±„ìš© ì˜ê²¬' }
                ]
            },
            {
                id: 'T008',
                title: 'ë¸Œëœë“œ ì¸ì§€ë„ ì¡°ì‚¬',
                category: 'marketing',
                description: 'ë¸Œëœë“œ ì¸ì§€ë„ì™€ ì´ë¯¸ì§€ë¥¼ ì¸¡ì •í•˜ëŠ” ë§ˆì¼€íŒ… ë¦¬ì„œì¹˜ í…œí”Œë¦¿',
                price: 7500,
                seller: 'ë¸Œëœë”©ë©',
                sales: 118,
                rating: 4.8,
                questions: [
                    { id: 1, type: 'radio', question: 'ìš°ë¦¬ ë¸Œëœë“œë¥¼ ì•Œê³  ê³„ì…¨ë‚˜ìš”?', options: ['ì „í˜€ ëª¨ë¦„', 'ë“¤ì–´ë³¸ ì  ìˆìŒ', 'ì•Œê³  ìˆìŒ', 'ì˜ ì•Œê³  ìˆìŒ', 'ë§¤ìš° ì˜ ì•Œê³  ìˆìŒ'] },
                    { id: 2, type: 'checkbox', question: 'ë¸Œëœë“œ ì´ë¯¸ì§€ëŠ”? (ë³µìˆ˜ì„ íƒ)', options: ['í˜ì‹ ì ', 'ì‹ ë¢°í•  ìˆ˜ ìˆëŠ”', 'íŠ¸ë Œë””í•œ', 'í•©ë¦¬ì ', 'ê³ ê¸‰ìŠ¤ëŸ¬ìš´', 'ì¹œê·¼í•œ'] },
                    { id: 3, type: 'radio', question: 'ê²½ìŸì‚¬ ëŒ€ë¹„ ì„ í˜¸ë„ëŠ”?', options: ['ë§¤ìš° ë‚®ìŒ', 'ë‚®ìŒ', 'ë¹„ìŠ·í•¨', 'ë†’ìŒ', 'ë§¤ìš° ë†’ìŒ'] },
                    { id: 4, type: 'checkbox', question: 'ì£¼ë¡œ ì ‘í•œ ì±„ë„ì€?', options: ['TV ê´‘ê³ ', 'ì˜¨ë¼ì¸ ê´‘ê³ ', 'SNS', 'ì§€ì¸ ì¶”ì²œ', 'ë§¤ì¥', 'ê¸°íƒ€'] },
                    { id: 5, type: 'textarea', question: 'ë¸Œëœë“œì— ëŒ€í•œ ì „ë°˜ì ì¸ ì¸ìƒì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”' }
                ]
            }
        ];

        function showTemplateMarket() {
            showScreen('templateMarketScreen');
            updatePoints();
            loadTemplates();
            loadPurchasedTemplates();
        }

        function loadTemplates() {
            const category = document.getElementById('templateCategory').value;
            const grid = document.getElementById('templatesGrid');

            const filteredTemplates = category === 'all'
                ? surveyTemplates
                : surveyTemplates.filter(t => t.category === category);

            if (filteredTemplates.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            grid.innerHTML = filteredTemplates.map(template => `
                <div class="card" style="cursor: pointer;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <h3 style="margin: 0; color: #1a1a2e; font-size: 18px;">${template.title}</h3>
                        <span style="background: #5B7C99; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold;">
                            ${getCategoryName(template.category)}
                        </span>
                    </div>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px; line-height: 1.5;">${template.description}</p>

                    <div style="display: flex; gap: 15px; margin-bottom: 15px; font-size: 13px; color: #666;">
                        <span>â­ ${template.rating}</span>
                        <span>ğŸ“¦ ${template.sales}ê°œ íŒë§¤</span>
                        <span>ğŸ‘¤ ${template.seller}</span>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 20px; font-weight: bold; color: #5B7C99;">ğŸ’° ${template.price.toLocaleString()} P</span>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn" style="padding: 8px 16px; font-size: 14px; background: #7B9FB8;"
                                    onclick="previewTemplate('${template.id}')">
                                ë¯¸ë¦¬ë³´ê¸°
                            </button>
                            <button class="btn" style="padding: 8px 16px; font-size: 14px;"
                                    onclick="purchaseTemplate('${template.id}')">
                                êµ¬ë§¤í•˜ê¸°
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getCategoryName(category) {
            const names = {
                'business': 'ë¹„ì¦ˆë‹ˆìŠ¤',
                'academic': 'í•™ìˆ /ì—°êµ¬',
                'marketing': 'ë§ˆì¼€íŒ…',
                'hr': 'ì¸ì‚¬/ì±„ìš©',
                'feedback': 'í”¼ë“œë°±',
                'event': 'ì´ë²¤íŠ¸'
            };
            return names[category] || category;
        }

        function filterTemplates() {
            loadTemplates();
        }

        function previewTemplate(templateId) {
            const template = surveyTemplates.find(t => t.id === templateId);
            if (!template) return;

            const questionsHTML = template.questions.map((q, idx) => {
                let optionsHTML = '';
                if (q.options) {
                    if (q.type === 'radio' || q.type === 'select') {
                        optionsHTML = q.options.map(opt =>
                            `<div style="padding: 8px; background: #f5f5f5; border-radius: 4px; margin: 4px 0;">â€¢ ${opt}</div>`
                        ).join('');
                    } else if (q.type === 'checkbox') {
                        optionsHTML = q.options.map(opt =>
                            `<div style="padding: 8px; background: #f5f5f5; border-radius: 4px; margin: 4px 0;">â˜ ${opt}</div>`
                        ).join('');
                    }
                }

                return `
                    <div style="padding: 15px; background: #fafafa; border-radius: 8px; margin-bottom: 12px;">
                        <div style="font-weight: 600; color: #333; margin-bottom: 8px;">
                            ${idx + 1}. ${q.question}
                            <span style="color: #999; font-size: 12px; font-weight: normal;">[${getQuestionTypeName(q.type)}]</span>
                        </div>
                        ${optionsHTML}
                        ${q.type === 'text' || q.type === 'textarea' ? '<div style="padding: 8px; background: #f5f5f5; border-radius: 4px; color: #999;">í…ìŠ¤íŠ¸ ì…ë ¥</div>' : ''}
                    </div>
                `;
            }).join('');

            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 10000; padding: 20px;';
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; padding: 30px; max-width: 700px; max-height: 90vh; overflow-y: auto; width: 100%;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                        <div>
                            <h2 style="margin: 0 0 8px 0; color: #1a1a2e;">${template.title}</h2>
                            <p style="color: #666; font-size: 14px; margin: 0;">${template.description}</p>
                        </div>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()"
                                style="background: #ddd; border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; font-size: 18px;">Ã—</button>
                    </div>

                    <div style="background: #f0f4f8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; gap: 20px; font-size: 14px;">
                            <span>â­ í‰ì : ${template.rating}/5.0</span>
                            <span>ğŸ“¦ íŒë§¤: ${template.sales}ê°œ</span>
                            <span>ğŸ‘¤ íŒë§¤ì: ${template.seller}</span>
                        </div>
                    </div>

                    <h3 style="margin: 20px 0 15px 0; color: #333;">ğŸ“‹ ì§ˆë¬¸ ëª©ë¡ (${template.questions.length}ê°œ)</h3>
                    ${questionsHTML}

                    <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()"
                                class="btn" style="background: #ddd; color: #333;">ë‹«ê¸°</button>
                        <button onclick="purchaseTemplate('${template.id}'); this.parentElement.parentElement.parentElement.remove();"
                                class="btn">ğŸ’° ${template.price.toLocaleString()} Pë¡œ êµ¬ë§¤í•˜ê¸°</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function getQuestionTypeName(type) {
            const names = {
                'text': 'ë‹¨ë‹µí˜•',
                'textarea': 'ì¥ë¬¸í˜•',
                'radio': 'ê°ê´€ì‹(ë‹¨ì¼ì„ íƒ)',
                'checkbox': 'ê°ê´€ì‹(ë³µìˆ˜ì„ íƒ)',
                'select': 'ë“œë¡­ë‹¤ìš´'
            };
            return names[type] || type;
        }

        function purchaseTemplate(templateId) {
            const template = surveyTemplates.find(t => t.id === templateId);
            if (!template) {
                alert('í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ì´ë¯¸ êµ¬ë§¤í–ˆëŠ”ì§€ í™•ì¸
            const purchases = JSON.parse(localStorage.getItem('templatePurchases') || '[]');
            if (purchases.some(p => p.templateId === templateId && p.userId === currentUser.id)) {
                alert('ì´ë¯¸ êµ¬ë§¤í•œ í…œí”Œë¦¿ì…ë‹ˆë‹¤.');
                return;
            }

            // í¬ì¸íŠ¸ í™•ì¸
            if (currentUser.points < template.price) {
                alert(`í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.\ní•„ìš”: ${template.price.toLocaleString()} P\në³´ìœ : ${currentUser.points.toLocaleString()} P`);
                return;
            }

            if (!confirm(`"${template.title}" í…œí”Œë¦¿ì„\n${template.price.toLocaleString()} Pì— êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            // í¬ì¸íŠ¸ ì°¨ê°
            currentUser.points -= template.price;
            updateUser(currentUser);

            // íŒë§¤ìì—ê²Œ ìˆ˜ìˆ˜ë£Œ ì§€ê¸‰ (70% - ì‹¤ì œë¡œëŠ” íŒë§¤ì ê³„ì •ì— ì§€ê¸‰í•´ì•¼ í•˜ì§€ë§Œ ë°ëª¨ì´ë¯€ë¡œ ê¸°ë¡ë§Œ)
            const sellerRevenue = Math.floor(template.price * 0.7);

            // êµ¬ë§¤ ê¸°ë¡ ì €ì¥
            purchases.push({
                id: Date.now(),
                userId: currentUser.id,
                templateId: template.id,
                price: template.price,
                sellerRevenue: sellerRevenue,
                purchasedAt: new Date().toISOString()
            });
            localStorage.setItem('templatePurchases', JSON.stringify(purchases));

            alert(`âœ… êµ¬ë§¤ ì™„ë£Œ!\n\n"${template.title}" í…œí”Œë¦¿ì„ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤.\nêµ¬ë§¤í•œ í…œí”Œë¦¿ì€ í•˜ë‹¨ì—ì„œ í™•ì¸í•˜ê³  ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);

            updatePoints();
            loadPurchasedTemplates();
        }

        function loadPurchasedTemplates() {
            const purchases = JSON.parse(localStorage.getItem('templatePurchases') || '[]');
            const myPurchases = purchases.filter(p => p.userId === currentUser.id);

            const container = document.getElementById('purchasedTemplates');

            if (myPurchases.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">êµ¬ë§¤í•œ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            container.innerHTML = myPurchases.map(purchase => {
                const template = surveyTemplates.find(t => t.id === purchase.templateId);
                if (!template) return '';

                return `
                    <div class="card" style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="margin: 0 0 8px 0; color: #1a1a2e;">${template.title}</h3>
                                <p style="color: #666; font-size: 14px; margin: 0 0 8px 0;">${template.description}</p>
                                <div style="font-size: 13px; color: #999;">
                                    êµ¬ë§¤ì¼: ${new Date(purchase.purchasedAt).toLocaleString('ko-KR')} |
                                    ê²°ì œê¸ˆì•¡: ${purchase.price.toLocaleString()} P
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn" style="padding: 8px 16px; font-size: 14px; background: #7B9FB8;"
                                        onclick="previewTemplate('${template.id}')">
                                    ë¯¸ë¦¬ë³´ê¸°
                                </button>
                                <button class="btn btn-success" style="padding: 8px 16px; font-size: 14px;"
                                        onclick="applyTemplate('${template.id}')">
                                    í…œí”Œë¦¿ ì‚¬ìš©í•˜ê¸°
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function applyTemplate(templateId) {
            const template = surveyTemplates.find(t => t.id === templateId);
            if (!template) {
                alert('í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // êµ¬ë§¤ í™•ì¸
            const purchases = JSON.parse(localStorage.getItem('templatePurchases') || '[]');
            if (!purchases.some(p => p.templateId === templateId && p.userId === currentUser.id)) {
                alert('ë¨¼ì € í…œí”Œë¦¿ì„ êµ¬ë§¤í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!confirm(`"${template.title}" í…œí”Œë¦¿ì„ ì‚¬ìš©í•˜ì—¬\nìƒˆ ì„¤ë¬¸ì„ ë§Œë“œì‹œê² ìŠµë‹ˆê¹Œ?\n\ní…œí”Œë¦¿ì˜ ì§ˆë¬¸ë“¤ì´ ìë™ìœ¼ë¡œ ë³µì‚¬ë©ë‹ˆë‹¤.`)) {
                return;
            }

            // ì„¤ë¬¸ ì‘ì„± í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ê³  í…œí”Œë¦¿ ë°ì´í„° ì ìš©
            showCreateSurvey();

            // ê¸°ë³¸ ì •ë³´ ì±„ìš°ê¸°
            document.getElementById('surveyTitle').value = template.title + ' (í…œí”Œë¦¿)';
            document.getElementById('surveyDescription').value = template.description;

            // ì§ˆë¬¸ ë³µì‚¬
            surveyQuestions = template.questions.map((q, idx) => ({
                id: Date.now() + idx,
                ...q
            }));

            renderQuestions();

            alert('âœ… í…œí”Œë¦¿ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì§ˆë¬¸ë“¤ì´ ìë™ìœ¼ë¡œ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.\ní•„ìš”ì— ë”°ë¼ ìˆ˜ì •í•˜ê³  ì„¤ë¬¸ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.');
        }

        window.onload = init;
    </script>
</body>
</html>
